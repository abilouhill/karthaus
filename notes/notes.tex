\documentclass[titlepage,letterpaper,final,11pt]{scrartcl}

\usepackage[total={6.0in,8.75in},top=1.2in,left=1.35in]{geometry}

% this lets us avoid the scrartcl/hyperref conflict...
%\let\ifvtex\relax

\usepackage{verbatim}
\usepackage{empheq}
\usepackage{color}
\usepackage{animate}
\usepackage{graphicx}
\usepackage{fancyvrb}

% hyperref should be the last package we load
\usepackage[pdftex,
colorlinks=true,
plainpages=false, % only if colorlinks=true
linkcolor=blue,   % only if colorlinks=true
citecolor=blue,   % only if colorlinks=true
urlcolor=blue     % only if colorlinks=true
]{hyperref}

\pdfinfo{
/Title (Numerical modelling of ice sheets, streams, and shelves)
/Author (Ed Bueler)
/Subject (numerical modelling of glaciers, ice sheets, and ice shelves)
/Keywords (numerical model, numerical analysis, glacier, ice sheet, ice shelf, shallow models of ice flow)
}

\newcommand{\ddt}[1]{\ensuremath{\frac{\partial #1}{\partial t}}}
\newcommand{\ddx}[1]{\ensuremath{\frac{\partial #1}{\partial x}}}
\newcommand{\ddy}[1]{\ensuremath{\frac{\partial #1}{\partial y}}}
\newcommand{\pp}[2]{\ensuremath{\frac{\partial #1}{\partial #2}}}
\renewcommand{\t}[1]{\texttt{#1}}
\newcommand{\Matlab}{\textsc{Matlab}\xspace}
\newcommand{\bq}{\mathbf{q}}
\newcommand{\bU}{\mathbf{U}}
\newcommand{\eps}{\epsilon}
\newcommand{\grad}{\nabla}
\newcommand{\Div}{\nabla\cdot}
\newcommand{\devstress}{\tau}

\newcommand{\mmess}[1]{\vspace{-0.1in}\begin{center}
\fbox{\url{http://www.dms.uaf.edu/~bueler/mccarthy/mfiles/#1.m}}
\end{center}}

%\newcommand{\minput}[1]{\small\verbatiminput{../mfiles/#1.slim.m}
%\tiny\mmess{#1}\normalsize}

\newcommand{\minput}[1]{
\bigskip
\begin{quote}
\bigskip
\VerbatimInput[frame=single,framesep=3mm,label=\fbox{\normalsize \textsl{\,#1.m\,}},fontfamily=courier,fontsize=\scriptsize]{../mfiles/#1.slim.m}
\bigskip
\end{quote}
}

\newcommand{\alert}[1]{\emph{#1}}



\begin{document}
\graphicspath{{../photos/}{../pdffigs/}}


\begin{titlepage}

  \begin{center}
    {\Large\usekomafont{title} Numerical modelling of ice sheets, streams, and shelves}
    \vspace{0.5cm}

    {\large Ed Bueler}
    \vspace{1cm}

    September 2012

    \vfill
    
    \includegraphics[width=6.0in]{flowline}
  
    \tiny \emph{figure modified from} \cite{SchoofMarine1} \normalsize
    
    \vspace{2.0in}
  \end{center}
\end{titlepage}


\section{preamble}

slogans:
  \begin{enumerate}
  \item \alert{focus on approximating ice flow}
  \item \alert{example numerical codes that actually work}
  \end{enumerate}
\medskip

scope:
  \begin{itemize}
  \item[$\circ$] continuum models

    \begin{itemize}
    \item shallow ice approximation (SIA) in 2D
    \item shallow shelf approximation (SSA) in 1D
    \item mass continuity \& surface kinematical equations
    \end{itemize}

  \item[$\circ$] numerical ideas

    \begin{itemize}
    \item finite difference schemes
    \item solving algebraic systems from stress balances
    \item verification
    \end{itemize}
  \end{itemize}



\emph{not} \normalsize covered here:

  \begin{itemize}
  \item Stokes and ``higher order'' flow equations
  \item thermomechanical coupling or polythermal ice
  \item subglacial hydrology/processes
  \item mass balance and snow/firn processes
  \item constitutive relations other than Glen isotropic
  \item grounding lines, calving fronts, ocean interaction
  \item paleo-climate and ``spin-up''
  \item earth deformation under ice sheet load
  \item other numerics: FEM, spectral, multigrid, parallel, \dots
  \item etc.
  \end{itemize}

  \begin{itemize}
  \item coordinates $t,x,y,z$  (with $z$ vertical, positive upward)
  \item subscripts for partial derivatives $u_x = \partial u/\partial x$
  \item $H=$ ice thickness
  \item $h=$ ice surface elevation
  \item $b=$ bedrock surface elevation
  \item $T=$ ice temperature
  \item $\mathbf{u}=(u,v,w)=$ ice velocity
  \item $\rho=$ density of ice
  \item $\rho_w=$ density of ocean water
  \item $g=$ acceleration of gravity
  \item $n=3$ Glen flow law exponent $=3$
  \item $A=A(T)=$ ice softness in Glen law ($\mathbf{D}_{ij} = A(T) \tau^{n-1} \tau_{ij}$)
  \item \alert{please ask about notation!}  (stupid questions impossible)
  \end{itemize}

%notation generally consistent with these references
\nocite{BLKCB,BBssasliding,Fowler,GreveBlatter2009,SchoofStream,SchoofMarine1}

Matlab/Octave codes:

\begin{itemize}
\item lectures are structured around 14 ice flow codes
\item each is $\sim$ 1/2 page of Matlab/Octave code
\item \texttt{.zip} and \texttt{.tar.gz} forms available from memory stick
\item online:

\centerline{\fbox{\url{http://www.dms.uaf.edu/~bueler/mccarthy/mfiles/}}}
\end{itemize}


\subsection{ice flow equations}

My first goal in these notes is to get to an equation for which I can say:
\begin{center}
\emph{numerically solve just this equation, and you've got a usable model for a flowing ice sheet.}
\end{center}
To get to my goal I will quickly recall the continuum mechanics of ice flow.  But note that a ``usable'' model is \emph{understood} more than it is \emph{correct}!

Ice in glaciers is a \emph{fluid}.  Thus we describe fluids primarily by a \emph{velocity field} $\mathbf{u}(t,x,y,z)$.  If the ice fluid were either faster-moving than it actually is (e.g., because gravity was much stronger), or if it was linearly-viscous like liquid water, or both, then ice flow would be a more-familiar, ``typical'' fluid.  In that case we would all use the Navier-Stokes equations as our flow model:
\begin{align}
\nabla \cdot \mathbf{u} &= 0 &&\text{\emph{incompressibility}} \label{incompressible} \\
\rho \left(\mathbf{u}_t + \mathbf{u}\cdot\nabla \mathbf{u}\right) &= -\nabla p + \nu \nabla^2 \mathbf{u} + \rho \mathbf{g} &&\text{\emph{force balance}} \label{stokes}
\end{align}

You say ``\emph{hmmm} \dots \emph{does not sound like glaciology to me!}''  Indeed, is numerical ice flow modeling a part of computational fluid dynamics?  My answer is emphatically ``yes'', and it is clearly a large scale fluid problem like atmosphere and ocean in climate systems.  But it is a weird one!  Consider what makes atmosphere/ocean flow modeling exciting:
  \begin{center} turbulence \qquad convection \qquad  coriolis force  \qquad salinity variation \qquad chemistry
  \end{center}
None of the above list is relevant to ice flow!  So what could be interesting about the flow of slow, cold, stiff, laminar, inert old ice?  Of course, it's \emph{ice dynamics!}

First we might observe that ice is a slow, shear-thinning fluid.  In terms of equations, ``slow'' implies that$\rho \left(\mathbf{u}_t + \mathbf{u}\cdot\nabla \mathbf{u}\right) \approx 0$, which is to say that the forces of inertia are negligible.  while ``non-Newtonian'' implies that the viscosity $\nu$ in \eqref{stokes} is not constant.  In face ice is ``shear-thinning'' flow, so that bigger strain rate means smaller viscosity.  Thus the standard ``full'' model is Glen-law ($n=3$) Stokes:
\begin{align}
\nabla \cdot \mathbf{u} &= 0 &&\text{\emph{incompressibility}} \label{incompressibleagain} \\
0 &= - \nabla p + \nabla \cdot \tau_{ij} + \rho \mathbf{g} &&\text{\emph{force balance}} \label{forcebalance} \\
\mathbf{D}_{ij} &= A \tau^2 \tau_{ij} &&\text{\emph{flow law}} \label{flowlaw}
\end{align}

These equations above are true at every instant, and thus geometry, boundary stress, and ice viscosity determine velocity instantaneously.  A time-stepping numerical ice sheet code recomputes the full velocity field at every time step, without requiring velocity from the previous step.  Thus such a model has no memory of previous momentum/velocity, and velocity is a ``diagnostic'' output of an ice flow model.

Consider now the plane flow case.  In the $x,z$ plane flow case the Stokes equations say
\begin{empheq}[]{align}
u_x + w_z &= 0 &&\text{\emph{incompressibility}}\notag \\
p_x &= \tau_{11,x} + \tau_{13,z} &&\text{\emph{stress balance} ($x$)} \notag \\
p_z &= \tau_{13,x} - \tau_{11,z} - \rho g &&\text{\emph{stress balance} ($z$)} \notag \\
u_x &= A \tau^2 \tau_{11} &&\text{\emph{flow law} (diagonal)}\notag \\
u_z + w _x &= 2 A \tau^2 \tau_{13} &&\text{\emph{flow law} (off-diagonal)} \notag
\end{empheq}
Here $x,z$ subscripts are partial derivatives.  Note that $\tau_{13}$ is a ``vertical'' shear stress while $\tau_{11}$ and $\tau_{33}=-\tau_{11}$ are deviatoric longitudinal stresses.  We have five equations in five unknowns ($u,w,p,\tau_{11},\tau_{13}$).  This is complicated enough to make many researchers pause before jumping in to a solution method.  So, what about in a simplified situation?


\subsection{slab-on-a-slope}

\begin{itemize}
\item rotated coordinates:
  $$\mathbf{g} = g \sin\theta\, \hat x - g \cos \theta \,\hat z$$
\item so $p_x,p_z$ equations are now:
\begin{align}
p_x &= \tau_{11,x} + \tau_{13,z} + \rho g \sin\theta \notag \\
p_z &= \tau_{13,x} - \tau_{11,z} - \rho g \cos\theta \notag
\end{align}
\end{itemize}

\begin{center}
\includegraphics[width=3.0in]{slab}
\end{center}

\begin{itemize}
\item for a slab-on-a-slope there is \emph{no variation in} $x$
\item so equations simplify:
\begin{empheq}[box=\fbox]{align}
w_z &= 0 &   0 &= \tau_{11} \notag \\
\tau_{13,z} &= - \rho g \sin\theta &   u_z &= 2 A \tau^2 \tau_{13} \notag \\
p_z &= - \rho g \cos\theta \notag
\end{empheq}
\end{itemize}


\begin{itemize}
\item add some boundary conditions:
	$$w(\text{base})=0, \qquad p(\text{surface})=0, \qquad u(\text{base})=u_0$$
\item by integrating vertically, get :
  $$w=0, \qquad p = \rho g \cos\theta (H-z), \qquad \tau_{13} = \rho g \sin\theta (H-z)$$
\item and from ``$u_z = 2 A \tau^2 \tau_{13}$'' get
\vspace{-0.05in}
\begin{align*}
u(z) &= u_0 + 2 A (\rho g \sin\theta)^3 \int_0^z (H-z')^3\,dz' \\
     &= u_0 + \frac{1}{2} A (\rho g \sin\theta)^3  \left(H^4 - (H-z)^4\right)
\end{align*}
\end{itemize}

\begin{center}
\includegraphics[width=3.0in]{slabshear}
\end{center}


\begin{itemize}
\item do we believe these equations?
\item velocity on last slide (and below) was from a \emph{formula}
\item compare to observations at right
\end{itemize}


\begin{center}
% NOT preserving aspect ratio
\includegraphics[width=2.5in]{slabvel}
\quad
\includegraphics[width=2.5in]{athabasca_deform}
\end{center}


Velocity profile of the Athabasca Glacier, Canada, derived from inclinometry (Savage and Paterson, 1963)\nocite{SavagePaterson}


mass continuity:

\begin{itemize}
\item now we know the velocity $u=u(t,x,z)$ \dots so what?
\item suppose our slab has variable thickness $H(t,x)$
\item compute the vertical average of velocity:
	$$\bar u(x,t) = \frac{1}{H}\int_0^{H} u(t,x,z)\,dz$$
\end{itemize}

\begin{itemize}
\item consider change of area (ice volume in 3D) in the figure:
	$$\frac{dA}{dt} = \int_{x_1}^{x_2} M(x)\,dx + \bar u_1 H_1 - \bar u_2 H_2$$
\item but, assuming width $dx=x_2-x_2$ is small, $A\approx dx\, H$; divide by $dx$ and get
   $$H_t = M - \left(\bar u H\right)_x$$
\item this is a \emph{mass continuity equation}
\item I'll return to this topic \dots
\end{itemize}

\begin{center}
\includegraphics[width=2.5in]{slabmasscontfig}
\quad
\includegraphics[width=2.5in]{green_transect}
\end{center}


rough explanation of ``shallow ice approximation'' (SIA)

\begin{itemize}
\item from slab-on-slope velocity formula in $u_0=0$ case (``non-sliding SIA''),
\begin{align*}
\bar u H &= \int_0^H \frac{1}{2} A (\rho g \sin\theta)^3  \left(H^4 - (H-z)^4\right)\,dz \\
	&= \frac{1}{2} A (\rho g \sin\theta)^3  \left(\frac{4}{5} H^5\right) \\
	&= \frac{2}{5} A (\rho g \sin\theta)^3 H^5
\end{align*}
\item note $\sin \theta \approx \tan\theta = - h_x$
\item combine with mass continuity $H_t = M - \left(\bar u H\right)_x$:
  $$H_t = M + \left(\frac{2}{5} (\rho g)^5 A H^5 |h_x|^2 h_x\right)_x.$$
\item I'll return to this topic \dots
\end{itemize}



\section{shallow ice sheets}

slow, non-Newtonian, some basal slip, and shallow

\begin{itemize}
\item ice sheets have four outstanding properties \emph{as fluids}:
  \begin{enumerate}
  \item slow
  \item non-Newtonian
  \item contact slip (sometimes)
  \item shallow
  \end{enumerate}
\end{itemize}

regarding ``shallow''

\begin{itemize}
\item below in \alert{red} is a no-vertical-exaggeration cross section of Greenland at $71^\circ$
\small
\item green and blue: standard vertically-exaggerated cross section
\item you can scale Stokes equation using smallness of $\eps = [H]/[L]$, where $[H]$ is a typical thickness of an ice sheet and $[L]$ is a typical horizontal dimension, \dots (Fowler, 1997)\nocite{Fowler}
\end{itemize}


\subsection{shallow ice approx (SIA)}

flow model I: non-sliding, isothermal shallow ice approximation = (SIA)

a model which applies to
\begin{itemize}
\item small depth-to-width ratio (``shallow'') grounded ice sheets
\item on not-too-rough bed topography,
\item whose flow is not dominated by sliding and/or liquid water at the base or margin
\end{itemize}

\begin{center}
  \includegraphics[width=3.0in]{polaris}

``Polaris Glacier,'' northwest Greenland, photo 122, Post \& LaChapelle (2000)\nocite{PostLaChapelle}
\end{center}

SIA model equations

\begin{itemize}
\item though the best explanation of the SIA is to use shallowness to simplify the Stokes equations, here we take the simple slogan:

\begin{center}
\emph{the SIA uses the formulas from slab-on-a-slope}
\end{center}
\item shear stress approximation:
	$$(\tau_{13},\tau_{23}) \approx - \rho g (h-z) \nabla h$$
\item let $\mathbf{u} = (u,v)$, the horizontal velocity
\item we further approximate
\begin{align*}
\mathbf{u}_z &\approx 2 A |(\tau_{13},\tau_{23})|^{n-1} (\tau_{13},\tau_{23}) \\
     &= - 2 A (\rho g)^n (h-z)^n |\nabla h|^{n-1} \nabla h
\end{align*}
\item by integrating vertically, in the non-sliding case,
    $$\mathbf{u} = - \frac{2 A (\rho g)^n}{n+1} \left[H^{n+1} - (h-z)^{n+1}\right] |\nabla h|^{n-1} \nabla h$$
\item but mass continuity remains, $H_t = M - \left(\overline{\mathbf{u}} H\right)_x$
\end{itemize}

SIA thickness equation

\begin{itemize}
\item from last slide, we get the non-sliding, isothermal shallow ice approximation for how thickness changes:
\begin{empheq}[box=\fbox]{equation}
H_t = M + \Div \left(\Gamma H^{n+2} |\grad h|^{n-1} \grad h \right) \label{sia}
\end{empheq}

\vspace{-2mm}
  \begin{itemize}
  \item[$\circ$] where $H$ is ice thickness, $h$ is ice surface elevation, $b$ is bed elevation ($h=H+b$)
  \item[$\circ$] $M$ combines surface and basal mass (im)balance:

     accumulation if $M>0$, ablation if $M<0$
  \item[$\circ$] $n$ is the exponent in the Glen flow law
  \item[$\circ$] $\Gamma = 2 A (\rho g)^n / (n+2)$ is a positive constant
  \end{itemize}
\item numerically solve just equation (1), and you've got a usable model for \dots \emph{the Barnes ice cap} (Mahaffy, 1976)\nocite{Mahaffy}
\end{itemize}
\medskip

\noindent good questions:
\begin{enumerate}
\item where does equation (1) come from?
\item how to solve it numerically?
\item how to \emph{think} about it?
\end{enumerate}


\subsection{analogy w heat equation}

heat equation

\begin{itemize}
\item for understanding SIA, recall heat equation
\item recall Newton's law of cooling
	$$\frac{dT}{dt} = -K (T-T_{\text{ambient}})$$
where $T$ is object temperature and $K$ relates to material and geometry of object (e.g.~cup of coffee)
\item Newton's law for segments of a rod:
\begin{align*}
\frac{dT_j}{dt} &= -K \left(T_j - \frac{1}{2} (T_{j-1} + T_{j+1}) \right) \\
	&= \frac{K}{2} \left(T_{j-1} - 2 T_j + T_{j+1}\right) 
\end{align*}
\item this has limit as segments shrink:
	$$T_t = D T_{xx}$$
\item compare: finite difference approximations to derivatives
\end{itemize}


more complete and 2D version of heat equation

\begin{itemize}
\item $u(t,x,y)$ is temperature in object at position $x,y$ and time $t$
\item Fourier rewrote Newton's law as a rule for heat flux: $\mathbf{q} = - k \grad u$
\item allow an additional heat source $f$
\item coefficients: $\rho$ is density, $c$ is specific heat, $k$ is conductivity
\item by conservation of energy get heat equation:
	$$\rho c u_t = f + \Div (k \grad u)$$
\end{itemize}

\begin{itemize}
\item define the ``diffusivity constant'' $D=k/(\rho c)$ and also $F := f/(\rho c)$
\item for 2D object (e.g.~a plate):
\begin{equation}
u_t = F + \Div (D\, \grad u) \label{heat}
\end{equation}
\item this is like the SIA model for ice sheets: temperature $u$ solves a \emph{diffusive, time-evolving partial differential equation (PDE)}
\end{itemize}

analogy: SIA versus heat equation

\begin{itemize}
\item side-by-side comparison:
\begin{center}
\begin{tabular}{cc}
SIA:\, $H(t,x,y)$ is ice thickness & \scriptsize heat: $u(t,x,y)$ is temperature \\
	\boxed{H_t = M + \Div \left({\color{red}\Gamma H^{n+2} |\grad h|^{n-1}}\, \grad h \right)}  &  \boxed{u_t = F + \Div (D\, \grad u)}
\end{tabular}
\end{center}

\item we identify the diffusivity in the SIA:
	$$D = {\color{red}\Gamma H^{n+2} |\grad h|^{n-1}}$$
\item \emph{non-sliding shallow ice flow \alert{diffuses} the ice sheet}
\item some issues with this analogy:
  \begin{itemize}
  \item[$\circ$]  $D$ depends on solution $H(t,x,y)$
  \item[$\circ$]  $D\to 0$ at margin, where $H\to 0$
  \item[$\circ$]  $D\to 0$ at divides/domes, where $|\grad h|\to 0$
  \end{itemize}
\end{itemize}


\subsection{finite difference numerics}

numerics for heat equation: basic ideas of finite differences

\begin{itemize}
\item numerical schemes for heat equation are good start for SIA
\item for differentiable $f(x)$ and any $h$, \emph{Taylor's theorem} says
	$$f(x+h) = f(x) + f'(x) h + \frac{1}{2} f''(x) h^2 + \frac{1}{3!} f'''(x) h^3 + \dots$$
\item you can replace ``$h$'' by multiples of $\Delta x$, e.g.:
\begin{align*}
f(x-\Delta x) &= f(x) - f'(x) \Delta x + \frac{1}{2} f''(x) \Delta x^2 - \frac{1}{3!} f'''(x) \Delta x^3 + \dots \\
f(x+2\Delta x) &= f(x) + 2 f'(x) \Delta x + 2 f''(x) \Delta x^2 + \frac{4}{3} f'''(x) \Delta x^3 + \dots
\end{align*}
\item \emph{combine expressions like these to give approximations of derivatives, from values on a grid}
\end{itemize}

finite differences for partial derivatives

\begin{itemize}
\item we want partial derivative expressions, for example with $u=u(t,x)$:
\begin{align*}
u_t(t,x) &= \frac{u(t+\Delta t,x) - u(t,x)}{\Delta t} + O(\Delta t), \\
u_t(t,x) &= \frac{u(t+\Delta t,x) - u(t-\Delta t,x)}{2\Delta t} + O(\Delta t^2), \\
u_x(t,x) &= \frac{u(t,x+\Delta x) - u(t,x-\Delta x)}{2\Delta x} + O(\Delta x^2), \\
u_{xx}(t,x) &= \frac{u(t,x+\Delta x) - 2 u(t,x) + u(t,x-\Delta x)}{\Delta x^2} + O(\Delta x^2)
\end{align*}
and so on
\item sometimes we want a derivative in-between grid points:
	$$u_x(t,x+(\Delta x/2)) = \frac{u(t,x+\Delta x) - u(t,x)}{\Delta x} + O(\Delta x^2)$$
\item ``$+O(h^2)$'' is better than ``$+O(h)$'' if $h$ is a small number
\end{itemize}

explicit scheme for heat equation

\begin{itemize}
\item consider 1D heat equation $u_t = D u_{xx}$
\item an \emph{explicit} scheme:
	$$\frac{u(t+\Delta t,x) - u(t,x)}{\Delta t} = D\,\frac{u(t,x+\Delta x) - 2 u(t,x) + u(t,x-\Delta x)}{\Delta x^2}$$
\item the difference between the equation $u_t = D u_{xx}$ and the scheme is $O(\Delta t,\Delta x^2)$ (Morton and Mayers, 2005)\nocite{MortonMayers}
\item notation: $(t_n,x_j)$ and $u_j^n \approx u(t_n,x_j)$
\item let $\nu = D \Delta t / (\Delta x)^2$, so
	$$u_j^{n+1} = \nu u_{j+1}^n + (1 - 2 \nu) u_j^n + \nu u_{j-1}^n$$
\end{itemize}


explicit scheme in two space dimensions

\begin{itemize}
\item recall heat equation in 2D: $u_t = D(u_{xx} + u_{yy})$
\item in two spatial variables we write $u_{jk}^n \approx u(t_n,x_j,y_k)$
\item so the 2D explicit scheme is
	$$\frac{u_{jk}^{n+1} - u_{jk}^n}{\Delta t} = D\,\left(\frac{u_{j+1,k}^n - 2 u_{jk}^n + u_{j-1,k}^n}{\Delta x^2} + \frac{u_{j,k+1}^n - 2 u_{jk}^n + u_{j,k-1}^n}{\Delta y^2}\right)$$
\end{itemize}

\begin{center}
\includegraphics[width=2.5in]{expstencil}
\quad
\includegraphics[width=2.5in]{exp2dstencil}

FIXME: identify schemes
\end{center}


implementation

\minput{heat}

\begin{itemize}
\item solves $u_t = D(u_{xx} + u_{yy})$ on square $-1 < x < 1$, $-1 < y < 1$
\item uses gaussian initial condition: $u_0(x,y) = e^{-30 r^2}$
\item uses ``colon notation'' to remove loops over spatial variables
\item \texttt{>>  heat(1.0,30,30,0.001,20)}

approximates $u$ on $30\times 30$ spatial grid, with $D=1$ and $N=20$ steps of $\Delta t = 0.001$
\end{itemize}


the look of success

\begin{itemize}
\item solving $u_t = u_{xx} + u_{yy}$ on $30\times 30$ grid
\end{itemize}


\begin{center}
\includegraphics[width=2.5in]{initialheat}
\quad
\includegraphics[width=2.5in]{finalheat}

initial condition $u(0,x,y)$ \qquad approximate solution $u(t,x,y)$ at $t=0.02$ with $\Delta t=0.001$
\end{center}


the look of instability

\begin{itemize}
\item both figures are from solving $u_t = u_{xx} + u_{yy}$ on the same space grid, but with slightly different time steps
\end{itemize}

\begin{center}
\includegraphics[width=2.5in]{stability}
\quad
\includegraphics[width=2.5in]{instability}

%$D=1,\Delta t = 0.00064286,\Delta x = \Delta y = 0.04$ so
%$D=1,\Delta t = 0.001,\Delta x = \Delta y = 0.04$ so
$\frac{D\Delta t}{\Delta x^2}= 0.402$ \quad
$\frac{D\Delta t}{\Delta x^2}= 0.625$
\end{center}

avoid the instability

\begin{itemize}
\item recall 1D explicit scheme had the form 
	$$u_j^{n+1} = \nu u_{j+1}^n + (1 - 2 \nu) u_j^n + \nu u_{j-1}^n$$
\item thus the new value $u_j^{n+1}$ is an \emph{average} of the old values, \emph{if the middle coefficient is positive}:
	$$1 - 2 \nu \ge 0 \quad \iff \quad  \frac{D\Delta t}{\Delta x^2} \le \frac{1}{2} \quad \iff \quad \Delta t \le \frac{\Delta x^2}{2 D}$$
\item averaging is always stable because averaged wiggles are always smaller than the original wiggles
\item \dots so this condition is a sufficient \emph{stability criterion}
\item so:

\begin{center}
\emph{the result was unstable because the time step was too big}
\end{center}
\end{itemize}

\textsl{adaptive} implementation: guaranteed stability

\mmess{heatadapt}

\begin{itemize}
\item same as \texttt{heat.m} except

\begin{center}
\emph{choose time step from stability criterion}
\end{center}
\end{itemize}

alternative instability fix: implicitness

\begin{itemize}
\item explicit scheme is only ``conditionally stable'', but there are methods which are stable for \emph{any} positive time step $\Delta t$
\end{itemize}

\begin{itemize}
\item an implicit scheme is \emph{Crank-Nicolson} $\longrightarrow$
\item Crank-Nicolson has smaller error too: $O(\Delta t^2,\Delta x^2)$
\end{itemize}

\begin{itemize}
\item \emph{but} you have to solve linear systems of equations to take each time step
\item \scriptsize Donald Knuth has advice for ice sheet modelers: \begin{quote}
\emph{We should forget about small efficiencies \dots: premature optimization is the root of all evil}.
\end{quote}
\end{itemize}

variable diffusivity and time steps

\begin{itemize}
  \item recall the analogy: \qquad (SIA) $\leftrightarrow$ (heat eqn)
  \item the SIA has a diffusivity which varies in space, so consider a more general heat equation:
  		$$u_t = F + \Div \left(D(x,y) \grad u\right)$$
  \item the explicit method is conditionally stable with the same time step restriction if we evaluate diffusivity $D(x,y)$ at \alert{staggered} grid points:
\begin{align*}
\Div \left(D(x,y) \grad u\right) &\approx \frac{D_{j+1/2,k}(u_{j+1,k} - u_{j,k}) - D_{j-1/2,k}(u_{j,k} - u_{j-1,k})}{\Delta x^2} \\
	&\qquad + \frac{D_{j,k+1/2}(u_{j,k+1} - u_{j,k}) - D_{j,k-1/2}(u_{j,k} - u_{j,k-1})}{\Delta y^2}
\end{align*}
\end{itemize}

\begin{center}
\includegraphics[width=1.8in]{cnstencil}
\quad
\includegraphics[width=1.8in]{diffstencil}
\quad
\includegraphics[width=1.8in]{mahaffystencil}
\end{center}

in stencil at right:
\begin{itemize}
\item[] diamonds: $u$
\item[] triangles: $D$
\end{itemize}


general diffusion equation code

\minput{diffusion}

\begin{itemize}
\item solves abstract diffusion equation $u_t = \Div \left(D(x,y)\, \grad u\right)$
\item user supplies diffusivity on staggered grid
\end{itemize}


\subsection{solutions}

exact solution of heat equation

\begin{itemize}
\item before getting to ice flow, one more heat equation topic \dots
\item the simple heat equation in 1D with constant diffusivity $D>0$ is:
	$$u_t = D u_{xx}$$
\item many \emph{exact} solutions to the heat equation are known, but I'll show the ``Green's function''
\item \dots also known as ``fundamental solution'' or ``heat kernel''
\item it starts at time $t=0$ with a ``delta function'' of heat at the origin $x=0$ and then it spreads out over time
\item we find it by a method which generalizes to the SIA
\end{itemize}

Green's function of heat equation

\begin{itemize}
\item the solution is ``self-similar'' over time
\item as time goes it changes shape by
  \begin{itemize}
  \item[$\circ$] shrinking the output (vertical) axis and
  \item[$\circ$] lengthening the input (horizontal) axis
  \end{itemize}
\item \dots but otherwise it is the same shape
\item the integral over $x$ is independent of time
\end{itemize}

\begin{center}
\includegraphics[width=2.5in]{heatscaling}
\quad
\includegraphics[width=2.5in]{brownian}

\emph{increasing time} $\to$ \qquad FIXME: parbox {\emph{historical note}:  in 1905 Einstein saw that the average distance traveled by particles in thermal motion scales like $\sqrt{t}$, so $s = t^{-1/2}x$ is an invariant}
\end{center}

similarity solutions

\begin{itemize}
\item Green's function of heat equation in 1D is
	$$u(t,x) = C\, t^{-1/2} e^{-x^2/(4Dt)}$$
\item ``similarity'' variables for 1D heat equation are
	$$s \stackrel{\text{\emph{input scaling}}}{\phantom{\Big|}=\phantom{\Big|}} t^{-1/2} x, \qquad u(t,x) \stackrel{\text{\emph{output scaling}}}{\phantom{\Big|}=\phantom{\Big|}} t^{-1/2} \phi(s)$$
\end{itemize}




\subsection{solving the SIA}

similarity solution to SIA

\begin{itemize}
\item jump forward to 1981
\item P.~Halfar found the similarity solution of the SIA in the case of flat bed and no surface mass balance \nocite{Halfar81,Halfar83}
\item Halfar's 2D solution for Glen flow law with $n=3$ has scalings
   $$H(t,r)=t^{-1/9} \phi(s), \qquad s = t^{-1/18} r$$
\item \dots so the diffusion of ice really slows down as the shape flattens out!
\end{itemize}

Halfar solution to the SIA: the movie

%\animategraphics[autoplay,loop,height=7.0cm]{4}{anim/halfar}{0}{26}

frames from $t=4$ months to $t = 10^6$ years, equal spaced in \emph{exponential} time

Halfar solution to the SIA: the formula

\begin{itemize}
\item for $n=3$ the solution formula is:
  $$H(t,r) = H_0 \left(\frac{t_0}{t}\right)^{1/9} \left[1 - \left(\left(\frac{t_0}{t}\right)^{1/18} \frac{r}{R_0}\right)^{4/3}\right]^{3/7}$$
\item the ``characteristic time'' is
  $$t_0 = \frac{1}{18 \Gamma} \left(\frac{7}{4}\right)^3 \frac{R_0^4}{H_0^{7}}$$
if $H_0$, $R_0$ are central height and ice cap radius at $t=t_0$
\item you choose $H_0$ and $R_0$ and then determine $t_0$
\item it is a simple formula to use for verification!
\end{itemize}

is the Halfar solution \emph{good for any modeling}?

\begin{itemize}
\item John Nye and others (2000)\nocite{NyeIcarus2000} compared the long-time consequences of different flow laws for the South Mars Polar Cap
\item they evaluated $\text{CO}_2$ ice and $\text{H}_2\text{O}$ ice softness parameters
\item \dots by comparing the long-time behavior of the corresponding Halfar solutions
\item conclusions:
  \begin{quote}
  \dots none of the three possible [$\text{CO}_2$] flow laws will allow a 3000-m cap, the thickness suggested by stereogrammetry, to survive for $10^7$ years, indicating that the south polar ice cap is probably not composed of pure $\text{CO}_2$ ice \dots the south polar cap probably consists of water ice, with an unknown admixture of dust.
  \end{quote}
\end{itemize}

on ``degenerate'' diffusivity

\begin{itemize}
\item recall that the SIA is
	$$H_t = M + \Div \left(D\, \grad h \right) \quad \text{where} \quad D = \Gamma H^{n+2} |\grad h|^{n-1}$$
\item thus the diffusivity ``degenerates'', $D \to 0$, when either $H\to 0$ or $\grad h \to 0$
\item summary:
\begin{tabular}{l|c|c}
 & why $D\to 0$ & so what? \\ \hline
domes    & $\grad h \to 0$ & \begin{tabular}{c}
$H$ and $\grad h$ are continuous \\ but $\grad^2 h$ is singular
\end{tabular} \\ \hline
margins  & $H \to 0$       & \begin{tabular}{c}
$H$ is continuous \\ but $\grad h$ is singular
\end{tabular}
\end{tabular}
\item in terms of numerical error, margin is worse than dome
\item degenerate diffusion equations are automatically free boundary problems
\end{itemize}

computing diffusivity in SIA

\begin{itemize}
\item for numerical stability we compute $D = \Gamma H^{n+2} |\grad h|^{n-1}$ on the staggered grid
\item various schemes proposed \small (Mahaffy, 1976\nocite{Mahaffy}; van der Veen 1999\nocite{vanderVeen}; Hindmarsh and Payne 1996\nocite{HindmarshPayne})
\item all schemes involve
  \begin{itemize}
  \item[$\circ$] averaging $H$
  \item[$\circ$] differencing $h$
  \item[$\circ$] in a ``balanced'' way, for better accuracy,
  \end{itemize}
to get the diffusivity on staggered grid

\item Mahaffy stencil shown in previous figure
\end{itemize}


SIA implementation: flat bed case

\minput{siaflat}

verification of numerical ice flow codes

\begin{itemize}
\item how do we make sure an \emph{implemented} numerical scheme is correct?
  \begin{itemize}
  \item[$\circ$] \emph{technique} 1: don't make any mistakes
  \item[$\circ$] \emph{technique} 2: compare your model with others, and hope that the outliers are the ones with errors
  \item[$\circ$] \emph{technique} 3: build-in a comparison to an exact solution, and actually measure the numerical error \alert{$=$ verification}
  \end{itemize}
\item where to get exact solutions for ice flow models?
  \begin{itemize}
  \item[$\circ$] textbook: Greve and Blatter (2009)\nocite{GreveBlatter2009}
  \item[$\circ$] similarity solutions to SIA (Halfar 1983\nocite{Halfar83}; Bueler et al 2005\nocite{BLKCB})
  \item[$\circ$] manufactured solutions to thermo-coupled SIA (Bueler et al 2007\nocite{BBL})
  \item[$\circ$] flowline and cross-flow SSA solutions (van der Veen, 1985; Schoof, 2006)\nocite{SchoofStream,vanderVeen85}
  \item[$\circ$] flowline Blatter solutions (Glowinski and Rappaz 2003)\nocite{GlowinskiRappaz}
  \item[$\circ$] flowline Stokes solutions for constant viscosity (Ladyzhenskaya 1963\nocite{Ladyzhenskaya}, Balise and Raymond 1985\nocite{BaliseRaymond1985})
  \item[$\circ$] manufactured solutions to the Stokes equations (Sargent and Fastook 2010; Jouvet and Rappaz 2011)\nocite{JouvetRappaz2011,SargentFastook2010}
  \end{itemize}
\end{itemize}

verifying SIA code vs Halfar

\begin{verbatim}
octave:40> verifysia(20)
average abs error            = 22.310
maximum abs error            = 227.849
octave:41> verifysia(40)
average abs error            = 9.490
maximum abs error            = 241.470
octave:42> verifysia(80)
average abs error            = 2.800
maximum abs error            = 155.796
octave:43> verifysia(160)
average abs error            = 1.059
maximum abs error            = 109.466
\end{verbatim}


demonstrate robustness

see \texttt{roughice.m}, which calls \texttt{siaflat.m} after setting-up the nasty initial state at left:

\includegraphics[width=2.5in]{roughinitial}
\quad
\includegraphics[width=2.5in]{roughfinal}



model the Antarctic ice sheet

\begin{itemize}
\item with careful-but-small modifications of \texttt{siaflat.m}, which make a good exercise:
  \begin{itemize}
  \item[$\circ$] observed accumulation as surface mass balance,
  \item[$\circ$] allow non-flat bed (so $H\ne h$),
  \item[$\circ$] differentiate the surface correctly where floating, and
  \item[$\circ$] calve at current calving front location
  \end{itemize}
here are results from this \emph{toy} Antarctic flow model
\item a 2000 model year run on a $\Delta x=50$ km grid; runtime a few seconds
\end{itemize}

\includegraphics[width=2.5in]{antinitial}
\quad
\includegraphics[width=2.5in]{antfinal}

final comments on SIA: origin and rigor

where does the ``shallow ice approximation'' come from?:

\begin{itemize}
\item historically, Fowler and Larson (1978)\nocite{FowlerLarson1978}, Morland and Johnson (1980)\nocite{MorlandJohnson}, and Hutter (1983)\nocite{Hutter} \dots thus recent
\item logically, by a ``small-parameter argument'', based on a small depth-to-width ratio, from the more complete Stokes model for slow ice flow
\item more precisely, by using the small aspect ratio \, $\eps = [H]/[L]$ \, of ice sheets to scale the Stokes model to see which terms make small contributions
\end{itemize}



\section{mass continuity}

the most basic shallow assumption:

\begin{itemize}
\item there are many shallow theories: SIA, SSA, hybrids, Blatter, \dots \nocite{Blatter}
\item \emph{all} make one assumption not required in the (non-shallow) Stokes theory:

\begin{center}
\emph{the surface and base of the ice are given by differentiable functions} $z=h(t,x,y)$ \emph{and} $z=b(t,x,y)$
\end{center}
\item surface overhang is not allowed
\end{itemize}


\begin{center}
\includegraphics[width=2.5in]{sshape}
\quad
\includegraphics[width=2.5in]{Serac2}

\alert{not shallow!}
\end{center}


kinematic and mass continuity equations:

\begin{itemize}
\item what does this ``most basic shallow assumption'' get you?
\item \emph{answer:} a map-plane mass continuity equation
\item consider these three equations (\emph{on next slide}):
  \begin{itemize}
  \item[$\circ$]  the surface kinematical equation
  \item[$\circ$]  the base kinematical equation
  \item[$\circ$]  the map-plane mass continuity equation
  \end{itemize}
\item under the ``most basic shallow assumption'', 

\begin{center}\emph{any two imply the third}\end{center}
\item you connect the three equations by
  \begin{itemize}
  \item[$\circ$]  the incompressibility of ice
    $$u_x + v_y + w_z = 0$$
  \item[$\circ$]  and the Leibniz rule for differentiating integrals
  \scriptsize
    $$\frac{d}{dx}\left(\int_{g(x)}^{f(x)} h(x,y)\,dy\right) = f'(x) h(x,f(x)) - g'(x) h(x,g(x)) + \int_{g(x)}^{f(x)} h_x(x,y)\,dy$$
  \end{itemize}
\end{itemize}

\begin{itemize}
\item let $a$ be the surface mass balance function ($a>0$ is accumulation), and
\item $s$ be the basal melt rate function ($s>0$ is basal melting), so
\item $M=a-s$
\item define the map-plane flux of ice,
	$$\bq = \int_{b}^{h} (u,v)\,dz = \overline{\mathbf{u}}\,H$$
\item the three equations are:
\begin{empheq}[left=\text{surface kinematical}\quad,innerbox=\fbox]{equation}
h_t = a - u\big|_h h_x - v\big|_h h_y + w\big|_h  \label{surfkine}
\end{empheq}
\begin{empheq}[left=\text{base kinematical}\quad,innerbox=\fbox]{equation}
b_t = s - u\big|_b b_x - v\big|_b b_y + w\big|_b  \label{basekine}
\end{empheq}
\begin{empheq}[left=\text{mass continuity}\qquad\qquad\quad,innerbox=\fbox]{equation}
H_t = M - \Div \bq \label{masscontinuity}
\end{empheq}
\end{itemize}

\begin{itemize}
\item literature is full of incomplete calculations of these shallow equivalences
\item \dots usually mixed in with small-parameter arguments about shallow stress balances
\item most ice sheet models use the mass continuity equation to describe change in ice sheet geometry
\item \dots but they could instead use the surface kinematical equation
\end{itemize}

standard recipe for ice sheet models:

\begin{itemize}
\item the ingredients of a typical ice sheet model:
  \begin{enumerate}
  \item numerical implementation of a stress balance: gives velocity $(u,v,w)$
  \item from the horizontal velocity $(u,v)$ and the surface balance, do time-step of mass continuity equation to get $H_t$
  \item update upper and lower surface elevation
  \item decide on time-step, and repeat at 1.
  \end{enumerate}
\end{itemize}



\section{shelves and streams}


\subsection{shallow shelf approximation (SSA)}

flow model II: shallow shelf approximation (SSA) stress balance:
  
SSA model applies very well to \alert{ice shelves}:
\begin{itemize}
\item \dots for parts away from grounding lines
\item \dots and away from calving fronts
\end{itemize}

\begin{center}
\includegraphics[width=2.5in]{ice_shelf_edge_hg}
\quad
\includegraphics[width=2.5in]{siple}

edge of Ekstr\"om ice shelf (photo Hans Grobe) \qquad RADARSAT-derived surface velocity for Siple Coast ice streams, Antarctica
\end{center}

SSA also applies reasonably well to \alert{ice streams}:
\begin{itemize}
\item \dots with modest bed topography
\item \dots and weak bed strength\footnote{energy conservation (= ice temperature and basal melt) is a major aspect of ice stream flow \cite{Raymondenergy}, but not addressed here}
\item imperfect near shear margins and grounding lines
\end{itemize}


what is, \emph{and is not}, an ice stream?:

\begin{itemize}
\item ice streams 
  \begin{itemize}
  \item[$\circ$] slide ($100$ to $1000 \,\text{m}\,\text{a}^{-1}$)
  \item[$\circ$] concentration of vertical shear in a thin layer near base
  \item[$\circ$] \emph{liquid water} at bed plays a critical role (Clarke, 2005)\nocite{Clarke05}
  \end{itemize}
\item ``outlet glaciers''
  \begin{itemize}
  \item[$\circ$] fast surface speed (up to $10 \,\text{km}\,\text{a}^{-1}$)
  \item[$\circ$] uncertain how much is sliding
  \item[$\circ$] substantial vertical shear ``up'' in the ice column,
  \item[$\circ$] not-at-all flat bed topography
  \item[$\circ$] soft, temperate ice may play a big role
  \end{itemize} 
\item \alert{few simplifying assumptions are appropriate for outlet glaciers}
\end{itemize}

\begin{center}
\includegraphics[width=3.0in]{streamisbrae}

Cross sections of Jakobshavns Isbrae (\textbf{a}) and Whillans Ice Stream (\textbf{b}).  Plotted without vertical exaggeration.  (Figure 1 in \cite{TrufferEchelmeyer})
\end{center}

SSA stress balance equation:

\begin{itemize}
\item only plane flow case (``flow line'')
\item the stress balance equation which determines velocity in an \emph{ice stream}:
\begin{empheq}[box=\fbox]{equation}
  \left({\color{red}2 A^{-1/n} H |u_x|^{1/n - 1} u_x}\right)_x - {\color{blue}C|u|^{m-1}u} = {\color{green}\rho g H h_x} \label{ssa}
\end{empheq}
\item the {\color{red} red term} inside parentheses is the vertically-integrated ``longitudinal'' or ``membrane'' stress
\item the {\color{blue} blue term} is basal resistance
\item the {\color{green} green term} is  driving stress
\item derived originally by \cite{Morland,MacAyeal}
\item \emph{how to think about this equation}?
\item \emph{how do you solve it numerically}?
\end{itemize}

flow line model: from stream to shelf:
\begin{align*}
  u = u_0 & \qquad \text{ at } x = 0 \\
  \left.\begin{array}{r}
  \left(2 A^{-1/n} H |u_x|^{1/n - 1} u_x\right)_x - C|u|^{m-1}u = \rho g H h_x \\
  h = H + b
  \end{array}\right\}& \qquad \text{ on } 0 < x < x_g \\
  \left.\begin{array}{r}
  \left(2 A^{-1/n} H |u_x|^{1/n - 1} u_x\right)_x + 0 = \rho g H h_x \\
  h = (1-\rho/\rho_w) H
  \end{array}\right\}& \qquad \text{ on } x_g < x < x_c \\
  2 A^{-1/n} H |u_x|^{1/n - 1} u_x = \frac{1}{2}\rho (1-\rho/\rho_w) g H^2 & \qquad \text{ at } x = x_c
\end{align*}


flotation criterion and grounding line:

\begin{itemize}
\item the inequality ``$\rho H < - \rho_w b$'' is the \alert{flotation criterion}
\item at the grounding line $x=x_g$ the above inequality switches
\item \dots and the driving stress switches form:
  \begin{itemize}
  \item[$\circ$] on the grounded side we know $\rho H > - \rho_w b$ so
  	$$\rho g H h_x = \rho g H (H_x + b_x)$$
  \item[$\circ$] on the floating side we know $\rho H < - \rho_w b$ so $h = (1-\rho/\rho_w) H$ and so
  	$$\rho g H h_x = \rho(1-\rho/\rho_w) g H H_x$$
  \end{itemize}
\item also: $H,u,u_x$ are all continuous at $x=x_g$
\item best numerical models for moving grounding lines still an open question (e.g.~MISMIP and all that)
\end{itemize}


\subsection{ice shelf flow line solution}

exact velocity and thickness for steady ice shelf:
\begin{itemize}
\item limited goal here: describe a steady state, 1D ice shelf
\item there is this nice \alert{by-hand} result (next slide): the thickness and velocity in the ice shelf can be completely determined \cite{MacAyealBarcilon,vanderVeen83} in terms of the 
  \begin{enumerate}
  \item ice thickness $H_g$ at the grounding line and
  \item ice velocity $u_g$ at the grounding line
  \end{enumerate}
\item we will use this to
  \begin{itemize}
  \item[$\circ$] understand the SSA better
  \item[$\circ$] verify a numerical SSA code
  \end{itemize}
\end{itemize}

see \texttt{testshelf.m} 

\begin{center}
  \includegraphics[width=3.0in]{steadyshelf} \hfill \includegraphics[width=2.5in]{Rocket_nozzle_expansion}
\end{center}


\subsection{numerical SSA}

numerically solving the SSA stress balance:
\begin{itemize}
\item here we fix ice thickness $H(x)$ and find the velocity numerically
\item the stress balance is a nonlinear equation in the velocity:
  $$\left(2 A^{-1/n} H |u_x|^{1/n - 1} u_x\right)_x - C|u|^{m-1}u = \rho g H h_x$$
\item \alert{iteration is needed}
\item I'll describe the numerical method for a shelf \emph{or} stream, but only give a code for an ice shelf
\end{itemize}

\begin{itemize}
\item coefficient ${\color{red} \bar \nu} = A^{-1/n} |u_x|^{1/n-1}$ is the ``effective viscosity'':
   $$\left(2 \,{\color{red} \bar \nu}\, H u_x\right)_x - C |u|^{m-1} u = \rho g H h_x$$
\item \emph{simplest iteration idea}: use old effective viscosity to get new velocity solution, and repeat until things stop changing
  \begin{itemize}
  \item[$\circ$] this is ``Picard'' iteration
  \item[$\circ$] Newton iteration is a superior alternative
  \end{itemize}
\item specifically:
  \begin{itemize}
  \item[$\circ$] last iterate $u^{(k-1)}$
  \item[$\circ$] define $W^{(k-1)} = 2 \bar \nu H = 2 A^{-1/n} |u^{(k-1)}_x|^{1/n-1} H$
  \item[$\circ$] current iterate (unknown) $u^{(k)}$
  \item[$\circ$] solve repeatedly:
     $$\left(W^{(k-1)} u^{(k)}_x\right)_x - C |u^{(k-1)}|^{m-1} u^{(k)} = \rho g H h_x$$
  \end{itemize}
\end{itemize}

solving the ``inner'' linear problem:
\begin{itemize}
\item abstract the problem:
   $$\left(W(x)\, u_x\right)_x - \alpha(x)\, u = \beta(x)$$
on $0 < x < L$, with boundary conditions
   $$u(0) = V, \qquad  u_x(L) = \gamma$$
\item an \emph{elliptic} PDE boundary value problem
\item $W(x)$, $\alpha(x)$, $\beta(x)$ are known functions in the SSA context:
  \begin{itemize}
  \item[$\circ$] both $W(x)$ and $\alpha(x)$ come from previous iteration
  \item[$\circ$] $\beta(x)$ is driving stress
  \end{itemize}
\end{itemize}

where do you get an initial guess $u^{(0)}$?:

\begin{itemize}
\item \emph{for floating ice}, a possible initial guess for velocity comes from assuming a uniform strain rate:
   $$u^{(0)}(x) = \gamma (x-x_g) + u_g$$
where $\gamma$ is the value of $u_x$ found from calving front stress imbalance
\item \emph{for grounded ice}, a possible initial guess for velocity is to assume ice is held by basal resistance only:
   $$u^{(0)}(x) = \left(-C^{-1} \rho g H h_x\right)^{1/m}$$
\end{itemize}

numerics of the ``inner'' linear problem:

\begin{itemize}
\item suppose $j=1,2,\dots,J+1$, where $x_1 = x_g$ and $x_{J+1} = x_c$ are endpoints
\item $W(x)$ is needed on the staggered grid; the approximation is:
$$\frac{W_{j+1/2} (u_{j+1} - u_j) - W_{j-1/2} (u_{j} - u_{j-1})}{\Delta x^2} - \alpha_j u_j \stackrel{\ast}{=} \beta_j$$
\item left-hand boundary condition: $u_1 = V$ given
\item right-hand boundary condition (``$u_x(L)=\gamma$''):
  \begin{itemize}
  \item[$\circ$] introduce notional point $x_{J+2}$
  \item[$\circ$]
    $$\frac{u_{J+2} - u_J}{2 \Delta x} = \gamma$$
  \item[$\circ$] using equation $\ast$ in $j=J+1$ case, eliminate $u_{J+2}$ variable ``by-hand'' before coding numerics \nocite{MortonMayers}
  \end{itemize}
\end{itemize}

\begin{itemize}
\item so SSA stress balance has form  \quad $A \mathbf{x} = \mathbf{b}$, \quad namely:
$$
\begin{bmatrix}
1 &  &  &  &  \\
W_{3/2} & A_{22} & W_{5/2} &  &  \\
 & W_{5/2} & A_{33} &  &  \\
 &  & \ddots & \ddots &  \\
 &  & W_{J-1/2} & A_{JJ} & W_{J+1/2} \\
 &  &  & A_{J+1,J} & A_{J+1,J+1} \\
\end{bmatrix}\,
\begin{bmatrix}
u_1 \\ u_2 \\ u_3 \\ \vdots \\ u_J \\ u_{J+1}
\end{bmatrix}
=
\begin{bmatrix}
0 \\ \beta_2 \Delta x^2 \\ \beta_3 \Delta x^2 \\ \vdots \\ \beta_J \Delta x^2 \\ b_{J+1}
\end{bmatrix}
$$
\item with diagonal entries
$$A_{22} = -(W_{3/2}+W_{5/2}+\alpha_1 \Delta x^2)$$
$$A_{33} = -(W_{5/2}+W_{7/2}+\alpha_2 \Delta x^2)$$
and so on, up to $A_{JJ}$, 
\item with special cases in last equation:
$$A_{J+1,J} = 2 W_{J+1/2}$$
$$A_{J+1,J+1} = -(2 W_{J+1/2}+\alpha_{J+1}\Delta x^2)$$
$$b_{J+1} = -2 \gamma \Delta x W_{J+3/2} + \beta_{J+1} \Delta x^2$$
\item this is a \emph{tridiagonal} system
\end{itemize}

\minput{flowline}

testing the ``inner'' linear code

\begin{itemize}
\item before proceeding to solve nonlinear SSA problem, we can test the ``abstracted'' code \texttt{flowline.m}
\item test by ``manufacturing'' solutions
  \begin{itemize}
  \item[$\circ$] see \texttt{testflowline.m}; not shown
  \end{itemize}
\item results:
  \begin{itemize}
  \item[$\circ$] converges at optimal rate $O(\Delta x^2)$
  \end{itemize}
\end{itemize}

numerical: SSA:

\minput{ssaflowline}

\emph{numerical} thickness and velocity for steady ice shelf:

lines below are a convergence analysis of \texttt{testshelf.m}, which calls \texttt{ssaflowline.m}:

\begin{center}
  \includegraphics[width=3.0in]{shelfconv}
\end{center}

realistic ice shelf modeling:

\begin{itemize}
\item flow lines are never very realistic
\item you can add ``side drag'' \dots but I don't really know how to parameterize it
\item also, ice shelves have surprises:
  \begin{itemize}
  \item[$\circ$] high basal melt near grounding lines
  \item[$\circ$] marine ice can freeze-on at bottom (below)
  \item[$\circ$] ``reverse slope'' bed instability and WAIS \dots
  \end{itemize}
\end{itemize}

\medskip
\begin{center}
  \includegraphics[width=3.0in]{marineice}
  
from Grosfeld \& Thyssen 1994 \nocite{GrosfeldThyssen1994}
\end{center}

ice shelf modeling in 2D:

\begin{itemize}
\item ``diagnostic'' (static geometry) ice shelf modeling in two horizontal variables has been quite successful
\item observed surface velocities should validate stress balance models
  \begin{itemize}
  \item[$\circ$] Ross ice shelf example below using PISM
  \item[$\circ$] \dots but many models can do this (MacAyeal et al 1996\nocite{MacAyealetal})
  \end{itemize}
\end{itemize}

\begin{center}
  \includegraphics[width=2.5in]{rossquiver}
  \quad
  \includegraphics[width=2.5in]{rossscatter}
\end{center}

numerical solution of stress balances: a summary

\begin{itemize}
\item stress balance equations (e.g.~SSA) determine horizontal velocity from geometry and boundary conditions
  \begin{itemize}
  \item[$\circ$] nonlinear so iteration is necessary
  \item[$\circ$] at each iteration a sparse matrix ``inner'' problem is solved
  \item[$\circ$] give the ``inner'' problem to a matrix solver software package
  \end{itemize}
\item general principles: \emph{modularize your code} and \emph{test the parts}
\end{itemize}

the mass continuity equation: a summary:

\begin{itemize}
\item the \emph{mass continuity equation} is
  $$H_t = M - \nabla \cdot (\mathbf{u} H)$$
\item the numerical nature of this equation depends on the stress balance:
  \begin{itemize}
  \item[$\circ$] the equation is a diffusion for frozen bed, large scale flows (i.e.~SIA)
  \item[$\circ$] it is \emph{not} very diffusive for membrane stresses and no basal resistance (e.g.~SSA for ice shelves)
  \item[$\circ$] it is significantly diffusive for ice streams (but how much?)
  \item[$\circ$] there is not much helpful theory on to solve this transport problem
  \item[$\circ$] maybe \emph{you} will help find this theory!
  \end{itemize}
\end{itemize}


\section{next steps}

\subsection{practicalities}

technical skills for numerical ice sheet modeling:

\begin{itemize}
\item comfort in a technical computing environment; need to know:
  \begin{itemize}\small
  \item[$\circ$] an editor,
  \item[$\circ$] a scripting/prototyping language (Matlab, Python, etc.),
  \item[$\circ$] a compiled language (C or Fortran),
  \item[$\circ$] \emph{a version control system} (Subversion, git, etc.), and
  \item[$\circ$] some tools for NetCDF files
  \normalsize
  \end{itemize}
\item willingness to read math, numerical analysis, computer science, etc.
\item \emph{physics}
\item \emph{never} re-invent the wheel for basic numerics like these:
  \begin{itemize}
  \item[$\circ$] numerical linear algebra
  \item[$\circ$] mesh generation, finite element assembly and solve
  \item[$\circ$] \dots \emph{except} to write throw-away codes to help you understand numerical ideas 
  \end{itemize}
\item try existing ice flow models:
  \begin{itemize}
  \item[$\circ$] open source SIA-based comprehensive models: GLIMMER, SICOPOLIS
  \item[$\circ$] open source hybrid/higher-order/Stokes models: PISM, Elmer, ISSM
  \end{itemize}
\item ice sheet modeling is young, and much to do!
\end{itemize}


\subsection{some omitted models}

thermomechanical coupling:

\begin{itemize}
\item ice softness $A(T)$ varies by $10^3$ in relevant temperature range
\end{itemize}

\includegraphics[width=3.0in]{AofT}


\begin{itemize}
\item ice thermal state (temperature) gives ice sheet flows their ``long memory'' of past climate
\item dissipation of gravitational potential energy is major part of basal melt
  \begin{itemize}
  \item[$\circ$] each year, Jakobshavn drainage basin in Greenland dissipates enough gravitational potential energy to melt $> 1\,\text{km}^3$ of ice
  \item[$\circ$] geothermal flux also significant in slow parts
  \end{itemize}
\item so good ice sheet models need conservation of energy
  \begin{itemize}
  \item[$\circ$] ``enthalpy'' is good way to track energy content polythermally (Aschwanden et al.~2012)\nocite{AschwandenBuelerKhroulevBlatter}
  \end{itemize}
\end{itemize}

solid Earth deformation:

\begin{itemize}
\item ice density is about $\frac{1}{3}$ that of rock in the Earth's mantle,
  \begin{itemize}
  \item[$\circ$] 1000 m of ice depresses the Earth's crust about 300 m
  \item[$\circ$] \dots if allowed enough time
  \item[$\circ$] how much time is determined by \emph{upper mantle viscosity}
  \item[$\circ$] \dots which is not perfectly known
  \end{itemize}
\item Earth deformation changes bed topography and thus ice flow
\item modeling Earth deformation is most important to modeling ice flow over long time scales (Peltier, 1998)\nocite{Peltier1998review}
\end{itemize}

\begin{center}
  \includegraphics[width=3.0in]{earthcompare}
\end{center}

spin-up:

\begin{itemize}
\item direct observations are not enough to initialize an ice sheet flow model
  \begin{itemize}
  \item[$\circ$] because ice temperature is a ``hidden variable'', and
  \item[$\circ$] because sliding depends on additional liquid water ``hidden variables'' at base
  \end{itemize}
\item two options exist to initialize:
  \small
  \begin{enumerate}
  \item \emph{traditional choice}: use low-dimensional time series data from physical surrogates (e.g. $\delta \phantom{|}^{18}O$ record from ice cores) for paleoclimate record; hope a long model run ends with a good current state
  \item \emph{promising alternative}:  use rich and spatially-distributed mostly-surface observations of present ice sheet state to reconstruct initial state using ``inversion'' of PDEs
  \normalsize
  \end{enumerate}
\end{itemize}

inverse modeling:

\begin{itemize}
\item stress balance PDEs can turn extra boundary data on top into missing basal information
\item surface velocity observations can be inverted to find basal shear stress (below)
\item mostly future: invert radar layers (isochrones)
\end{itemize}

\begin{center}
  \includegraphics[width=3.0in]{NEgreenlandJoughin}
  
from Joughin et al.~(2001)\nocite{Joughinetal2001}
\end{center}

Stokes equations and solvers:

\begin{itemize}
\item the Stokes model itself, without shallow assumptions, can be solved numerically, \alert{but}:
  \begin{itemize}
  \item[$\circ$] many equations in many unknowns, especially in 3D
  \item[$\circ$] requires explicit accounting for incompressibility---a constraint on the flow---through a pressure variable
  \item[$\circ$] ice sheets are \emph{actually} shallow, and the aspect ratio of grid elements can be a problem
  \end{itemize}
\item much of the success so far is at a smaller scale
\end{itemize}

\begin{center}
\includegraphics[width=3.0in]{athabasca}

Figure 7 in \cite{Maxwelletal2008}:  velocity contour lines ($\text{m}\,\text{a}^{-1}$) for Athabasca Glacier from \textbf{a} Stokes model, \textbf{b} measurements \cite{Raymond1971}
\end{center}

``higher-order'' schemes:

\begin{itemize}
\item both the SIA and the SSA are derived by small-parameter arguments from the Stokes equations, so \dots is there a \emph{common shallow antecedent model}?
\item Schoof and Hindmarsh (2009)\nocite{SchoofHindmarsh} answer:  \emph{yes}, the model derived by Blatter (1995)\nocite{Blatter} is an intermediate model
\item a hierarchy:
\end{itemize}

\begin{center}
\includegraphics[width=0.8\textwidth]{hierarchy}
\end{center}

shallow hybrid schemes:

\begin{itemize}
\item so how about ``gluing together'' SIA and SSA?
\item there are multiple schemes for hybridization (Pollard and deConto, 2007\nocite{PollardDeConto}; Bueler and Brown, 2009\nocite{BBssasliding}; Goldberg 2011\nocite{Goldberg2011})
\item shallow hybrids can be used \emph{now} at high spatial resolution and paleoglacial time scales
\item for example, we can compare observed (left) and 1km grid modeled (middle and right; model=PISM) surface velocity maps for the Greenland ice sheet
\end{itemize}

\begin{center}
\includegraphics[width=5.0in]{csurf_insar_pism_1km}
\end{center}


%         References
\clearpage\newpage
\bibliography{ice_bib}
\bibliographystyle{siam}

\end{document}