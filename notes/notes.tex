\documentclass[titlepage,a4paper,final,12pt]{scrartcl}
\usepackage[total={6.2in,9.4in},top=1.2in,left=1.05in]{geometry}

%\documentclass[titlepage,letterpaper,final,12pt]{scrartcl}
%\usepackage[total={6.2in,9.0in},top=1.1in,left=1.2in]{geometry}

% this lets us avoid the scrartcl/hyperref conflict...
%\let\ifvtex\relax

\usepackage{verbatim}
\usepackage{empheq}
\usepackage[dvipsnames]{xcolor}
\usepackage{animate}
\usepackage{graphicx}
\usepackage{fancyvrb}

% hyperref should be the last package we load
\usepackage[pdftex,
colorlinks=true,
plainpages=false, % only if colorlinks=true
linkcolor=blue,   % only if colorlinks=true
citecolor=blue,   % only if colorlinks=true
urlcolor=blue     % only if colorlinks=true
]{hyperref}

\pdfinfo{
/Title (Numerical modelling of ice sheets, streams, and shelves)
/Author (Ed Bueler)
/Subject (numerical modelling of ice sheets)
/Keywords (numerical modelling, numerical analysis, glacier, ice sheet, ice shelf, shallow models of ice flow)
}

\newcommand{\ddt}[1]{\ensuremath{\frac{\partial #1}{\partial t}}}
\newcommand{\ddx}[1]{\ensuremath{\frac{\partial #1}{\partial x}}}
\newcommand{\ddy}[1]{\ensuremath{\frac{\partial #1}{\partial y}}}
\newcommand{\pp}[2]{\ensuremath{\frac{\partial #1}{\partial #2}}}
\renewcommand{\t}[1]{\texttt{#1}}
\newcommand{\Matlab}{\textsc{Matlab}\xspace}
\newcommand{\bq}{\mathbf{q}}
\newcommand{\bu}{\mathbf{u}}
\newcommand{\bU}{\mathbf{U}}
\newcommand{\eps}{\epsilon}
\newcommand{\grad}{\nabla}
\newcommand{\Div}{\nabla\cdot}
\newcommand{\devstress}{\tau}

\newcommand{\mmess}[1]{\vspace{-0.1in}\begin{center}
\fbox{\url{http://www.dms.uaf.edu/~bueler/mccarthy/mfiles/#1.m}}
\end{center}}

\newcommand{\minput}[1]{
\bigskip
\begin{quote}
\bigskip
\VerbatimInput[frame=single,framesep=3mm,label=\fbox{\normalsize \textsl{\,#1.m\,}},fontfamily=courier,fontsize=\scriptsize]{../mfiles/#1.slim.m}
\bigskip
\end{quote}
}

%\onefigsize{name}{caption}{width}
\newcommand{\onefigsize}[3]{
\begin{figure}[ht]
\centering
\includegraphics[width=#3,keepaspectratio=true]{#1}
\caption{#2}
\label{fig:#1}
\end{figure}}

%\onefig{name}{caption}
\newcommand{\onefig}[2]{\onefigsize{#1}{#2}{3.0in}}

%\twofigsizes{left-name}{right-name}{caption}{left-width}{right-width}
\newcommand{\twofigsizes}[5]{
\begin{figure}[ht]
\centering
\includegraphics[width=#4,keepaspectratio=true]{#1} \quad
\includegraphics[width=#5,keepaspectratio=true]{#2}
\caption{#3}
\label{fig:#1}
\end{figure}}

%\twofig{left-name}{right-name}{caption}
\newcommand{\twofig}[3]{\twofigsizes{#1}{#2}{#3}{2.5in}{2.5in}}


\begin{document}
\graphicspath{{../photos/}{../pdffigs/}}

\begin{titlepage}

  \begin{center}
    {\Large\usekomafont{title} Numerical modelling \\ of ice sheets, streams, and shelves}
    \vspace{0.5cm}

    {\large Ed Bueler}
    \vspace{1cm}

    Karthaus, September 2012

    \vfill
    
    \includegraphics[width=6.0in]{flowline}
  
    \scriptsize \emph{Illustrates the notation used in this chapter.  Figure modified from \cite{SchoofMarine1}.} \normalsize
    
    \vspace{2.0in}
  \end{center}
\end{titlepage}

\clearpage\newpage

\setcounter{section}{1}
\subsection{Introduction}

Numerical models can actually help you, the reader, understand the behavior of particular ice flows.  Their most common use may be to help you ask: When I put together my incomplete understanding of glacier processes into a mathematical model, does the combination behave as I expect?  Or why does it mis-behave?  Though numerical models rarely generate new theoretical understandings---a human brain seems to be needed to get new insights from observations---they can demonstrate flaws in our understanding of glacier processes, and they can illuminate how these processes combine to give overall behavior.

Numerical models should be built with care.  The worst outcome is to spend time explaining, through physical argumentation and using observational evidence, numerical model behavior that is an artifact of poor computer programming or numerical analysis.  The reader of this chapter may be surprised that a continuum model, and not a code, seems to be our focus much of the time.  All numerical codes produce numbers, but we want numbers that actually come from our continuum model.  We analyse numerical implementations to see if they match the continuum model and its solutions.

This chapter has a limited scope:
  \begin{quote}\emph{shallow approximations of ice flow.}\end{quote}
It adopts a constructive approach:
  \begin{quote}\emph{example numerical codes that actually work.}\end{quote}
Within our scope are the shallow ice approximation (SIA) in two horizontal dimensions (2D), the shallow shelf approximation (SSA) in 1D, and the mass continuity and surface kinematical equations.  We recall the Stokes model, but we do not address its numerical solution.  Our numerical ideas include finite difference schemes, solving algebraic systems from stress balances, and the verification of codes using exact solutions.

Our notation is common in the glaciological literature (Table \ref{tab:notation}).  Coordinates are $t,x,y,z$, with $z$ perpendicular to the geoid and positive-upward.  If these coordinates appear as subscripts then they denote partial derivatives: $u_x = \partial u/\partial x$.  Tensor notation uses subscripts from the list $\{1,2,3,i,j\}$, so that, for example, $\tau_{ij}$ and $\tau_{13}$ are entries of the deviatoric stress tensor.

This chapter is based on sixteen Matlab codes, each about one-half page, of which only five are printed in this text.  All have been tested in Matlab and Octave.  They are distributed in \texttt{.zip} form at
\begin{quote}
\fbox{\url{http://www.dms.uaf.edu/~bueler/karthaus/}}
\end{quote}
\noindent When displayed in these notes these codes have their comments stripped for compactness and clarity.  The electronic versions have generous comments and help files.

\begin{table}[ht]
\caption{Notation used in this chapter.}
\begin{tabular}{cll}
variable  & description & SI units \\ 
\hline
$A$ & $A=A(T)=$ ice softness in the Glen flow law & $\text{Pa}^{-n}\,\text{s}^{-1}$ \\
$B$ & ice hardness; $B=A^{-1/n}$ & $\text{Pa}\,\text{s}^{1/n}$ \\
$b$ & bedrock elevation & m \\
$\nabla$ & (spatial) gradient & m$^{-1}$ \\
$\nabla\cdot$ & (spatial) divergence & m$^{-1}$ \\
$\mathbf{g}$ & gravity & m s$^{-2}$ \\
$H$ & ice thickness & m \\
$h$ & ice surface elevation & m \\
$M$ & climatic mass balance & m s$^{-1}$ \\
$n$ & exponent in Glen flow law & \\
$\nu$ & viscosity & Pa s \\
$p$ & pressure & Pa \\
$\bq$ & map-plane ice flux: $\bq = \int_{b}^{h} \bU\,dx = \bar{\bU} H$ & $\text{m}^2\,\text{s}^{-1}$ \\
$\rho$ & density of ice & kg m$^{-3}$ \\
$\rho_w$ & density of sea water & kg m$^{-3}$ \\
$T$ & temperature & K \\
$\tau$ & magnitude of $\tau_{ij}$: $2 \tau^2 = \sum_{ij} \tau_{ij}^2$ & Pa \\
$\tau_{ij}$ & deviatoric stress tensor & Pa \\
$Du_{ij}$ & strain rate tensor & s$^{-1}$ \\
$\mathbf{U}$ & $=(u,v)$ horizontal ice velocity & m s$^{-1}$ \\
$\mathbf{u}$ & $=(u,v,w)$ 3D ice velocity & m s$^{-1}$ \\
\end{tabular}
\label{tab:notation}
\end{table}


\subsection{Ice flow equations}

My first goal in these notes is to get to an equation for which I can say:
\begin{center}
\emph{by numerically solving this equation, we have a usable model for an ice sheet.}
\end{center}
\noindent Of course a ``usable'' model is \emph{understood} as much as it is \emph{correct}.  To get to my goal I will quickly recall the continuum mechanical equations of ice flow.  

Ice in glaciers is a fluid, so we describe its motion by a velocity field $\mathbf{u}(t,x,y,z)$.  If the ice fluid were faster-moving than it actually is, and if it were linearly-viscous like liquid water, then it would be a ``typical'' fluid.  We would use the Navier-Stokes equations as the model:
\begin{align}
\nabla \cdot \mathbf{u} &= 0 &&\text{\emph{incompressibility}} \label{incompressible} \\
\rho \left(\mathbf{u}_t + \mathbf{u}\cdot\nabla \mathbf{u}\right) &= -\nabla p + \nabla \cdot (\nu \nabla \mathbf{u}) + \rho \mathbf{g} &&\text{\emph{stress balance}} \label{navierstokes}
\end{align}
In Equation \eqref{navierstokes} the term $\mathbf{u}_t + \mathbf{u}\cdot\nabla \mathbf{u}$ is an acceleration.  The right-hand side is the total stress, and the equation says ``$ma=F$'', i.e.~Newton's second law.

Numerical ice flow modelling is a topic in computational fluid dynamics.  Ice sheets are a large scale fluid problem like atmosphere and ocean circulation in climate systems.  But ice flow is an odd one!  Consider some topics which might make ocean circulation modelling exciting, for example:
  \begin{center} turbulence \qquad convection \qquad  coriolis force  \qquad stratification
  \end{center}
None of these topics are relevant to ice flow.  What could be interesting about the flow of slow, laminar, boring old ice?

We first observe that ice is a slow, shear-thinning fluid.  In terms of equations, ``slow'' means $\rho \left(\mathbf{u}_t + \mathbf{u}\cdot\nabla \mathbf{u}\right) \approx 0$, which says that the forces of inertia are negligible.  ``Shear-thinning'' flows have specific non-Newtonian behavior in which larger strain rate implies smaller viscosity.  The viscosity $\nu$ in \eqref{navierstokes} is not constant so we add an empirical flow law.

Thus the standard model for isothermal flow is this set of Stokes equations:
\begin{align}
\nabla \cdot \mathbf{u} &= 0 &&\text{\emph{incompressibility}} \label{incompressibleagain} \\
0 &= - \nabla p + \nabla \cdot \tau_{ij} + \rho \mathbf{g} &&\text{\emph{stress balance}} \label{forcebalance} \\
Du_{ij} &= A \tau^2 \tau_{ij} &&\text{\emph{$n$=3 Glen flow law}} \label{flowlaw}
\end{align}
In the flow law, the deviatoric stress tensor $\tau_{ij}$ and the strain rate tensor $Du_{ij}$ appear; previous lectures cover these.  Here we merely note that each tensor in \eqref{flowlaw} has trace zero and that $2\,Du_{ij} = (u_i)_{x_j}+(u_j)_{x_i}$ (denoting $x_1,x_2,x_3=x,y,z$).

The Stokes equations do not contain a time derivative.  Therefore geometry, boundary stresses, and ice softness together determine the velocity and stress fields (i.e.~$\bu$, $p$, $\tau_{ij}$) instantaneously.  Indeed, ice flow simulation codes have no memory of momentum or velocity, and velocity is a ``diagnostic'' output which is not needed for restarting a simulation.


\subsubsection*{Slab-on-a-slope}  Consider now the $x,z$-plane flow case of equations \eqref{incompressibleagain}, \eqref{forcebalance}, and \eqref{flowlaw}.  ``Plane flow'' means that velocity component $v$ is zero and that all derivatives with respect to $y$ are zero:
\begin{empheq}[]{align}
u_x + w_z &= 0 &&\text{\emph{incompressibility}} \label{incompressiblexz} \\
p_x &= \tau_{11,x} + \tau_{13,z} &&\text{\emph{stress balance} ($x$)} \label{stokespx} \\
p_z &= \tau_{13,x} - \tau_{11,z} - \rho g &&\text{\emph{stress balance} ($z$)} \label{stokespz} \\
u_x &= A \tau^2 \tau_{11} &&\text{\emph{flow law} (diagonal)}  \label{forceflowx} \\
u_z + w _x &= 2 A \tau^2 \tau_{13} &&\text{\emph{flow law} (off-diagonal)} \label{forceflowz}
\end{empheq}
Note that $\tau_{13}$ is a ``vertical'' shear stress while $\tau_{11}$ and $\tau_{33}=-\tau_{11}$ are deviatoric longitudinal stresses.  Also $\tau = (\tau_{11}^2+\tau_{13}^2)^{1/2}$ in this case.  This is a system of five nonlinear equations in five scalar unknowns ($u,w,p,\tau_{11},\tau_{13}$).

This is complicated enough to make us pause before jumping in to numerical solution methods.  Can we handle a simplified situation?  Our first example, a uniform slab or a ``slab-on-a-slope'', is both a case in which we actually solve the Stokes equations, and a motivation for the shallow model in the next subsection.

\onefig{slab}{Rotated axes for a slab-on-a-slope flow calculation.}

We rotate our coordinates only for this example and not elsewhere in these notes.  The two-dimensional axes ($x$,$z$) shown in Figure \ref{fig:slab} are rotated downward at angle $\alpha>0$ so that the gravity vector has components $\mathbf{g} = (g \sin\alpha,- g \cos \alpha)$.  Equations \eqref{stokespx}, \eqref{stokespz}, in these rotated coordinates, are
\begin{align}
p_x &= \tau_{11,x} + \tau_{13,z} + \rho g \sin\alpha, \label{stokespxrot} \\
p_z &= \tau_{13,x} - \tau_{11,z} - \rho g \cos\alpha. \label{stokespzrot}
\end{align}
By now assuming additionally that there is no variation with $x$, the whole set of Stokes equations \eqref{incompressiblexz}, \eqref{forceflowx}, \eqref{forceflowz}, \eqref{stokespxrot}, \eqref{stokespzrot} simplifies greatly:
\begin{align*}
w_z &= 0 &   0 &= \tau_{11} \\
\tau_{13,z} &= - \rho g \sin\alpha &   u_z &= 2 A \tau^2 \tau_{13} \\
p_z &= - \rho g \cos\alpha
\end{align*}
We apply boundary conditions for these functions of $z$:
	$$w(0)=0, \qquad p(H)=0, \qquad u(0)=u_0.$$
The basal velocity $u_0$ will remain undetermined for now.  By integrating vertically, we get $w=0$, $p = \rho g \cos\alpha (H-z)$, and $\tau_{13} = \rho g \sin\alpha (H-z)$.  Note that $H-z$ is the depth within the ice and that both the pressure $p$ and shear stress $\tau_{13}$ are linear in depth.

By integrating vertically again we find a formula for the horizontal velocity,
\begin{align}
u &= u_0 + 2 A (\rho g \sin\alpha)^3 \int_0^z (H-z')^3\,dz' \notag \\
  &= u_0 + \frac{1}{2} A (\rho g \sin\alpha)^3  \left(H^4 - (H-z)^4\right)  \label{uslab}
\end{align}
Do we believe formula \eqref{uslab}?  Figure \ref{fig:slabvel} compares to observations of a mountain glacier.  This comparison shows we have done a credible job of capturing deformation flow velocity, though we do not yet have a model for the sliding velocity $u_0$ (i.e.~basal motion).  

\twofigsizes{slabvel}{athabasca_deform}{Left:  Velocity from slab-on-a-slope formula \eqref{uslab}.  Right:  Velocity in a mountain glacier (Athabasca Glacier, Canada), from inclinometry \cite{SavagePaterson}.}{2.0in}{1.8in}

Now that we have calculated the velocity $u$, so what?  The equations so far do not address the change in shape of the glacier or ice sheet.  For this we need another equation, the \emph{mass continuity equation}.  To explain it, define the vertical average of velocity:
	$$\bar u = \frac{1}{H}\int_0^{H} u\,dz.$$
The flux $q=\bar u\, H$ is the rate of flow input into a side of the area in Figure \ref{fig:slabmasscontfig}.  Now, how does the ice area $A$ in the figure change?\footnote{In three-dimensions it would be ``how does the ice volume change?''}  We add the contributions around the edges,
	$$\frac{dA}{dt} = \int_{x_1}^{x_2} M(x)\,dx + \bar u_1 H_1 - \bar u_2 H_2$$
If the width $\Delta x=x_2-x_1$ is small then $A\approx \Delta x\, H$.  So we divide by $\Delta x$, take $\Delta x \to 0$, and get
\begin{equation}
H_t = M - \left(\bar u H\right)_x \label{masscont1D}
\end{equation}
This mass continuity equation describes the change in the ice thickness in terms of surface mass balance and ice velocity.  This is the most common ``use'' of the velocity in ice flow simulations.

\onefigsize{slabmasscontfig}{Mass continuity equation \eqref{masscont1D} follows from considering the changing area $A$ of ice in a planar flow.  Ice can be added at the top by mass balance $M$, but a difference of flux $q=\bar u H$ into left and right sides also changes $A$.}{2.5in}


\subsection{Shallow ice sheets}

Our slab-on-a-slope example gives us a rough explanation of the shallow ice approximation (SIA), which is a model we will apply more generally.  To complete it, vertically integrating velocity formula \eqref{uslab} in the $u_0=0$ (non-sliding) case gives
\begin{equation}
\bar u H = \int_0^H \frac{1}{2} A (\rho g \sin\alpha)^3  \left(H^4 - (H-z)^4\right)\,dz = \frac{2}{5} A (\rho g \sin\alpha)^3 H^5. \label{siaubar}
\end{equation}
Note $\sin \alpha \approx \tan\alpha = - h_x$.  Combining these statements with mass continuity \eqref{masscont1D} gives
\begin{equation}
  H_t = M + \left(\frac{2}{5} (\rho g)^3 A H^5 |h_x|^2 h_x\right)_x. \label{sia1D}
\end{equation}

Equation \eqref{sia1D} is the SIA equation for nonsliding plane flow.  It determines the evolution of an ice sheet's shape in terms of mass balance, ice softness, and bed elevation.  Additional arguments (not shown) are needed to demonstrate that the SIA is ``general purpose'' and not special to a simple slab.  Such arguments reduce the Stokes equations under the assumption that the surface and bed slopes, and the depth-to-width ratio, are small; see Notes and References.  We will numerically solve \eqref{sia1D} in section \ref{sec:numericalsia}.  First we state it in two horizontal dimensions and attempt to understand it better.

\subsubsection*{Understanding the shallow ice approx (SIA)}  Ice sheets have four outstanding properties as fluids.  They are (\emph{i}) slow, (\emph{ii}) shallow,  (\emph{iii}) non-Newtonian, and (\emph{iv}) they experience some contact slip (basal sliding).  The first ice flow model we consider, the non-sliding, isothermal SIA, accounts for (\emph{i})--(\emph{iii}).

Regarding property (\emph{ii}), Figure \ref{fig:green_transect} shows a no-vertical-exaggeration cross-section of Greenland at $71^\circ$, as well as the standard vertically-exaggerated version which is more familiar in the glaciological literature.  Thus: Remember that ice sheets are shallow.

\onefig{green_transect}{A vertically-exaggerated cross-section of the Greenland ice sheet ($71^\circ$ N) is shown by the green and blue curves.  Without exaggeration it appears as a horizontal line (red).}

The SIA uses the formulas from slab-on-a-slope, generalized to two horizontal dimensions.  Let $\mathbf{U} = (u,v)$ be the vector horizontal velocity.  The shear stress approximation is $(\tau_{13},\tau_{23}) \approx - \rho g (h-z) \nabla h$, which becomes an equality in the SIA.  From Equation \eqref{flowlaw}, a further approximation of shear strain rates gives the SIA formula
\begin{equation*}
\mathbf{U}_z = 2 A |(\tau_{13},\tau_{23})|^{n-1} (\tau_{13},\tau_{23}) = - 2 A (\rho g)^n (h-z)^n |\nabla h|^{n-1} \nabla h.
\end{equation*}
By integrating vertically we get, in the non-sliding case,
\begin{equation}
\mathbf{U} = - \frac{2 A (\rho g)^n}{n+1} \left[H^{n+1} - (h-z)^{n+1}\right] |\nabla h|^{n-1} \nabla h.  \label{siavelocity}
\end{equation}

Mass continuity in two horizontal dimensions, which generalizes the 1D version \eqref{masscont1D}, also applies:
\begin{equation}
    H_t = M - \Div\left(\bar{\mathbf{U}} H\right)  \label{masscont}
\end{equation}
Equation \eqref{masscont} may be written $H_t = M - \Div \bq$ in terms of the map-plane flux $\bq = \int_{b}^{h} \mathbf{U}\,dz = \bar{\mathbf{U}}\,H$.

Define the positive constant $\Gamma = 2 A (\rho g)^n / (n+2)$.  Combining Equations \eqref{siavelocity} and \eqref{masscont}, we get an equation for the rate of thickness change in terms of mass balance $M$, thickness, and surface slope $\grad h$:
\begin{equation}
H_t = M + \Div \left(\Gamma H^{n+2} |\grad h|^{n-1} \grad h \right) \label{sia}
\end{equation}

Fulfilling an earlier promise, if we can solve \eqref{sia} numerically then we have a usable model for the Barnes ice cap in Canada \cite{Mahaffy}.  The Barnes ice cap is a particularly simple ice sheet on a rather flat bed.

\subsubsection*{Analogy with the heat equation}  A step toward understanding the SIA model is to recognize its analogy with the better-known heat equation.  All numerical methods for solving \eqref{sia} can be understood as modifications of well-known heat equation methods.

The temperature $T(t,x)$ of a conducting rod satisfies the one-dimensional (1D) heat equation
\begin{equation}
  T_t = D T_{xx}. \label{heat1D}
\end{equation}
This form applies when material properties are constant.  The constant $D$ is the ``diffusivity''.  This equation has a smoothing effect on the solution $T$ as it evolves in time, because any local maximum in the temperature is flattened (i.e.~$T_{xx}<0$ implies $T$ decreases), while any local minimum is also flattened (i.e.~$T_{xx}>0$ implies $T$ increases).

The 2D heat equation, which we will see is analogous to equation \eqref{sia}, describes the temperature $T(t,x,y)$ at position $x,y$ in a planar object at time $t$.  Recall Fourier's law is the formula $\mathbf{Q} = - k \grad T$ for heat flux.  If we allow an additional heat source $f$, conservation of internal energy says $\rho c T_t = f - \Div \mathbf{Q}$.  Combining these we get the 2D heat equation:
	$$\rho c T_t = f + \Div (k \grad T).$$
Here $\rho$ is density, $c$ is specific heat, and $k$ is conductivity.  Assuming $\rho c$ is constant, define the ``diffusivity'' $D=k/(\rho c)$ and source term $F = f/(\rho c)$; generally these may vary.  The revised 2D heat equation is
\begin{equation}
T_t = F + \Div (D\, \grad T). \label{heat}
\end{equation}
Figure \ref{fig:initialheat} shows a solution of the heat equation, where the initial condition is a localized ``hot spot''.  Solutions of the heat equation involve the spreading, in all directions, of any local heat maxima or minima, that is, diffusion.

\twofigsizes{initialheat}{finalheat}{A solution of heat equation \eqref{heat} with $D=1$ and $F=0$.  Left: Initial condition $T(0,x,y)$.   Right: Solution $T(t,x,y)$ at $t=0.02$.}{2.8in}{2.8in}

The SIA equation \eqref{sia} and the heat equation \eqref{heat} are each diffusive, time-evolving partial differential equations (PDEs).  A side-by-side comparison is illuminating:
\begin{center}
\begin{tabular}{cc}
SIA:\, $H$ is ice thickness & \phantom{foo bar} heat: $T$ is temperature\phantom{foo bar}  \\
	\boxed{H_t = M + \Div \left({\color{red}\Gamma H^{n+2} |\grad h|^{n-1}}\, \grad h \right)}  &  \boxed{T_t = F + \Div (D\, \grad T)}
\end{tabular}
\end{center}
Notice that the number of derivatives (one time and two space derivatives) and the signs are the same.  Mass balance $M$ is analogous to heat source $F$.  

The analogy suggests that we identify the diffusivity in the SIA:
	$$D = {\color{red}\Gamma H^{n+2} |\grad h|^{n-1}}.$$
The non-sliding shallow ice flow \emph{diffuses} the ice sheet.  When $\Gamma$ or $H$ or $|\grad h|$ are large, the diffusion acts more quickly because $D$ is larger.  This analogy explains generally why the surfaces of ice sheets are smooth, at least if we ignore non-fluid processes like crevassing and wind-driven snow.  There are, however, some issues with this analogy:
\begin{itemize}
\item The diffusivity $D$ depends on the solution thickness $H$ and surface elevation $h$, and also these are not the same functions.
\item The diffusivity $D$ goes to zero at margins, where $H\to 0$, and at divides and domes, where $|\grad h|\to 0$.
\end{itemize}
Nonetheless we will provide a verified numerical scheme for \eqref{sia} in Section \ref{sec:numericalsia}.

\subsection{Finite difference numerics} 

As already noted, numerical schemes for the heat equation are a good starting place for solving the SIA equation \eqref{sia} numerically.  Finite difference numerical schemes, in particular, replace derivatives in a differential equation by arithmetic.  The basic fact is \emph{Taylor's theorem}, which says that for a smooth function $f(x)$,
	$$f(x+\Delta) = f(x) + f'(x) \Delta + \frac{1}{2} f''(x) \Delta^2 + \frac{1}{3!} f'''(x) \Delta^3 + \dots$$
You can replace ``$\Delta$'' by its multiples, for example:
\begin{align*}
f(x-\Delta) &= f(x) - f'(x) \Delta + \frac{1}{2} f''(x) \Delta^2 - \frac{1}{3!} f'''(x) \Delta^3 + \dots \\
f(x+2\Delta) &= f(x) + 2 f'(x) \Delta + 2 f''(x) \Delta^2 + \frac{4}{3} f'''(x) \Delta^3 + \dots
\end{align*}
The idea for constructing finite difference schemes is to combine expressions like these to give approximations of derivatives.  Thereby function values on a grid combine to approximate the differential equation.

Here we want partial derivative approximations, so we apply the Taylor's expansions one variable at a time.  For example with a general function $u=u(t,x)$,
\begin{align*}
u_t(t,x) &= \frac{u(t+\Delta t,x) - u(t,x)}{\Delta t} + O(\Delta t), \\
u_t(t,x) &= \frac{u(t+\Delta t,x) - u(t-\Delta t,x)}{2\Delta t} + O((\Delta t)^2), \\
u_x(t,x) &= \frac{u(t,x+\Delta x) - u(t,x-\Delta x)}{2\Delta x} + O((\Delta x)^2), \\
u_{xx}(t,x) &= \frac{u(t,x+\Delta x) - 2\, u(t,x) + u(t,x-\Delta x)}{\Delta x^2} + O((\Delta x)^2)
\end{align*}
Note that if $\Delta$ is a small number then ``$+O(\Delta^2)$'' is better, in the sense that the approximation is closer, than ``$+O(\Delta)$''

\subsubsection*{Explicit scheme for the heat equation}  Now we can state the simplest ``explicit'' scheme which approximates the 1D heat equation \eqref{heat1D}:
	$$\frac{T(t+\Delta t,x) - T(t,x)}{\Delta t} \approx D\,\frac{T(t,x+\Delta x) - 2\, T(t,x) + T(t,x-\Delta x)}{\Delta x^2}.$$
The finite difference scheme is not just an approximation of the PDE, but an actual method for computing numbers on a grid.  Let $(t_n,x_j)$ denote the time-space grid points.  Denote our approximation\footnote{Evaluating the exact solution at a grid point would give a different value from the one we compute by the scheme!  Of course we plan that these numbers will be close, but that needs checking or proof.} of the solution value $T(t_n,x_j)$ by $T_j^n$.  Then the finite difference scheme is
	$$\frac{T_j^{n+1} - T_j^n}{\Delta t} = D\,\frac{T_{j+1}^n - 2\, T_j^n + T_{j-1}^n}{\Delta x^2}.$$
To get a computable formula, let $\mu = D \Delta t / (\Delta x)^2$ and solve for $T_j^{n+1}$:
\begin{equation}
  T_j^{n+1} = \mu T_{j+1}^n + (1 - 2 \mu) T_j^n + \mu T_{j-1}^n \label{heat1Dfd}
\end{equation}
The scheme is ``explicit'' because we have been able to solve it for $T_j^{n+1}$ in terms of values at time $t_n$.  Figure \ref{fig:expstencil} shows the ``stencil'' for scheme \eqref{heat1Dfd}: three values at the current time $t_n$ are combined to update the one value at the next time $t_{n+1}$.

How accurate is scheme \eqref{heat1Dfd}?  Its construction tells us that the difference between the scheme \eqref{heat1Dfd} and the PDE \eqref{heat1D} is $O(\Delta t,(\Delta x)^2)$.  This difference between scheme and PDE goes to zero as we refine the grid in space and time (``consistency'').  With care about the smoothness of boundary conditions, and using mathematical facts about the heat equation itself, one can show that the difference between $T_j^n$ and $T(t_n,x_j)$ is \emph{also} $O(\Delta t,(\Delta x)^2)$, which is ``convergence''; see Notes and References.  However, to get convergence, the PDE problem must be known to generate smooth solutions and the scheme \eqref{heat1Dfd} must be stable, which we address below.  Then the main theorem for numerical PDE schemes is ``consistency plus stability implies convergence''; see Notes and References.  In these notes we do something rather practical, namely we find problems for which we already know exact values $T(t,x)$, and we compute the differences $|T_j^n - T(t_n,x_j)|$.  Thus we determine directly whether they go to zero.  This is ``verification''; more below.

\subsubsection*{A first implemented scheme}  For the first Matlab implementation we consider the two spatial dimension Equation \eqref{heat} with $D$ constant and $F=0$:
\begin{equation}
T_t = D (T_{xx}+T_{yy}).\label{heat2D}
\end{equation}
Writing $T_{jk}^n \approx T(t_n,x_j,y_k)$, the 2D explicit scheme is
\begin{equation}
	\frac{T_{jk}^{n+1} - T_{jk}^n}{\Delta t} = D\,\left(\frac{T_{j+1,k}^n - 2\, T_{jk}^n + T_{j-1,k}^n}{\Delta x^2} + \frac{T_{j,k+1}^n - 2\, T_{jk}^n + T_{j,k-1}^n}{\Delta y^2}\right). \label{heat2dexplicit}
\end{equation}
The stencil for the right-hand side of \eqref{heat2dexplicit} is in Figure \ref{fig:expstencil}.

\twofigsizes{expstencil}{exp2dstencil}{Left: Space-time stencil for the explicit scheme \eqref{heat1Dfd} for the 1D heat equation.  Right: Two spatial dimension stencil for scheme \eqref{heat2dexplicit}.}{2.0in}{2.1in}

Scheme \eqref{heat2dexplicit} has implementation \texttt{heat.m} below.  We use $T=0$ values on the boundary of the square $-1 < x < 1$, $-1 < y < 1$.  The initial condition is gaussian: $T(0,x,y) = \exp(-30 (x^2+y^2))$.  The code uses Matlab ``colon'' notation to remove loops over spatial variables.  Here is an example run:
\begin{Verbatim}
>>  heat(1.0,30,30,0.001,20);
\end{Verbatim}
This sets $D=1.0$ and uses a $30\times 30$ spatial grid.  We take $N=20$ time steps of $\Delta t = 0.001$.  The result is shown in Figure \ref{fig:initialheat}, right.  This is the look of success.

\minput{heat}

Very similar runs seem to fail, however.  Results from these calls are in Figure \ref{fig:stability}:
\begin{Verbatim}
>> heat(1.0,40,40,0.0005,100);    % Figure 7, left
>> heat(1.0,40,40,0.001,50);      % Figure 7, right
\end{Verbatim}
Both runs compute temperature $T$ on the same spatial grid, at the same final time, but they have different time steps.  The second run clearly shows instability.

\twofig{stability}{instability}{Numerically-computed temperature at time $t_f=0.05$ on $40\times 40$ grids.  Everything in the two runs is the same, except that the left figure has $\Delta t=0.0005$ so $D\Delta t/(\Delta x)^2= 0.2$, while the right has $\Delta t=0.001$ so $D\Delta t/(\Delta x)^2= 0.4$.}

%>> heat(1.0,40,40,0.001,50);
%  doing N = 50 steps of dt = 0.00100 for 0.0 < t < 0.050
%  nu = 1 * dt / dx^2 = 0.40000
%>> print -dpdf instability.pdf
%>> heat(1.0,40,40,0.0005,100);
%  doing N = 100 steps of dt = 0.00050 for 0.0 < t < 0.050
%  nu = 1 * dt / dx^2 = 0.20000
%>> print -dpdf stability.pdf

\subsubsection*{Stability criteria and adaptive time stepping}  How to avoid the instability?  We need to understand the scheme better.  It turns out we have not made an implementation error, but we must be more careful with choice of space and time steps.

Recall the 1D explicit scheme in form \eqref{heat1Dfd}: $T_j^{n+1} = \mu T_{j+1}^n + (1 - 2 \mu) T_j^n + \mu T_{j-1}^n$.  The new value $T_j^{n+1}$ is an average of the old values, in the sense that the coefficients add to one.  Actually, this is an average \emph{if} the middle coefficient is positive.  A linear combination with coefficients which add to one is not an average if any coefficients are negative!  (For example, we would not accept 13 as an ``average'' of 5 and 7, but of course we can write $13 = -3 \times 5 + 4 \times 7$, and $-3+4=1$.)  Averaging is stable because averaged wiggles are always smaller than the original wiggles.  We want this property.

So, what would follow from requiring the middle coefficient in \eqref{heat1Dfd} to be positive?:
\begin{equation}
   1 - 2 \mu \ge 0 \quad \iff \quad \frac{D\Delta t}{\Delta x^2} \le \frac{1}{2} \quad \iff \quad \Delta t \le \frac{\Delta x^2}{2 D}.  \label{stabcrit}
\end{equation}
This condition on the size of $\Delta t$ is a \emph{sufficient} stability criterion.  (It is enough to guarantee stability, though something weaker might do.)  For given $\Delta x$, shortening the time step so that $\Delta t \le \Delta x^2/(2 D)$ will make the scheme into an averaging process.

Applying this same idea to the 2D heat equation \eqref{heat2D} leads to the stability condition that $1-2\mu^x-2\mu^y \ge 0$ where $\mu^x = D \Delta t / (\Delta x^2)$ and $\mu^y = D \Delta t / (\Delta y^2)$.  In the cases shown in Figure  \ref{fig:stability} with $\Delta x=\Delta y$, this condition requires $D \Delta t /(\Delta x^2) \le 0.25$, which precisely distinguishes between the two parts of the Figure.  In summary, instability in runs of \texttt{heat.m} happens if the time step $\Delta t$ is too big relative to the spacing $\Delta x$.

The stability criterion above is easily satisfied by making each time step shorter.  Doing so in a program is an \emph{adaptive} implementation.  It has guaranteed stability.  To show how easy it is to implement, \texttt{heatadapt.m} (not shown) is the same as \texttt{heat.m} except that the time step is chosen from the stability criterion.  It cannot generate the instability seen in Figure \ref{fig:stability}.  However, if the diffusivity $D$ is large or the spatial steps $\Delta x$, $\Delta y$ are small, then explicit, adaptive implementations like this one must take short time steps to assure stability.


\subsubsection*{Implicit schemes}  There is an alternative stability fix instead of adaptivity, namely ``implicitness.''  For example, the finite difference scheme
\begin{equation}
  \frac{T_j^{n+1} - T_j^n}{\Delta t} = D\,\frac{T_{j+1}^{n+1} - 2\, T_j^{n+1} + T_{j-1}^{n+1}}{\Delta x^2} \label{implicit1D}
\end{equation}
is an $O(\Delta t,(\Delta x)^2)$ accurate implicit scheme for Equation \eqref{heat1D}.  Such implicit schemes for the heat equation are stable for \emph{any} positive time step $\Delta t>0$ (``unconditionally stable'').  Another well-known example implicit scheme is \emph{Crank-Nicolson}, which is unconditionally stable for the heat equation and which also has yet smaller error $O((\Delta t)^2,(\Delta x)^2)$.

But implicit schemes are harder to implement.  First, the unknown solution values at time step $t_{n+1}$ are treated as a vector in a large system of equations which must be formed and solved at each time step.  If the PDE is nonlinear---the SIA is a highly nonlinear diffusion equation---then the system of equations may be hard to solve.  For these notes we stay with the adaptive explicit idea.  Generally, there is a tradeoff between the implementability of adaptive explicit schemes and the stability of implicit schemes.

\subsubsection*{Numerical solution of diffusion equations}  We are trying to numerically model ice flows, not heat conduction.  We have an analogy, however, which says that the SIA is like the heat equation: both are diffusions.  Heat equation \eqref{heat} is called the ``diffusion equation'' if the unknown is not a temperature.  In this section, because we wish to solve the SIA on real bedrock, we construct a numerical scheme for a generalized diffusion which additionally has a ``shift'' inside the gradient, namely
\begin{equation}
  T_t = F + \Div \left(D \grad (T + b)\right). \label{gendiffusion}
\end{equation}
In equation \eqref{gendiffusion}, the source term $F(x,y)$, the diffusivity $D(x,y)$, and the ``shift'' $b(x,y)$ may all vary in space.  We now provide a code that solves \eqref{gendiffusion} and is used in SIA solutions.

An adaptive explicit method for the diffusion equation is conditionally stable, with the same essential time step restriction as for the constant diffusivity case, as long as we evaluate $D(x,y)$ at \emph{staggered} grid points.  That is, we use this expression for the second derivative:
\begin{align*}
\Div \left(D \grad X\right) &\approx \frac{D_{j+1/2,k}(X_{j+1,k} - X_{j,k}) - D_{j-1/2,k}(X_{j,k} - X_{j-1,k})}{\Delta x^2} \\
	&\qquad + \frac{D_{j,k+1/2}(X_{j,k+1} - X_{j,k}) - D_{j,k-1/2}(X_{j,k} - X_{j,k-1})}{\Delta y^2},
\end{align*}
where $X=T+b$.  Figure \ref{fig:diffstencil} shows the stencil.

\twofigsizes{diffstencil}{mahaffystencil}{Left:  Spatial stencil for staggered grid evaluation of diffusivity (at triangles) in the diffusion equation \eqref{gendiffusion}.  Right: Stencil showing how the staggered-grid diffusivity (triangle) can be evaluated in the SIA, from surface elevation (diamonds) and thicknesses (squares).}{2.2in}{2.2in}

Code \texttt{diffusion.m} (below) solves \eqref{gendiffusion} numerically.  The user supplies the diffusivity $D(x,y)$ on the staggered grid.  Initial temperature $T(0,x,y)$, source term $F(x,y)$, and ``shift'' $b(x,y)$ are supplied on the regular grid.  When using this code for standard diffusions, or the flat-bed SIA, we would take $b=0$.

\minput{diffusion}


\subsection{Numerically solving the SIA} \label{sec:numericalsia}

Recall that in SIA equation \eqref{sia} we have diffusivity $D = \Gamma H^{n+2} |\grad h|^{n-1}$.  This diffusivity ``degenerates'' $D \to 0$ when either $H\to 0$ or $\grad h \to 0$.  Degenerate diffusion equations are automatically free boundary problems, but this is no surprise to a glaciologist.  Determining the location of the margin, and thus the spatial extent of the ice flow, is a major part of the problem.  To address this free boundary issue in our explicit time-stepping code it suffices to numerically compute new thicknesses and then set them to zero if they come out negative.

For numerical stability we compute the SIA diffusivity $D$ on the staggered grid.  Various finite difference schemes for computing it have been proposed but all involve averaging $H$ and differencing $h$ in a ``balanced'' way onto the staggered grid.  In the code \texttt{siaflat.m} below we use the Mahaffy choice, with the diffusivity-computation stencil shown in Figure \ref{fig:diffstencil}.  This code only works for the flat bed, zero surface mass balance case, but we will correct these deficiencies later.

\minput{siaflat}


\subsection{Exact solutions and verification}

In \texttt{siaflat.m}, which calls \texttt{diffusion.m}, we already have a fairly complicated code.  How do we make sure that such an \emph{implemented} numerical scheme is correct?  Here are three proposed techniques:
\begin{enumerate}
  \item don't make any mistakes, or
  \item compare your numerical results with several others, and hope that the outliers are in error, or
  \item compare your numerical results to an exact solution.   \end{enumerate}
The last one of these, which we prefer to the first two when it is possible, is called ``verification.''  Of course, when we build a new computer code we should test it in cases where we know the right answer; that is the idea of verification.  To do so we need to return to the PDE itself, to get useful exact solutions.

\subsubsection*{Exact solution of heat equation}  First we consider the simpler case of the 1D heat equation with constant $D$, namely $T_t = D T_{xx}$.  Many exact solutions $T(t,x)$ to this heat equation are known, but let's consider the time-dependent ``Green's function,'' also known as the ``heat kernel''.  It starts at time $t=0$ with a ``delta function'' $T(0,x)=\delta(x)$ of heat at the origin $x=0$.  Then it spreads out over time.  It is a solution of the heat equation on the whole line $-\infty<x<\infty$ and for all $t>0$.  We can calculate this exact solution by a method which generalizes to the SIA.

The Green's function of the heat equation is ``self-similar'' over time, in the sense that it changes shape \emph{only} by shrinking the output (vertical) axis and lengthening the input (horizontal) axis, as shown in Figure \ref{fig:heatscaling}.  These scalings are related to each other by the conservation of energy, which says that the total heat energy is independent of time.

\onefigsize{heatscaling}{The Green's function of the heat equation in 1D has the same ``shape'' at each time, but there are time-dependent input- and output-scalings.}{2.4in}

In particular, the Green's function of the 1D heat equation is
  $$T(t,x) = (4 \pi D t)^{-1/2}\, e^{-x^2/(4Dt)}.$$
``Similarity'' variables for this solution, the above-mentioned scalings, are
	$$s \stackrel{\text{\emph{input scaling}}}{\phantom{\Big|}=\phantom{\Big|}} t^{-1/2} x, \qquad T(t,x) \stackrel{\text{\emph{output scaling}}}{\phantom{\Big|}=\phantom{\Big|}} t^{-1/2} \phi(s).$$
The invariant shape function is $\phi(s) = (4 \pi D)^{-1/2}\, e^{-s^2/(4D)}$.  All time-dependence is from the input and output scalings.

For a sufficiently-long spatial interval, so that zero boundary conditions cause no problem, a numerical solver for the 1D heat equation should produce numbers which are close to this exact solution; see the Exercises.

\subsubsection*{Halfar's exact ``similarity'' solution to the SIA}  Now we jump forward from Green's idea in about 1830 to the year 1981 in which P.~Halfar published the similarity solution of the SIA in the case of flat bed and zero surface mass balance.  Halfar's solution to the 2D SIA model \eqref{sia}, using a Glen exponent $n=3$, has scalings
\begin{equation}
s = t^{-1/18} r, \qquad H(t,r)=t^{-1/9} \phi(s) \label{halfarscalings}
\end{equation}
where $r=(x^2+y^2)^{1/2}$ is the distance from the origin.  The scalings in \eqref{halfarscalings} imply that, quite differently from heat, the diffusion of ice slows down severely as the shape flattens out.  That is, the powers $t^{-1/9}$, $t^{-1/18}$ imply very little change for large times $t$.

\onefigsize{siascaling}{Halfar's solution $H(t,r)$ \eqref{halfar} of the SIA equation \eqref{sia} on a flat bed, and with zero mass balance.  The solution is shown on $H$ (m) versus $r$ (km) axes for times $t=1,10,100,1000,10000$ years, in a case where $t_0=422$ years.}{5.5in}

The formula for the Halfar solution to the SIA is remarkably simple,
\begin{equation}
H(t,r) = H_0 \left(\frac{t_0}{t}\right)^{1/9} \left[1 - \left(\left(\frac{t_0}{t}\right)^{1/18} \frac{r}{R_0}\right)^{4/3}\right]^{3/7} \label{halfar}
\end{equation}
where the ``characteristic time'' is $t_0 = (18 \Gamma)^{-1} (7/4)^3 R_0^4 H_0^{-7}$; choosing center height $H_0$ and radius $R_0$ determines $t_0$.  Time- and space-dependent formula \eqref{halfar} for thickness $H(t,r)$ is plotted in Figure \ref{fig:siascaling}.  We see that for times significantly greater than $t_0$ (i.e.~$t/t_0 \gg 1$) the solution changes very slowly.  The change between years $1$ and $100$ is comparably large with that between years $1000$ and $10000$.

\subsubsection*{Using Halfar's solution}  Formula \eqref{halfar} is simple enough to use for verifying time-dependent SIA models.  The code \texttt{verifysia.m} takes as input the number of grid points in each ($x,y$) direction.  It uses the Halfar solution at 200 a as the initial condition, does a numerical run to time 20000 a, using \texttt{siaflat.m} above, and then compares to the Halfar formula for that time:
\small
\begin{verbatim}
>> verifysia(20)
average thickness error     = 22.310
>> verifysia(40)
average thickness error     = 9.490
>> verifysia(80)
average thickness error     = 2.800
>> verifysia(160)
average thickness error     = 1.059
\end{verbatim}
\normalsize
We see that the thickness error, namely the absolute value of the difference between the numerical and exact thickness solutions at $t=20000$ a, decreases with increasing grid resolution.  This is as expected for a correctly-implemented code.  What is less obvious, perhaps, is that almost any numerical implementation mistake---almost any bug---will break this property, and these errors will not shrink.

You might ask, is the Halfar solution also useful for modelling real ice masses?  J.~Nye and others (2000; \cite{NyeIcarus2000}) compared the long-time consequences of different flow laws for the south polar cap on Mars.  In particular, they evaluated $\text{CO}_2$ ice and $\text{H}_2\text{O}$ ice softness parameters by comparing the long-time behavior of the corresponding Halfar solutions.  Their conclusions:
  \begin{quote}
  \dots none of the three possible [$\text{CO}_2$] flow laws will allow a 3000-m cap, the thickness suggested by stereogrammetry, to survive for $10^7$ years, indicating that the south polar ice cap is probably not composed of pure $\text{CO}_2$ ice [but rather] water ice, with an unknown admixture of dust.
  \end{quote}
This theoretical result has been confirmed by the observation and sampling of the polar geology of Mars.

Are exact solutions always available when needed?  No.  However, sometimes the absence of exact solutions means that not enough thought has gone into the continuum model itself.  In any case, many ice flow models already have exact solutions which are relevant to verification.  For example, we will use van der Veen's solution for ice shelves in a later section.  Sources for additional exact solutions appear in Notes and References.

\subsubsection*{A test of robustness}  Verification is a reasonable start to testing a code.  Another kind of test is for ``robustness'': Does the model break when you ask it to do hard things?  Unlike for verification, we might not have precise knowledge of what it should do, but we know the program should act in a ``reasonable'' way.

The robustness test in the program \texttt{roughice.m} (not shown) demonstrates that \texttt{siaflat.m} can handle an ice sheet with extraordinarily large driving stresses.  Recall that glaciological ``driving stress'' is $\tau_d = - \rho g H \grad h$.  This quantity appears in the slab-on-a-slope example, and in the SIA model, as the value of the shear stress $(\tau_{13},\tau_{23})$ at the base of the ice.  We give \texttt{siaflat.m} a randomly-generated initial ice sheet which is of the worst possible sort.  It is both thick---mean thickness 3000 m---and it has large surface slopes.  Such an initial sheet is shown in the left side of Figure \ref{fig:roughinitial}.  During the run of 50 model years, the time step is determined adaptively, increasing from 0.0002 years to close to the user-chosen maximum time step of 0.2 years.  The maximum value of the driving stress decreases from $5.7\times 10^6$ Pa to $3.6\times 10^5$ Pa.  At the end of the run the ice cap has the shape shown at right in Figure \ref{fig:roughinitial}.  The shape is rather close to a Halfar solution; indeed Halfar proved that all solutions of the SIA on a flat bed with no mass balance asymptotically approach the Halfar solution.

\twofig{roughinitial}{roughfinal}{\texttt{siaflat.m} evolves the worst-possible initial ice sheet (left), an ice cap with huge driving stresses, to the ice cap at right after 50 model years.}


\subsection{Applying our numerical ice sheet model}

Finally we apply the model to the Antarctic ice sheet.  First we modify \texttt{siaflat.m} to allow non-flat bedrock elevation $b(x,y)$ and time-independent surface mass balance $M(x,y)$.  Also we calve floating ice, and we enforce non-negative thickness at each timestep.  The result is \texttt{siageneral.m} (not shown).

\twofigsizes{antinitial}{antfinal}{Left: Initial surface elevation (m) of Antarctic ice sheet.  Right: Final surface elevation at end of 40 ka model run on 50 km grid.}{2.55in}{3.2in}

We use measured accumulation, bedrock elevation, and surface elevation from ALBMAPv1 data \cite{LeBrocqetal2010}.  Melt is not modelled so the surface mass balance is the accumulation rate.  These input data are read from a NetCDF file by additional codes \texttt{buildant.m} and \texttt{netcdf.m} (not shown).

\onefig{antvolcompare}{Ice volume time series of the modeled Antarctic ice sheet, in units of $10^6 \, \text{km}^3$, from runs on 50 km (red), 25 km (green), and 20 km (blue) grids.}

The code \texttt{ant.m} (not shown) calls \texttt{siageneral.m} to do the simulation in blocks of 500 model years.  The volume is computed at the end of each block.  Figure \ref{fig:antinitial} shows the initial and final surface elevations from a run of 40,000 model years on a $\Delta x = \Delta y = 50$ km grid.  The runtime on a typical laptop is a few minutes.  Note that areas of low-slope and fast-flowing ice experience thickening, while near-divide ice in East Antarctica thins.  Assuming the present-day Antarctic ice sheet is near steady state, these thickness differences reflect the lack of a sliding mechanism in the former case and the lack of thermomechanical coupling in the latter case.

Figure \ref{fig:antvolcompare} compares the ice volume time series for 50 km, 25 km, and 20 km grids.  This result, namely grid dependence of the ice volume, is typical.  One cause is that most steep gradients near the ice margin are poorly resolved, but this is true on all of these coarse resolutions.  Mainly this result is a warning about the interpretation of model runs on fixed grids.  Even if the data is available only on a fixed grid, the model should be run at different resolutions to evaluate the robustness of the model results.


\subsection{Mass continuity and kinematical equations}

The previous SIA discussion combines two equations which we will now think about separately, namely the ``stress balance'' and mass continuity equations.  In the SIA the stress balance is formula \eqref{siavelocity} for the velocity.  It combines with the mass continuity equation \eqref{masscont} to give model \eqref{sia} for the ice sheet thickness.  In this section we consider the mass continuity equation more generally.

The basic shallow assumption made by most ice flow theories\footnote{There are several inequivalent shallow theories: SIA, SSA, hybrids, Blatter-Pattyn, \dots} is that the surface and base of the ice are differentiable functions $z=h(t,x,y)$ and $z=b(t,x,y)$.  Thus surface overhang is not allowed.  By contrast, the Stokes theory of slow viscous fluids only needs a boundary surface for the fluid, i.e.~a surface in three-dimensional space.  Most ice sheet and glacier models take a map-plane perspective, however, and they have a well-defined ice thickness $H=h-b$.

We can already state an important mathematical fact which follows from this basic assumption.  Namely that it implies that the surface kinematical and mass continuity equations are equivalent.  More precisely, any pair of these equations implies the third:
  \begin{itemize}
  \item the surface kinematical equation \eqref{surfkine} (below),
  \item the base kinematical equation \eqref{basekine} (below), and
  \item the map-plane mass continuity equation \eqref{masscont}.
  \end{itemize}
What are these kinematical equations?  Let $a$ be the upper surface mass balance function ($a>0$ is accumulation) and $s$ be the basal melt rate function ($s>0$ is basal melting).  The map-plane mass balance is $M=a-s$.  The surface kinematical equation is 
\begin{equation}
h_t = a - \mathbf{U}\big|_h \cdot \grad h + w\big|_h,  \label{surfkine}
\end{equation}
and the base kinematical equation is
\begin{equation}
b_t = s - \mathbf{U}\big|_b \cdot \grad b + w\big|_b.  \label{basekine}
\end{equation}
These equations describe the movement of the ice upper surface and base from the velocity of the ice and the mass balance.

One proves the equivalences claim above by using the incompressibility of ice \eqref{incompressible} and the Leibniz rule for differentiating integrals.  The details are left for exercises.

The bedrock is often regarded as fixed (i.e.~$b_t=0$), and in fact the basal kinematical equation is often not explicitly mentioned in ice sheet modelling.  Instead one gets a simplified view.  In the case of no sliding, for example, the basal value of the vertical velocity equals the basal melt rate.  This simplification corresponds to $b_t=0$ and $\mathbf{U}\big|_b=0$ so that $w\big|_b=-s$.

To conclude this short section we sketch a standard prognostic, isothermal ice sheet model.  Like most ice sheet models, we use the mass continuity equation \eqref{masscont} to describe changes in ice sheet geometry, but we could use the surface kinematical equation instead.  Each time step follows this recipe:
  \begin{itemize}
  \item numerically solve a stress balance, which gives velocity $\mathbf{u}=(u,v,w)$,
    \begin{itemize}
    \item[$\circ$] if the stress balance only gives $\mathbf{U}=(u,v)$, get $w$ from incompressibility,
    \end{itemize}
  \item decide on a time step $\Delta t$ for \eqref{masscont} based on velocities and/or diffusivities,
  \item from the horizontal velocity $\mathbf{U}=(u,v)$, compute the flux $\bq = \bar{\bU} H$,
  \item update mass balance $M=a-s$ and do a time-step of \eqref{masscont} to get $H_t$,
  \item update the upper surface elevation and thickness (e.g.~$h \mapsto h + H_t \Delta t$), and repeat.
  \end{itemize}

The above ``standard paradigm'' has many variations, however.  Some glaciological questions are answered just by solving the stress balance for the velocity.  Sometimes the goal is the steady state configuration of the glacier, which can be computed more quickly than by time-stepping physical evolution equations to steady state.  (I.e.~there are faster iterative solvers of the coupled steady state equations.)  And other processes are often simulated at each time step, such as the conservation of energy within the ice, or subglacial and supraglacial processes.  Understanding the diverse time scales associated to these processes is key.

In the SIA simulations of previous sections we apparently did not compute the velocity.  That is because the analogy to the heat equation allowed us to write the mass continuity equation as a diffusion, with $\bq=-D\nabla h$ for the flux.  Fast flow in ice sheets is associated with sliding and floating ice, however, and for these flows the ice geometry evolution is not a diffusion.  One solves the stress balance for the velocity field.  We consider such a stress balance associated to fast flow next.


\subsection{Shelves and streams} \label{sec:shelvesandstreams}

The shallow shelf approximation (SSA) stress balance applies to ice shelves as its name suggests.  It applies best to parts of ice shelves which are away from grounding lines and calving fronts.  The SSA also applies reasonably well to ice streams, like those in Figure \ref{fig:siple} which have not-too-steep bed topography and low basal resistance.

\twofigsizes{siple}{streamisbrae}{Left:  The SSA model applies to ice streams like these on the Siple Coast in Antarctica.  Color shows radar-derived surface speed.  Right: Cross sections, \emph{without} vertical exaggeration, of the Jakobshavns Isbrae outlet glacier in Greenland (\textbf{a}) and the Whillans Ice Stream on the Siple Coast (\textbf{b}); this is Figure 1 in \cite{TrufferEchelmeyer}.}{2.8in}{2.9in}

But what is, and is not, an ice stream?  Ice streams slide at $50$ to $1000 \,\text{m}\,\text{a}^{-1}$, they have a concentration of vertical shear in a thin layer near base, and typically they flow into ice shelves.  Pressurized liquid water at their beds plays a critical role enabling their fast flow.  There are other fast-flowing grounded parts of ice sheets, however, called ``outlet glaciers''.  They can have even faster surface speed (up to $10 \,\text{km}\,\text{a}^{-1}$), but it is typically uncertain how much of this speed is from sliding at the base.  In an outlet glacier there is substantial vertical shear ``up'' in the ice column, sometimes caused by soft temperate ice in a significant fraction of the thickness.  Finally, outlet glaciers are strongly controlled by fjord-like, high slope bedrock topography.  Figure \ref{fig:siple} (right) compares the shallowness and bedrock topography of an outlet glacier and an ice stream.  Few simplifying assumptions are appropriate for outlet glaciers, and the SSA may not be a sufficient model.

\subsubsection*{The shallow shelf approximation (SSA)}  We state this stress balance equation only in the plane flow case, i.e.~in a ``flow line'':
\begin{equation}
  \left({\color{red} 2 B H |u_x|^{1/n - 1} u_x}\right)_x {\color{blue} - C|u|^{m-1}u} = \rho g H h_x \label{ssaearly}
\end{equation}
The {\color{red} \textbf{red}} term is the vertically-integrated longitudinal stress, also called the ``membrane'' stress when there are two horizontal variables.  The {\color{blue} \textbf{blue}} term is the basal resistance, which is zero in an ice shelf.  The negative of the term on the right is the driving stress.  Thus the SSA equation is a balance wherein longitudinal strain rates are determined by the integrated ice hardness (i.e.~the coefficient $BH$), the slipperyness of the bed (i.e.~by the coefficient $C$ and the power $m$) and the geometry of the ice sheet (i.e.~the thickness $H$ and the surface slope $h_x$).

In \eqref{ssaearly} the velocity $u$ is independent of the vertical coordinate $z$.  We assume that the ice hardness $B=A^{-1/n}$ is also independent of depth.  (Thus models which are not isothermal must compute the vertical average of the hardness.)  The basal resistance term $\tau_b = - C|u|^{m-1}u$ is often called a ``sliding law'' in power law form.

The coefficient $\bar \nu = B |u_x|^{1/n-1}$ in \eqref{ssaearly} is called the ``effective viscosity'', so that \eqref{ssaearly} can be written
\begin{equation}
  \left(2 \,\bar \nu\, H u_x\right)_x - C |u|^{m-1} u = \rho g H h_x.  \label{ssa}
\end{equation}
In form \eqref{ssa} it is understood that the viscosity $\bar\nu$ depends on the velocity solution $u$.

Equation \eqref{ssa} simplifies if the ice is floating, because we assume zero resistance is applied by the ocean.  (And by the atmosphere, for that matter.)  Also, the ice surface elevation is proportional to the thickness if the ice is floating.  The inequality ``$\,\rho H < - \rho_w b\,$'' is sometimes called the \emph{flotation criterion}.  For grounded ice we know $\rho H > - \rho_w b$ and that the driving stress is $\rho g H h_x = \rho g H (H_x + b_x)$.  On the floating side we know $\rho H < - \rho_w b$ and that $h = (1-\rho/\rho_w) H$ so the driving stress is $\rho g H h_x = \rho(1-\rho/\rho_w) g H H_x$.  Thus the SSA becomes
\begin{equation}
   \left(2 \,\bar\nu\, H u_x\right)_x = \rho g (1-\rho/\rho_w) H H_x \label{ssafloat}
\end{equation}
for floating ice.  A useful observation about flow line equation \eqref{ssafloat} is that both left and right-hand expressions are derivatives; this fact can be used to build a 1D exact solution.

\subsubsection*{Steady ice shelf exact solution}  For a steady 1D ice shelf, in which $H_t=0$, the mass continuity equation \eqref{masscont} reduces to $M=(uH)_x$.  Because this is simple, and because of the relative simplicity of the SSA equation \eqref{ssafloat} for 1D floating ice, the exact velocity and thickness for a steady ice shelf were computed by van der Veen  \cite{vanderVeen83}.  This exact solution depends on the ice thickness $H_g$ and velocity $u_g$ at the grounding line.  For the surface mass balance $M$ we choose a positive constant $M_0$.  These choices determine a unique solution, the derivation of which is left to the exercises.

Supposing $H_g=500$ m, $u_g = 50 \,\text{m}\,\text{a}^{-1}$, and $M_0=30 \,\text{cm}\,\text{a}^{-1}$ we get the results in Figure \ref{fig:steadyshelfprofile}, which are from code \texttt{exactshelf.m} (not shown).  We will use this exact solution to verify a numerical SSA code.  Note that driving stresses are much higher near the grounding line than away from it, and thus the highest longitudinal stresses, strain rates, and thinning rates occur near the grounding line.

\twofig{steadyshelfprofile}{steadyshelfvelocity}{The upper and lower surface elevation (m; left) of the exact ice shelf solution and its velocity (m/a; right); $x=0$ is the grounding line.}

\subsubsection*{Numerical solution of the SSA}  Suppose the ice thickness is a fixed function $H(x)$.  To find the velocity we must solve the nonlinear PDE \eqref{ssa} or \eqref{ssafloat} for the unknown $u(x)$.  When we do this numerically an iteration is needed because of the nonlinearity.  The simplest iteration idea is to use an initial guess at the velocity, which allows us to compute an effective viscosity and then get a new velocity solution from a linear PDE problem.  Then we recompute the effective viscosity, solve for a new velocity, and repeat until things stop changing.  This is a ``Picard'' iteration.

Specifically, denote the previous velocity iterate as $u^{(k-1)}$ and the current iterate as $u^{(k)}$.  Compute $\bar \nu^{(k-1)} = B |u^{(k-1)}_x|^{1/n-1}$ and define $W^{(k-1)} = 2 \bar \nu^{(k-1)} H$.  Solve this linear elliptic PDE for the unknown $u^{(k)}$ at each iteration:
\begin{equation}
   \left(W^{(k-1)} u^{(k)}_x\right)_x - C |u^{(k-1)}|^{m-1} u^{(k)} = \rho g H h_x. \label{picardssa}
\end{equation}
If the difference between $u^{(k-1)}$ and $u^{(k)}$ were ever to be zero then we would have a solution of \eqref{ssa}.  In practice we stop the iteration when the difference is small enough.  Equation \eqref{picardssa} is a linear boundary value problem.  We can write it abstractly
\begin{equation}
  \left(W(x)\, u_x\right)_x - \alpha(x)\, u = \beta(x)  \label{innerlinear}
\end{equation}
where the functions $W(x)$, $\alpha(x)$, $\beta(x)$ are known in thiscontext.  Equation \eqref{innerlinear} applies on an interval of the $x$-axis.  For boundary conditions we will suppose that $x=x_g$ is a location where the velocity is known, $u(x_g)=u_g$, as in Figure \ref{fig:steadyshelfprofile}.  In the ice shelf case we also have the calving front condition
\begin{equation}
  2 B H |u_x|^{1/n - 1} u_x = \frac{1}{2}\rho (1-\rho/\rho_w) g H^2  \label{calvingstress}
\end{equation}
at the end of the ice shelf $x=x_c$.  (See Notes and References for a derivation of \eqref{calvingstress}.)  Boundary condition \eqref{calvingstress} can be solved for $u_x(x_c)=\gamma$ in terms of known quantities including the thickness at the calving front.

Where to get an initial guess $u^{(0)}$?  Generally this may require effort, but we can give brief answers for the 1D cases.  For floating ice, an initial velocity comes from assuming a uniform strain rate provided by the calving front condition: $u^{(0)}(x) = \gamma (x-x_g) + u_g$.  For grounded ice, we may assume ice is held by basal resistance only: $u^{(0)}(x) = \left(-C^{-1} \rho g H h_x\right)^{1/m}$.

\subsubsection*{Numerics of the linear boundary value problem}  Suppose equation \eqref{innerlinear} applies on $[x_g,x_c]=[0,L]$.  We discretize with equal spacing $\Delta x$ and index $j=1,2,\dots,J+1$, so that $x_1 = 0$ and $x_{J+1} = L$ are endpoints.  The coefficient $W(x)$ is needed on a staggered grid, for stability and accuracy reasons similar to those for the SIA diffusivity.  Our finite difference approximation of \eqref{innerlinear} is
\begin{equation}
  \frac{W_{j+1/2} (u_{j+1} - u_j) - W_{j-1/2} (u_{j} - u_{j-1})}{\Delta x^2} - \alpha_j u_j = \beta_j  \label{discreteinnerlinear}
\end{equation}

For the left end boundary condition we have $u_1 = u_g$ given, which is easy to include in the linear system (below).  For the right end boundary condition we have $u_x(L)=\gamma$, which requires more thought \cite{MortonMayers}.  First introduce a notional point $x_{J+2}$.  Now require $(u_{J+2} - u_J)/(2 \Delta x) = \gamma$.  Using equation \eqref{discreteinnerlinear} in $j=J+1$ case, eliminate the $u_{J+2}$ variable ``by-hand''.  This determines the form of the last equation in our linear system.

Thus each iteration to solve the SSA stress balance has the form
\begin{equation}
   A \mathbf{v} = \mathbf{b}. \label{Aveqb}
\end{equation}
Indeed, at each location $x_1,\dots,x_{J+1}$ we can write an equation, basically a row of the matrix $A$ in \eqref{Aveqb}, involving the unknown velocities.  In more detail it is this linear system of $J+1$ equations:
\begin{equation}
\begin{bmatrix}
1 &  &  &  &  \\
W_{3/2} & A_{22} & W_{5/2} &  &  \\
 & W_{5/2} & A_{33} &  &  \\
 &  & \ddots & \ddots &  \\
 &  & W_{J-1/2} & A_{JJ} & W_{J+1/2} \\
 &  &  & A_{J+1,J} & A_{J+1,J+1} \\
\end{bmatrix}\,
\begin{bmatrix}
u_1 \\ u_2 \\ u_3 \\ \vdots \\ u_J \\ u_{J+1}
\end{bmatrix}
=
\begin{bmatrix}
u_g \\ \beta_2 \Delta x^2 \\ \beta_3 \Delta x^2 \\ \vdots \\ \beta_J \Delta x^2 \\ b_{J+1}
\end{bmatrix}  \label{discretematrixform}
\end{equation}
The diagonal entries are
  $$A_{22} = -(W_{3/2}+W_{5/2}+\alpha_2 \Delta x^2), \quad \dots \quad A_{JJ} = -(W_{J-1/2}+W_{J+1/2}+\alpha_J \Delta x^2).$$
There are special cases for the coefficients in the last equation,
  $$A_{J+1,J} = 2 W_{J+1/2}, \quad A_{J+1,J+1} = -(2 W_{J+1/2}+\alpha_{J+1}\Delta x^2).$$
For the right side of the last equation, $b_{J+1} = -2 \gamma \Delta x W_{J+3/2} + \beta_{J+1} \Delta x^2$.

System \eqref{discretematrixform} is a tridiagonal linear system.  But don't bother looking up how to solve such a linear system unless you really need to!  It is fully appropriate to give system \eqref{discretematrixform} to Matlab's linear solver, the ``backslash'' operator $\mathbf{v} = A\, \backslash\, \mathbf{b}$, and not worry further about solving finite linear systems at this initial implementation stage.  So we now have a code to solve \eqref{innerlinear} by finite differences and linear algebra, namely \texttt{flowline.m} below.

\minput{flowline}

By ``manufacturing'' exact solutions to \eqref{innerlinear}---see Notes and References---we can test this code.   In fact, results from \texttt{testflowline.m} (not shown) demonstrate that our implemented numerical scheme converges at the optimal rate $O(\Delta x^2)$.  We do this test before proceeding to solve the nonlinear SSA problem.

\subsubsection*{Solving the stress balance for an ice shelf}  The code \texttt{ssaflowline.m} (below) numerically computes the velocity for an ice shelf.  The thickness is assumed to be given, so we are not solving the full, ``coupled'' ice shelf problem.  This code implements Picard iteration to solve the nonlinear equation \eqref{ssafloat}.  It calls \texttt{ssainit.m} (not shown) to get the initial iterate $u^{(0)}(x)$, as already described, and it calls \texttt{flowline.m} at each iteration.  It also calls small helper functions \texttt{stagav,regslope,stagslope} (not shown) to computed certain gridded values.

\minput{ssaflowline}

Now we can ask precisely: Does \texttt{ssaflowline.m} work correctly?  The exact velocity solution shown in Figure \ref{fig:steadyshelfprofile} allows us to compare the numerical and exact solutions by finding the maximum difference between them.  To make a test out of this we take the exact thickness shown in Figure \ref{fig:steadyshelfprofile}, from \texttt{exactshelf.m}.  A convergence comparison, shown in Figure \ref{fig:shelfconv}, is done by codes \texttt{testshelf.m} and \texttt{shelfconv.m} (not shown).  Thus, at screen resolution, the numerical velocity solution from a coarse grid computation is identical to that shown in the right part of Figure \ref{fig:steadyshelfprofile}.  There is no need to show the numerical solution.

\onefig{shelfconv}{The numerical SSA velocity solution from \texttt{ssaflowline.m} converges to the exact solution, at nearly the optimal rate $O(\Delta x^2)$, as the grid is refined from spacing $\Delta x=4$ km to $\Delta x=62$ m.  Each blue circle gives the maximum velocity error for a solution on a given grid.  Even on the coarsest grid the error is less than 1 m/a while the maximum velocity is $\sim 300$ m/a.}

\subsubsection*{Realistic ice shelf modelling}  Real ice shelves have two horizontal variables.  They are frequently confined in bays, and thus they experience ``side drag''.  Their velocities vary spatially and temporally along their grounding ``lines'' (i.e.~the curve where the flotation criterion is an equality).  Furthermore real ice shelves have interesting boundary processes, including high basal melt near grounding lines, marine ice basal freeze-on, and fracturing which nears full thickness at the calving front.

Nonetheless ``diagnostic'' (i.e.~fixed geometry) ice shelf modelling in two horizontal variables, done like the above example where the velocity is the model unknown but the thickness is known, is quite successful using only the isothermal SSA model.  For example, Figure \ref{fig:rossquiver} shows a Parallel Ice Sheet Model (PISM) result for the Ross ice shelf, compared to observed velocities.  There is only one tuned parameter, the constant value of the ice hardness $B$.  Many current ice shelf models yield comparable match \cite{MacAyealetal}.

\twofigsizes{rossquiver}{rossscatter}{Results from tuning the single, constant ice hardness parameter $B$.  Left: Observed radar-derived (white) and modeled (black) ice velocities are nearly coincident across the whole Ross ice shelf.  The grounding line, at which observed velocities were applied as boundary conditions, is the thin black curve.  Right: This scatter plot has one point for each velocity arrow at left.}{3.1in}{2.7in}


\subsection{A summary of numerical ice sheet modelling}

These notes illustrate some general principles about numerical modelling:
\begin{itemize}
\item Spend time with the continuum model.
\item Modularize your codes.
\item Test the parts: Is the component robust? Does it show convergence to exact solutions?
\end{itemize}

Regarding the specific problems of ice flow, distributed stress balance equations like the SSA determine horizontal velocity from geometry and boundary conditions.  These equations are nonlinear so iteration is necessary.  At each iteration a sparse matrix ``inner'' problem is solved; non-experts should give this matrix problem to a solver package.  The SIA stress balance is not horizontally-distributed, however, and velocity follows immediately by integration of the driving stress.

The mass continuity equation has a time-derivative, and it describes how the ice geometry evolves.  The numerical nature of this equation depends on which is the stress balance which supplies the velocity.  It is a diffusion for frozen bed, large scale flows (SIA).  It is \emph{not} very diffusive for membrane stresses (e.g.~SSA), especially with no basal resistance as in ice shelves.  It has some diffusiveness for ice streams (but how much?), and more for outlet glaciers.  In any case it is a kind of transport equation, but with diffusive character at larger spatial scales.


\small
\subsection{Notes} \label{sec:nr}

The SIA model is derived by scaling the Stokes equations using the aspect ratio $\eps = [H]/[L]$, where $[H]$ is a typical thickness of an ice sheet and $[L]$ is a typical horizontal dimension, after which you drop the terms that are small if $\eps$ is small \cite{Fowler,Hutter}; this is a ``small-parameter argument''.  Note that in one such derivation this means dropping only terms of $\eps^2$ and smaller as there are no $O(\eps)$ terms in the scaled equations \cite{Fowler}.  The SIA was derived by several authors \cite{FowlerLarson1978,Hutter,MorlandJohnson}.  It is re-formulated as a well-posed free boundary problem in \cite{JouvetBueler2012}, thereby providing the correct boundary condition at grounded margins.  The diffusivity is here computed numerically following \cite{Mahaffy}, but alternative schemes appear in \cite{HindmarshPayne}.

The SSA model was derived in \cite{Morland} for ice shelves and in \cite{MacAyeal} for ice streams.  A review is given by \cite{WeisGreveHutter}.  A well-posed steady whole ice sheet model using only the SSA is in \cite{SchoofStream}.

As noted, basal water is required for ice streaming, and one must compute the ice base temperature and the basal melt rate through the energy conservation equation in order to model evolving ice streams \cite{BBssasliding,Clarke05,Raymondenergy}.  Evidence that outlet glaciers additionally have thick temperate ice is in \cite{Luethietal2009}.

One of the most significant issues in modelling ice sheets is to describe the ``switch'', in space and time, between shear-dominated and membrane-stress-dominated flow.  It is not a good idea to abruptly switch from the SIA model to the SSA model at the edge of an ice stream, by whatever criterion that switch might be applied, though this has been attempted \cite{HulbeMacAyeal,Ritzetal2001}.  Shallow hybrid schemes exist which ``glue together'' the SIA and SSA everywhere in the ice sheet, without such a switch \cite{BBssasliding,Goldberg2011,PollardDeConto}.  Roughly speaking, these shallow hybrids can be used at high spatial resolution and long time scales because the SSA model is an easier stress balance to solve than other membrane-stress-resolving alternatives.

The ``higher-order'' approximations of the Stokes equations \cite{Blatter,Pattyn03} are, nonetheless, shallow approximations.  As both the SIA and the SSA are derived by small-parameter arguments from the Stokes equations, one might ask whether there is a common shallow antecedent model.  To which Schoof and Hindmarsh \cite{SchoofHindmarsh} answer that the Blatter-Pattyn model \cite{Blatter,Pattyn03} is such an antecedent.  That is, one can use small-parameter arguments to derive the Blatter-Pattyn model, then get either SIA or SSA by additional small-parameter limits.  Computational limitations generally restrict either the spatial extent, the spatial resolution, or the model run duration of the more complete ``higher-order'' and Stokes models.  Questions remain about what is lost, relative to the Stokes model, in both the higher-order \cite{ISMIPHOM} and shallow hybrid models.  Solving the Stokes model requires explicit accounting for incompressibility---a constraint on the flow---through a pressure variable.  In the flow line one can address the incompressibility constraint by using stream functions \cite{BaliseRaymond1985}.

Which are the best numerical models for moving grounding lines?  Even when the minimal SSA stress balance is used, this is still an open question \cite{Goldbergetal2009,SchoofMarine1}.  The physics requires at least that the quantities $H$ and $u$ are continuous at $x=x_g$.

Where to get exact solutions for ice flow models?  The textbook Greve and Blatter \cite{GreveBlatter2009} has a few.  Halfar's similarity solution to the SIA \cite{Halfar81,Halfar83} was generalized to non-zero mass balance by Bueler et al. \cite{BLKCB}.  There are manufactured solutions to the thermomechanically-coupled SIA in  \cite{BBL}.  (Manufactured solutions start with a specified solution and then typically derive a source term or the right-hand side  so that the specified solution actually is a solution \cite{Roache}.)  There are flowline \cite{vanderVeen83} and cross-flow \cite{SchoofStream} solutions to the SSA model.  There are flowline Blatter model solutions \cite{GlowinskiRappaz}.  For the Stokes equations themselves there are flowline solutions for constant viscosity \cite{BaliseRaymond1985} and manufactured solutions in the Glen flow law case \cite{JouvetRappaz2011,SargentFastook2010}.

A key modelling issue omitted in this chapter is thermomechanical coupling.  This is important because the ice softness $A(T)$ varies by $10^3$ in the temperature range relevant to ice sheet modelling.  Ice temperature gives ice sheets a long memory of past climate, and geothermal flux is significant in slow flowing parts of ice sheets.  Equally important, dissipation of gravitational potential energy is major part of basal melt.  For example, each year the Jakobshavn drainage basin in Greenland dissipates enough gravitational potential energy to melt more than $1\,\text{km}^3$ of ice.  ``Enthalpy'' is good way to track energy content polythermally \cite{AschwandenBuelerKhroulevBlatter}, but it is not the only way \cite{Greve}.

The following additional modelling topics are \emph{not} covered here: subglacial hydrology and processes \cite{Clarke05}, mass balance and snow/firn process modelling, constitutive relations other than Glen isotropic, evolving calving fronts \cite{Albrechtetal2011}, ocean-ice interaction, paleo-climate and ``spin-up'', and earth deformation under ice load \cite{Peltier1998review}.

The finite difference material in this Chapter should probably be read with reference \cite{MortonMayers} in hand.  The ``main theorem for numerical PDE schemes'' mentioned in the text is the Lax equivalence theorem.  Alternative numerical discretization techniques which are not mentioned here include the finite element \cite{Braess}, finite volume \cite{LeVeque}, and spectral \cite{Trefethen} methods.  We also do not address advanced methods for solving the discretized equations, such as multigrid and parallel methods.  Nor do we use Newton iteration \cite{Kelley} for the nonlinear discrete equations, thought it is superior to Picard iteration.


\footnotesize
\bibliography{ice_bib}
\bibliographystyle{siam}


\clearpage\newpage
\small
\section*{Exercises}

\newcommand{\exer}[2]{\medskip\noindent \textbf{#1.}\quad #2}

Note:  \emph{At Karthaus 2012 there is no dedicated time for these exercises.  They are suitable for the needs of careful readers of these notes, however, because they fill in missing material, and they help make the main ideas concrete.}


\exer{1}{Assume $f$ has continuous derivatives of all orders.  Show
  $$f'(x) = \frac{f(x+\Delta) - f(x-\Delta)}{2\Delta} + O(\Delta^2) \quad \text{and} \quad f''(x) = \frac{f(x+\Delta) - 2 f(x) + f(x-\Delta)}{\Delta^2} + O(\Delta^2)$$
using Taylor's theorem with remainder.}

\exer{2}{Sometimes we want finite difference approximations to derivatives in-between grid points.  Continuing exercise \textbf{1}, show $f'(x+(\Delta/2)) = (f(x+\Delta) - f(x))/\Delta + O(\Delta^2)$.}

\exer{3}{Rewrite \texttt{heat.m} using \texttt{for} loops instead of colon notation.}

\exer{4}{The 1D explicit scheme \eqref{heat1Dfd} for the heat equation, namely $T_j^{n+1} = \mu T_{j+1}^n + (1 - 2 \mu) T_j^n + \mu T_{j-1}^n$, is an average if stability criterion \eqref{stabcrit} holds.  But of course we must be stepping \emph{forward} in time also ($\Delta t>0$)!  Show, by contrast, that if the time step is negative then the scheme is not an average (= positive coefficients which sum to one) for any values of $\Delta t$ and $\Delta x$.  Also, try running \texttt{heat.m} backward in time to see what happens.  In conclusion, \emph{there are no stable numerical schemes for unstable PDE problems}.}

\exer{5}{Show that when written as a formula for $T_j^{n+1}$, scheme \eqref{implicit1D} has only positive coefficients.  By looking into the literature as needed, explain why this implies that it is unconditionally stable.}

\exer{6}{\emph{This multi-part exercise concerns the numerical treatment of ``$\Div\left(D\,\grad\right)$''.} 
\renewcommand{\labelenumi}{(\alph{enumi})}
\begin{enumerate}
\item Show that if $D=D(x,y)$ and $u=u(x,y)$ then $\Div \left(D\, \grad u\right) = D \grad^2 u + \grad D \cdot \grad u$.
\item Write down the centered $O(\Delta t)+O(\Delta x^2)$ explicit finite difference method for the equation $u_t = D_0 u_{xx} + E_0 u_x$, assuming $D_0>0$ and $E_0$ are constant.  Solve the scheme for the unknown $u_j^{n+1}$. 
\item Stability for your method will occur if the right hand side from the last answer in part (b) has all positive coefficients.  If $|E_0| \gg D_0$, what does this say about $\Delta t$?
\item Why we keep ``$\Div\left(D\,\grad\right)$'' in that form and use the staggered grid?
\end{enumerate}
}

\exer{7}{Derive the Green's function of the heat equation, namely $T = (4 \pi D t)^{-1/2}\, e^{-x^2/(4Dt)}$ as a solution to $T_t=D T_{xx}$.  Start by supposing there is a solution of the form $T(t,x) = t^{-1/2} \phi(s)$ where $s=t^{-1/2}x$ is the similarity variable.  Thereby write down an ordinary differential equation and solve it.}

\exer{8}{In the text, and in code \texttt{verifysia.m}, we used Halfar's solution to verify our numerical scheme \texttt{siaflat.m}.  Create the analogous code \texttt{verifyheat.m} to use the Green's function of the 2D heat equation \eqref{heat2D}, namely $T(t,x,y) = (4 \pi D t)^{-1}\, e^{-(x^2+y^2)/(4Dt)}$, to verify \texttt{heatadapt.m}.  You can use the high quality approximation $e^{-A^2}\approx 0$ for $|A|>10$ to choose a rectangular domain in space for which you may use $T=0$ Dirichlet boundary conditions.}

\exer{9}{Is P.~Halfar male or female, and what does the first initial ``P.'' stand for?}

\exer{10}{Show that formula \eqref{halfar} solves \eqref{sia} in the case of flat bed (so $h=H$) and zero climatic mass balance ($M=0$).  You will want to express divergence and gradient in polar coordinates.}

\exer{11}{In the text it is claimed that any modification of \texttt{siaflat.m} will make the output of \texttt{verifysia.m} show non-convergence, e.g.~the reported average thickness error will not go to zero as the grid is refined.  By randomly altering lines of \texttt{siaflat.m}, evaluate this claim.}

\exer{12}{Some output from \texttt{verifysia.m} has been suppressed in the text.  It also shows the numerical ice thickness error in map-plane view.  Near the grounded margin of an ice sheet this error is much larger than elsewhere.  Why?}

\exer{13}{Get the surface kinematical equation \eqref{surfkine} from the mass continuity \eqref{masscont} and basal kinematical \eqref{basekine} equations.  Do one more permutation too.  Note that the Leibniz rule for differentiating integrals, which was mentioned in the text, is
  $$\frac{d}{dx}\left(\int_{g(x)}^{f(x)} h(x,y)\,dy\right) = f'(x) h(x,f(x)) - g'(x) h(x,g(x)) + \int_{g(x)}^{f(x)} h_x(x,y)\,dy.$$}

\exer{14}{Let $C_s = A (\rho g (1-r)/4)^n$ and assume $x_g=0$ is the location of the grounding line.  Derive the two parts of the van der Veen exact ice shelf solution, namely
\begin{align*}
  u &= \left[ u_g^{n+1} + (C_s/M_0) \left((M_0 x + u_g H_g)^{n+1} - (u_g H_g)^{n+1}\right) \right]^{1/(n+1)}, \quad H = (M_0 x + u_g H_g) / u,
\end{align*}
Start from equation \eqref{ssafloat}, and use the fact $(H^2)_x = 2 H H_x$ to generate the first integral of \eqref{ssafloat}.  Also use boundary condition \eqref{calvingstress}.  On the other hand, note that the mass continuity equation $M_0=(uH)_x$ can be integrated to give the formula $uH = M_0 (x-x_g) + u_g H_g$ for the flux.  Find $u(x)$ first, then $H(x)$ is in terms of $u(x)$ as above.  These exact solutions are from \cite{vanderVeen83}.  They are used in code \texttt{exactshelf.m}.}

\exer{15}{Modify the code \texttt{ssaflowline} to solve the ice stream version of the SSA \eqref{ssa}.  For boundary conditions it would be reasonable to have fixed velocity at the upstream end and keep the calving front boundary condition at the downstream end, as in thec case that the calving front is at the point where the ice stream reaches flotation.  Build a test case; can you find an exact solution?}

\end{document}
