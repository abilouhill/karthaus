\documentclass[titlepage,letterpaper,final,12pt]{scrartcl}

\usepackage[total={6.0in,8.75in},top=1.2in,left=1.35in]{geometry}

% this lets us avoid the scrartcl/hyperref conflict...
%\let\ifvtex\relax

\usepackage{verbatim}
\usepackage{empheq}
\usepackage{color}
\usepackage{animate}
\usepackage{graphicx}
\usepackage{fancyvrb}

% hyperref should be the last package we load
\usepackage[pdftex,
colorlinks=true,
plainpages=false, % only if colorlinks=true
linkcolor=blue,   % only if colorlinks=true
citecolor=blue,   % only if colorlinks=true
urlcolor=blue     % only if colorlinks=true
]{hyperref}

\pdfinfo{
/Title (Numerical modelling of ice sheets, streams, and shelves)
/Author (Ed Bueler)
/Subject (numerical modelling of glaciers, ice sheets, and ice shelves)
/Keywords (numerical model, numerical analysis, glacier, ice sheet, ice shelf, shallow models of ice flow)
}

\newcommand{\ddt}[1]{\ensuremath{\frac{\partial #1}{\partial t}}}
\newcommand{\ddx}[1]{\ensuremath{\frac{\partial #1}{\partial x}}}
\newcommand{\ddy}[1]{\ensuremath{\frac{\partial #1}{\partial y}}}
\newcommand{\pp}[2]{\ensuremath{\frac{\partial #1}{\partial #2}}}
\renewcommand{\t}[1]{\texttt{#1}}
\newcommand{\Matlab}{\textsc{Matlab}\xspace}
\newcommand{\bq}{\mathbf{q}}
\newcommand{\bU}{\mathbf{U}}
\newcommand{\eps}{\epsilon}
\newcommand{\grad}{\nabla}
\newcommand{\Div}{\nabla\cdot}
\newcommand{\devstress}{\tau}

\newcommand{\mmess}[1]{\vspace{-0.1in}\begin{center}
\fbox{\url{http://www.dms.uaf.edu/~bueler/mccarthy/mfiles/#1.m}}
\end{center}}

%\newcommand{\minput}[1]{\small\verbatiminput{../mfiles/#1.slim.m}
%\tiny\mmess{#1}\normalsize}

\newcommand{\minput}[1]{
\bigskip
\begin{quote}
\bigskip
\VerbatimInput[frame=single,framesep=3mm,label=\fbox{\normalsize \textsl{\,#1.m\,}},fontfamily=courier,fontsize=\scriptsize]{../mfiles/#1.slim.m}
\bigskip
\end{quote}
}

%\onefig{name}{caption}
\newcommand{\onefig}[2]{
\begin{figure}[ht]
\centering
\includegraphics[width=3.0in,keepaspectratio=true]{#1}
\caption{#2}
\label{fig:#1}
\end{figure}}

%\twofig{left-name}{right-name}{caption}
\newcommand{\twofig}[3]{
\begin{figure}[ht]
\centering
\includegraphics[width=2.5in,keepaspectratio=true]{#1} \quad
\includegraphics[width=2.5in,keepaspectratio=true]{#2}
\caption{#3}
\label{fig:#1}
\end{figure}}


\newcommand{\alert}[1]{\emph{#1}}



\begin{document}
\graphicspath{{../photos/}{../pdffigs/}}


\begin{titlepage}

  \begin{center}
    {\Large\usekomafont{title} Numerical modelling \\ of ice sheets, streams, and shelves}
    \vspace{0.5cm}

    {\large Ed Bueler}
    \vspace{1cm}

    September 2012

    \vfill
    
    \includegraphics[width=6.0in]{flowline}
  
    \scriptsize \emph{Illustrates the notation used in this chapter.  Figure modified from \cite{SchoofMarine1}.} \normalsize
    
    \vspace{2.0in}
  \end{center}
\end{titlepage}


%\section{Numerical modelling of ice sheets, streams, and shelves}
\setcounter{section}{1}
\subsection{Introduction}

Numerical models can, if well-constructed, actually help understand the behavior of particular glaciers, ice sheets, and ice shelves.  Their most common use may be so that a researcher to ask: when I put together the incomplete understanding of these processes, does the combination behave as I expect, and why does it behave the way I see?  Numerical models rarely generate new theoretical understandings---a human brain seems to be needed to get new insights from observations---but they can surely can demonstrate flaws in the understanding of glacier processes, or in how processes interact to give overall behavior.

But numerical models should be built with care.  The worst outcome is to have a researcher spend time explaining, through physical argumentation and using observational evidence, some model behavior that is simply an artifact of poor computer programming or numerical analysis.  The reader of this chapter may be surprised that the continuum model seems to be much of our focus, but this is because our \emph{intention} to approximate the continuum model requires that we \emph{analyze} the numerical implementation to check that it matches the intent.  All numerical codes produce numbers of some kind, and many produce pretty pictures, but here we want numbers that reflect our intended continuum model.

This chapter has limited goals:
  \begin{enumerate}
  \item we focus on approximating ice flow, and
  \item we provide example numerical codes that actually work.
  \end{enumerate}
But our scope is limited also.  Among the continuum models covered here are the shallow ice approximation (SIA) in two horizontal dimensions (2D), the shallow shelf approximation (SSA) in 1D, and the mass continuity and surface kinematical equations.  We briefly describe the Stokes equations, but we do not address their numerical solution.  The numerical ideas include finite difference schemes, solving algebraic systems from stress balances, and the verification of numerical codes, but we do not use the finite element or spectral methods.

For more on numerical modelling topics not covered here, see the Notes and References section at the end of this chapter.

Our notation generally consistent with the glaciological literature, and other parts of the present book, but Table \ref{tab:notation} gives a summary.  Coordinates are $t,x,y,z$, with $z$ vertical, positive upward, and subscripts are used for partial derivatives: $u_x = \partial u/\partial x$.
%consistent with \cite{BLKCB,BBssasliding,Fowler,GreveBlatter2009,SchoofStream,SchoofMarine1}

%FIXME: how many codes are displayed?  how many hidden but needed?
This chapter is structured around fourteen Matlab/Octave codes, each of which is about one-half of a page.  These are available in \texttt{.zip} and \texttt{.tar.gz} forms online at:\footnote{Or on a USB drive at Karthaus available from memory stick}

\medskip
  \centerline{\fbox{\url{http://www.dms.uaf.edu/~bueler/karthaus/}}}

\begin{table}% table1, one column
\caption{Common notation used in this chapter.}
\label{tab:notation}
\begin{tabular}{cll}
variable  & description & SI units \\ 
\hline
$A$ & $A=A(T)=$ ice softness in the Glen flow law & $\text{Pa}^{-3}\,\text{s}^{-1}$ \\
$B$ & ice hardness; $B=A^{-1/n}$ & $\text{Pa}\,\text{s}^{1/3}$ \\
$b$ & bedrock elevation & m \\
$g$ & gravity & m s$^{-2}$ \\
$H$ & ice thickness & m \\
$h$ & ice surface elevation & m \\
$M$ & climatic mass balance & m a$^{-1}$ \\
$n$ & exponent in Glen flow law & \\
$\rho$ & density of ice & kg m$^{-3}$ \\
$\rho_w$ & density of sea water & kg m$^{-3}$ \\
$T$ & ice temperature & K \\
$\mathbf{u}$ & $=(u,v,w)$ ice velocity & m s$^{-1}$ \\
\end{tabular}
\end{table}

\subsubsection*{Ice flow equations}  My first goal in these notes is to get to an equation for which I can say:
\begin{center}
\emph{numerically solve just this equation, and you've got a usable model for a flowing ice sheet.}
\end{center}
To get to my goal I will quickly recall the continuum mechanics of ice flow.  But note that a ``usable'' model is \emph{understood} more than it is \emph{correct}!

Ice in glaciers is a \emph{fluid}.  Thus we describe fluids primarily by a \emph{velocity field} $\mathbf{u}(t,x,y,z)$.  If the ice fluid were either faster-moving than it actually is (e.g., because gravity was much stronger), or if it was linearly-viscous like liquid water, or both, then ice flow would be a more-familiar, ``typical'' fluid.  In that case we would all use the Navier-Stokes equations as our flow model:
\begin{align}
\nabla \cdot \mathbf{u} &= 0 &&\text{\emph{incompressibility}} \label{incompressible} \\
\rho \left(\mathbf{u}_t + \mathbf{u}\cdot\nabla \mathbf{u}\right) &= -\nabla p + \nu \nabla^2 \mathbf{u} + \rho \mathbf{g} &&\text{\emph{force balance}} \label{stokes}
\end{align}

You say ``\emph{hmmm} \dots \emph{does not sound like glaciology to me!}''  Indeed, is numerical ice flow modeling a part of computational fluid dynamics?  My answer is emphatically ``yes'', and it is clearly a large scale fluid problem like atmosphere and ocean in climate systems.  But it is a weird one!  Consider what makes atmosphere/ocean flow modeling exciting:
  \begin{center} turbulence \qquad convection \qquad  coriolis force  \qquad salinity variation \qquad chemistry
  \end{center}
None of the above list is relevant to ice flow!  So what could be interesting about the flow of slow, cold, stiff, laminar, inert old ice?  Of course, it's \emph{ice dynamics!}

First we might observe that ice is a slow, shear-thinning fluid.  In terms of equations, ``slow'' implies that$\rho \left(\mathbf{u}_t + \mathbf{u}\cdot\nabla \mathbf{u}\right) \approx 0$, which is to say that the forces of inertia are negligible.  while ``non-Newtonian'' implies that the viscosity $\nu$ in \eqref{stokes} is not constant.  In face ice is ``shear-thinning'' flow, so that bigger strain rate means smaller viscosity.  Thus the standard ``full'' model is Glen-law ($n=3$) Stokes:
\begin{align}
\nabla \cdot \mathbf{u} &= 0 &&\text{\emph{incompressibility}} \label{incompressibleagain} \\
0 &= - \nabla p + \nabla \cdot \tau_{ij} + \rho \mathbf{g} &&\text{\emph{force balance}} \label{forcebalance} \\
\mathbf{D}_{ij} &= A \tau^2 \tau_{ij} &&\text{\emph{flow law}} \label{flowlaw}
\end{align}

These equations above are true at every instant, and thus geometry, boundary stress, and ice viscosity determine velocity instantaneously.  A time-stepping numerical ice sheet code recomputes the full velocity field at every time step, without requiring velocity from the previous step.  Thus such a model has no memory of previous momentum/velocity, and velocity is a ``diagnostic'' output of an ice flow model.

Consider now the  $x,z$ plane flow case.  The Stokes equations say
\begin{empheq}[]{align}
u_x + w_z &= 0 &&\text{\emph{incompressibility}} \label{incompressiblexz} \\
p_x &= \tau_{11,x} + \tau_{13,z} &&\text{\emph{stress balance} ($x$)} \label{stokespx} \\
p_z &= \tau_{13,x} - \tau_{11,z} - \rho g &&\text{\emph{stress balance} ($z$)} \label{stokespz} \\
u_x &= A \tau^2 \tau_{11} &&\text{\emph{flow law} (diagonal)}  \label{forceflowx} \\
u_z + w _x &= 2 A \tau^2 \tau_{13} &&\text{\emph{flow law} (off-diagonal)} \label{forceflowz}
\end{empheq}
Here $x,z$ subscripts are partial derivatives.  Note that $\tau_{13}$ is a ``vertical'' shear stress while $\tau_{11}$ and $\tau_{33}=-\tau_{11}$ are deviatoric longitudinal stresses.  We have five equations in five unknowns ($u,w,p,\tau_{11},\tau_{13}$).  This is complicated enough to make many researchers pause before jumping in to a solution method.  So, what about in a simplified situation?


\onefig{slab}{Configuration of slab-on-a-slope flow calculation.}

\subsubsection*{Slab-on-a-slope}  Our first example is both a case in which we actually solve the Stokes equations, and a primary example to motivate the shallow model which follows.  Consider the two-dimensional axes ($x$,$z$) show in Figure \ref{fig:slab}, which are rotated downward at angle $\alpha>0$ so that the gravity vector has components $\mathbf{g} = (g \sin\alpha,- g \cos \alpha)$.  (We will only use rotated coordinates in this one example.)  Equations \eqref{stokespx}, \eqref{stokespz}, which were stated for un-rotated coordinates, are now:
\begin{align}
p_x &= \tau_{11,x} + \tau_{13,z} + \rho g \sin\alpha, \label{stokespxrot} \\
p_z &= \tau_{13,x} - \tau_{11,z} - \rho g \cos\alpha. \label{stokespzrot}
\end{align}
But for a slab-on-a-slope there is no variation in $x$ so the whole set of Stokes Equations \eqref{incompressiblexz}, \eqref{stokespxrot}, \eqref{stokespzrot}, \eqref{forceflowx}, \eqref{forceflowz} simplify:
\begin{align}
w_z &= 0 &   0 &= \tau_{11} \label{slabblock} \\
\tau_{13,z} &= - \rho g \sin\theta &   u_z &= 2 A \tau^2 \tau_{13} \notag \\
p_z &= - \rho g \cos\theta \notag
\end{align}
We apply boundary conditions:
	$$w(\text{base})=0, \qquad p(\text{surface})=0, \qquad u(\text{base})=u_0$$
By integrating vertically, we get $w=0$, $p = \rho g \cos\theta (H-z)$, and a linear increase with depth for the shear stress,
	$$\tau_{13} = \rho g \sin\theta (H-z)$$
From ``$u_z = 2 A \tau^2 \tau_{13}$'' we finally get a formula for the horizontal velocity,
\begin{align}
u(z) &= u_0 + 2 A (\rho g \sin\theta)^3 \int_0^z (H-z')^3\,dz' \label{uslab} \\
     &= u_0 + \frac{1}{2} A (\rho g \sin\theta)^3  \left(H^4 - (H-z)^4\right) \notag
\end{align}

Do we believe these equations?  Figure \ref{fig:slabvel} compares the velocity from equation \eqref{uslab} to observations of a mountain glacier.  Note, however, that we do not yet have a model for the sliding velocity $u_0$.  We have, however, done a credible job of capturing the deformation flow velocity.

\twofig{slabvel}{athabasca_deform}{Left: velocity from the slab-on-a-slope example calculation.  Right: velocity measured in a mountain glacier, the Athabasca Glacier in Canada, derived from inclinometry \cite{SavagePaterson}.}

Now that we have calculated the velocity $u=u(t,x,z)$ \dots so what?  In a realistic case there might be measurements to compare to, but very often modellers just switch to considering another equation, namely the \emph{mass continuity} equation.  In fact, suppose our slab has variable thickness $H(t,x)$ and compute the vertical average of velocity:
	$$\bar u(x,t) = \frac{1}{H}\int_0^{H} u(t,x,z)\,dz.$$
This is the rate of input into the side of the ice shown in Figure \ref{fig:slabmasscontfig}.  So consider the change of area in the figure---this would instead be the ice volume in three-dimensions:
	$$\frac{dA}{dt} = \int_{x_1}^{x_2} M(x)\,dx + \bar u_1 H_1 - \bar u_2 H_2$$
Assuming width $dx=x_2-x_2$ is small, $A\approx dx\, H$, we divide by $dx$ and get
\begin{equation}
H_t = M - \left(\bar u H\right)_x \label{masscont1D}
\end{equation}
This is a mass continuity equation.  It describes the change in the ice thickness in terms of spatial derivatives ``$(\cdot)_x$'' of the vertical integral of the ice velocity.  We will return to this equation and consider its meaning, variations, and numerical solution.

\onefig{slabmasscontfig}{FIXME}

Our slab-on-a-slope example gives us a rough explanation of ``shallow ice approximation'' (SIA) which we will use below.  Indeed, from the slab-on-slope velocity formula \eqref{uslab} in the $u_0=0$ case (``non-sliding SIA'') we get
\begin{align*}
\bar u H &= \int_0^H \frac{1}{2} A (\rho g \sin\theta)^3  \left(H^4 - (H-z)^4\right)\,dz \\
	&= \frac{1}{2} A (\rho g \sin\theta)^3  \left(\frac{4}{5} H^5\right) \\
	&= \frac{2}{5} A (\rho g \sin\theta)^3 H^5
\end{align*}
Note that $\sin \theta \approx \tan\theta = - h_x$.  Combining these with with mass continuity \eqref{masscont1D} gives
  $$H_t = M + \left(\frac{2}{5} (\rho g)^5 A H^5 |h_x|^2 h_x\right)_x.$$
This equation is the ``SIA'', which we will numerical solve and seek to understand mathematically, next.


\subsection{Shallow ice sheets}  Ice sheets ice sheets have four outstanding properties as fluids.  They are
  \begin{enumerate}
  \item slow,
  \item non-Newtonian,
  \item have contact slip (sometimes),
  \item and they are shallow.
  \end{enumerate}
In fact, regarding ``shallow'', Figure \ref{fig:green_transect} shows in red the a no-vertical-exaggeration version of a cross section of Greenland at $71^\circ$.  The vertically-exaggerated shape also shown in that Figure is far more familiar in the glaciological literature, but we should remember that these flows are really thin.

\onefig{green_transect}{The standard vertically-exaggerated cross section of the Greenland ice sheet $71^\circ$ north latitude.  The version without such exaggeration is in red.}

So what are the equations describing ice sheets?  In fact the slab-on-a-slope example gives us the key equations, next, but additional arguments are needed to show they are general-purpose.  Here we present the equations as an ice sheet geometry-evolution model, and consider how to think about the solutions of these equations.  In the next section we will solve them numerically.  See Notes and References for the general arguments that derive it from the Stokes equations, under the assumptions that slopes are small and the depth to width ratio is also small.

\subsubsection*{The shallow ice approx (SIA)}  This model is the non-sliding, isothermal shallow ice approximation or ``SIA'' for short.  It is a model which applies to small depth-to-width ratio (``shallow'') grounded ice sheets on not-too-rough bed topography, whose flow is not dominated by sliding and/or liquid water at the base or margin.

The SIA uses the formulas from slab-on-a-slope, but we generalize to two horizontal dimensions.  Let $\mathbf{u} = (u,v)$ be the vector horizontal velocity.  Then we have a:
\begin{itemize}
\item shear stress approximation:
	$$(\tau_{13},\tau_{23}) \approx - \rho g (h-z) \nabla h$$
\item and a further approximation of the shear strain rates in planes parallel to the geoid:
\begin{align*}
\mathbf{u}_z &\approx 2 A |(\tau_{13},\tau_{23})|^{n-1} (\tau_{13},\tau_{23}) \\
     &= - 2 A (\rho g)^n (h-z)^n |\nabla h|^{n-1} \nabla h.
\end{align*}
\end{itemize}
By integrating vertically, in the non-sliding case,
    $$\mathbf{u} = - \frac{2 A (\rho g)^n}{n+1} \left[H^{n+1} - (h-z)^{n+1}\right] |\nabla h|^{n-1} \nabla h.$$
Mass continuity also applies:
    $$H_t = M - \left(\overline{\mathbf{u}} H\right)_x$$


Combining the last two equations and defining a positive constant $\Gamma = 2 A (\rho g)^n / (n+2)$, we get an equation how thickness changes:
\begin{empheq}[box=\fbox]{equation}
H_t = M + \Div \left(\Gamma H^{n+2} |\grad h|^{n-1} \grad h \right) \label{sia}
\end{empheq}
This is the SIA equation.  To review the notation, ere $H$ is ice thickness, $h$ is ice surface elevation, $b$ is bed elevation ($h=H+b$), $M$ combines surface and basal mass (im)balance (it is accumulation if $M>0$ and ablation if $M<0$).  If we just solve \eqref{sia} numerically then we get a usable model for the Barnes ice cap, for example \cite{Mahaffy}.  It is a particularly simple ice sheet on a very flat bed with minimal evidence for sliding.

Some good questions about \eqref{sia}:
\begin{enumerate}
\item where does it come from?
\item how to solve it numerically?
\item how to \emph{think} about it?
\end{enumerate}
We will address the last two, and leave the first for the Notes and References.


\subsubsection*{Analogy with the heat equation}  An obigatory step in using the SIA \eqref{sia} is to understand that is a continuum model which is analogous to the better known heat equation, and furthermore that all numerical methods for solving \eqref{sia} can be understood as modifications of well-known methods for solving the heat equation.

Recall first that the heat equation comes from simple empirical observations like Newton's law of cooling, the ordinary differential equation
	$$\frac{dT}{dt} = -K (T-T_{\text{ambient}})$$
where $T$ is object temperature and $K$ relates to material and geometry of object (e.g.~cup of coffee).  That is, the temperature of an object tends to decay exponentially to the temperature of its surroundings (ambient temperature).  One way to derive the heat equation, which is a partial differential equation is to argue that the segments of a rod also satisfy Newton's law of cooling, but that the ``ambient'' temperature seen by segment $j$ of a rod is the temperature of its neighbors:
\begin{align*}
\frac{dT_j}{dt} &= -K \left(T_j - \frac{1}{2} (T_{j-1} + T_{j+1}) \right) \\
	&= \frac{K}{2} \left(T_{j-1} - 2 T_j + T_{j+1}\right).
\end{align*}
As segment lengths shrink to zero we see an approximation of the second derivative with respect to $x$ on the right, a finite difference formula \cite{MortonMayers}, so that the distributed temperature of a rod satisfies
	$$T_t = D T_{xx}.$$
This is the one spatial dimension heat equation when material properties are constant.  The constant $D$ is the ``diffusivity''.

The more complete 2D version of the heat equation describes the temperature $T(t,x,y)$ at position $x,y$ in an object, at time $t$  Because Fourier rewrote Newton's law as a rule for heat flux ($\mathbf{q} = - k \grad u$), and if we allow an additional heat source $f$, conservation of energy gives us the standard heat equation:
	$$\rho c u_t = f + \Div (k \grad u).$$
Here $\rho$ is density, $c$ is specific heat, and $k$ is conductivity.
Define the ``diffusivity constant'' $D=k/(\rho c)$ and also $F := f/(\rho c)$.  Then the heat equation is
\begin{equation}
T_t = F + \Div (D\, \grad T). \label{heat}
\end{equation}

Where is the analogy with the SIA?  Heat equation \eqref{heat} and SIA \eqref{sia} are both diffusive, time-evolving partial differential equations (PDE).  A side-by-side comparison is illuminating:
\begin{center}
\begin{tabular}{cc}
SIA:\, $H(t,x,y)$ is ice thickness & heat: $T(t,x,y)$ is temperature \\
	\boxed{H_t = M + \Div \left({\color{red}\Gamma H^{n+2} |\grad h|^{n-1}}\, \grad h \right)}  &  \boxed{T_t = F + \Div (D\, \grad T)}
\end{tabular}
\end{center}
We identify the diffusivity in the SIA:
	$$D = {\color{red}\Gamma H^{n+2} |\grad h|^{n-1}}.$$
The non-sliding shallow ice flow \alert{diffuses} the ice sheet.

However, there are some issues with this analogy:
  \begin{itemize}
  \item thickness $H$ and surface elevation $h$ are not the same unless the bed is flat,
  \item $D$ depends on the solution $H(t,x,y)$,
  \item $D$ goes to zero at margins, where $H\to 0$, and
  \item $D$ goes to zero at divides and domes, where $|\grad h|\to 0$.
  \end{itemize}


\subsection{finite difference numerics}

numerics for heat equation: basic ideas of finite differences

\begin{itemize}
\item numerical schemes for heat equation are good start for SIA
\item for differentiable $f(x)$ and any $h$, \emph{Taylor's theorem} says
	$$f(x+h) = f(x) + f'(x) h + \frac{1}{2} f''(x) h^2 + \frac{1}{3!} f'''(x) h^3 + \dots$$
\item you can replace ``$h$'' by multiples of $\Delta x$, e.g.:
\begin{align*}
f(x-\Delta x) &= f(x) - f'(x) \Delta x + \frac{1}{2} f''(x) \Delta x^2 - \frac{1}{3!} f'''(x) \Delta x^3 + \dots \\
f(x+2\Delta x) &= f(x) + 2 f'(x) \Delta x + 2 f''(x) \Delta x^2 + \frac{4}{3} f'''(x) \Delta x^3 + \dots
\end{align*}
\item \emph{combine expressions like these to give approximations of derivatives, from values on a grid}
\end{itemize}

finite differences for partial derivatives

\begin{itemize}
\item we want partial derivative expressions, for example with $u=u(t,x)$:
\begin{align*}
u_t(t,x) &= \frac{u(t+\Delta t,x) - u(t,x)}{\Delta t} + O(\Delta t), \\
u_t(t,x) &= \frac{u(t+\Delta t,x) - u(t-\Delta t,x)}{2\Delta t} + O(\Delta t^2), \\
u_x(t,x) &= \frac{u(t,x+\Delta x) - u(t,x-\Delta x)}{2\Delta x} + O(\Delta x^2), \\
u_{xx}(t,x) &= \frac{u(t,x+\Delta x) - 2 u(t,x) + u(t,x-\Delta x)}{\Delta x^2} + O(\Delta x^2)
\end{align*}
and so on
\item sometimes we want a derivative in-between grid points:
	$$u_x(t,x+(\Delta x/2)) = \frac{u(t,x+\Delta x) - u(t,x)}{\Delta x} + O(\Delta x^2)$$
\item ``$+O(h^2)$'' is better than ``$+O(h)$'' if $h$ is a small number
\end{itemize}

explicit scheme for heat equation

\begin{itemize}
\item consider 1D heat equation $u_t = D u_{xx}$
\item an \emph{explicit} scheme:
	$$\frac{u(t+\Delta t,x) - u(t,x)}{\Delta t} = D\,\frac{u(t,x+\Delta x) - 2 u(t,x) + u(t,x-\Delta x)}{\Delta x^2}$$
\item the difference between the equation $u_t = D u_{xx}$ and the scheme is $O(\Delta t,\Delta x^2)$ (Morton and Mayers, 2005)\nocite{MortonMayers}
\item notation: $(t_n,x_j)$ and $u_j^n \approx u(t_n,x_j)$
\item let $\nu = D \Delta t / (\Delta x)^2$, so
	$$u_j^{n+1} = \nu u_{j+1}^n + (1 - 2 \nu) u_j^n + \nu u_{j-1}^n$$
\end{itemize}


explicit scheme in two space dimensions

\begin{itemize}
\item recall heat equation in 2D: $u_t = D(u_{xx} + u_{yy})$
\item in two spatial variables we write $u_{jk}^n \approx u(t_n,x_j,y_k)$
\item so the 2D explicit scheme is
	$$\frac{u_{jk}^{n+1} - u_{jk}^n}{\Delta t} = D\,\left(\frac{u_{j+1,k}^n - 2 u_{jk}^n + u_{j-1,k}^n}{\Delta x^2} + \frac{u_{j,k+1}^n - 2 u_{jk}^n + u_{j,k-1}^n}{\Delta y^2}\right)$$
\end{itemize}

\begin{center}
\includegraphics[width=2.5in]{expstencil}
\quad
\includegraphics[width=2.5in]{exp2dstencil}

FIXME: identify schemes
\end{center}


implementation

\minput{heat}

\begin{itemize}
\item solves $u_t = D(u_{xx} + u_{yy})$ on square $-1 < x < 1$, $-1 < y < 1$
\item uses gaussian initial condition: $u_0(x,y) = e^{-30 r^2}$
\item uses ``colon notation'' to remove loops over spatial variables
\item \texttt{>>  heat(1.0,30,30,0.001,20)}

approximates $u$ on $30\times 30$ spatial grid, with $D=1$ and $N=20$ steps of $\Delta t = 0.001$
\end{itemize}


the look of success

\begin{itemize}
\item solving $u_t = u_{xx} + u_{yy}$ on $30\times 30$ grid
\end{itemize}


\begin{center}
\includegraphics[width=2.5in]{initialheat}
\quad
\includegraphics[width=2.5in]{finalheat}

initial condition $u(0,x,y)$ \qquad approximate solution $u(t,x,y)$ at $t=0.02$ with $\Delta t=0.001$
\end{center}


the look of instability

\begin{itemize}
\item both figures are from solving $u_t = u_{xx} + u_{yy}$ on the same space grid, but with slightly different time steps
\end{itemize}

\begin{center}
\includegraphics[width=2.5in]{stability}
\quad
\includegraphics[width=2.5in]{instability}

%$D=1,\Delta t = 0.00064286,\Delta x = \Delta y = 0.04$ so
%$D=1,\Delta t = 0.001,\Delta x = \Delta y = 0.04$ so
$\frac{D\Delta t}{\Delta x^2}= 0.402$ \quad
$\frac{D\Delta t}{\Delta x^2}= 0.625$
\end{center}

avoid the instability

\begin{itemize}
\item recall 1D explicit scheme had the form 
	$$u_j^{n+1} = \nu u_{j+1}^n + (1 - 2 \nu) u_j^n + \nu u_{j-1}^n$$
\item thus the new value $u_j^{n+1}$ is an \emph{average} of the old values, \emph{if the middle coefficient is positive}:
	$$1 - 2 \nu \ge 0 \quad \iff \quad  \frac{D\Delta t}{\Delta x^2} \le \frac{1}{2} \quad \iff \quad \Delta t \le \frac{\Delta x^2}{2 D}$$
\item averaging is always stable because averaged wiggles are always smaller than the original wiggles
\item \dots so this condition is a sufficient \emph{stability criterion}
\item so:

\begin{center}
\emph{the result was unstable because the time step was too big}
\end{center}
\end{itemize}

\textsl{adaptive} implementation: guaranteed stability

\mmess{heatadapt}

\begin{itemize}
\item same as \texttt{heat.m} except

\begin{center}
\emph{choose time step from stability criterion}
\end{center}
\end{itemize}

alternative instability fix: implicitness

\begin{itemize}
\item explicit scheme is only ``conditionally stable'', but there are methods which are stable for \emph{any} positive time step $\Delta t$
\end{itemize}

\begin{itemize}
\item an implicit scheme is \emph{Crank-Nicolson} $\longrightarrow$
\item Crank-Nicolson has smaller error too: $O(\Delta t^2,\Delta x^2)$
\end{itemize}

\begin{itemize}
\item \emph{but} you have to solve linear systems of equations to take each time step
\item \scriptsize Donald Knuth has advice for ice sheet modelers: \begin{quote}
\emph{We should forget about small efficiencies \dots: premature optimization is the root of all evil}.
\end{quote}
\end{itemize}

variable diffusivity and time steps

\begin{itemize}
  \item recall the analogy: \qquad (SIA) $\leftrightarrow$ (heat eqn)
  \item the SIA has a diffusivity which varies in space, so consider a more general heat equation:
  		$$u_t = F + \Div \left(D(x,y) \grad u\right)$$
  \item the explicit method is conditionally stable with the same time step restriction if we evaluate diffusivity $D(x,y)$ at \alert{staggered} grid points:
\begin{align*}
\Div \left(D(x,y) \grad u\right) &\approx \frac{D_{j+1/2,k}(u_{j+1,k} - u_{j,k}) - D_{j-1/2,k}(u_{j,k} - u_{j-1,k})}{\Delta x^2} \\
	&\qquad + \frac{D_{j,k+1/2}(u_{j,k+1} - u_{j,k}) - D_{j,k-1/2}(u_{j,k} - u_{j,k-1})}{\Delta y^2}
\end{align*}
\end{itemize}

\begin{center}
\includegraphics[width=1.8in]{cnstencil}
\quad
\includegraphics[width=1.8in]{diffstencil}
\quad
\includegraphics[width=1.8in]{mahaffystencil}
\end{center}

in stencil at right:
\begin{itemize}
\item[] diamonds: $u$
\item[] triangles: $D$
\end{itemize}


general diffusion equation code

\minput{diffusion}

\begin{itemize}
\item solves abstract diffusion equation $u_t = \Div \left(D(x,y)\, \grad u\right)$
\item user supplies diffusivity on staggered grid
\end{itemize}


\subsection{solutions}

exact solution of heat equation

\begin{itemize}
\item before getting to ice flow, one more heat equation topic \dots
\item the simple heat equation in 1D with constant diffusivity $D>0$ is:
	$$u_t = D u_{xx}$$
\item many \emph{exact} solutions to the heat equation are known, but I'll show the ``Green's function''
\item \dots also known as ``fundamental solution'' or ``heat kernel''
\item it starts at time $t=0$ with a ``delta function'' of heat at the origin $x=0$ and then it spreads out over time
\item we find it by a method which generalizes to the SIA
\end{itemize}

Green's function of heat equation

\begin{itemize}
\item the solution is ``self-similar'' over time
\item as time goes it changes shape by
  \begin{itemize}
  \item[$\circ$] shrinking the output (vertical) axis and
  \item[$\circ$] lengthening the input (horizontal) axis
  \end{itemize}
\item \dots but otherwise it is the same shape
\item the integral over $x$ is independent of time
\end{itemize}

\begin{center}
\includegraphics[width=2.5in]{heatscaling}
\quad
\includegraphics[width=2.5in]{brownian}

\emph{increasing time} $\to$ \qquad FIXME: parbox {\emph{historical note}:  in 1905 Einstein saw that the average distance traveled by particles in thermal motion scales like $\sqrt{t}$, so $s = t^{-1/2}x$ is an invariant}
\end{center}

similarity solutions

\begin{itemize}
\item Green's function of heat equation in 1D is
	$$u(t,x) = C\, t^{-1/2} e^{-x^2/(4Dt)}$$
\item ``similarity'' variables for 1D heat equation are
	$$s \stackrel{\text{\emph{input scaling}}}{\phantom{\Big|}=\phantom{\Big|}} t^{-1/2} x, \qquad u(t,x) \stackrel{\text{\emph{output scaling}}}{\phantom{\Big|}=\phantom{\Big|}} t^{-1/2} \phi(s)$$
\end{itemize}




\subsection{solving the SIA}

similarity solution to SIA

\begin{itemize}
\item jump forward to 1981
\item P.~Halfar found the similarity solution of the SIA in the case of flat bed and no surface mass balance \nocite{Halfar81,Halfar83}
\item Halfar's 2D solution for Glen flow law with $n=3$ has scalings
   $$H(t,r)=t^{-1/9} \phi(s), \qquad s = t^{-1/18} r$$
\item \dots so the diffusion of ice really slows down as the shape flattens out!
\end{itemize}

Halfar solution to the SIA: the movie

%\animategraphics[autoplay,loop,height=7.0cm]{4}{anim/halfar}{0}{26}

frames from $t=4$ months to $t = 10^6$ years, equal spaced in \emph{exponential} time

Halfar solution to the SIA: the formula

\begin{itemize}
\item for $n=3$ the solution formula is:
  $$H(t,r) = H_0 \left(\frac{t_0}{t}\right)^{1/9} \left[1 - \left(\left(\frac{t_0}{t}\right)^{1/18} \frac{r}{R_0}\right)^{4/3}\right]^{3/7}$$
\item the ``characteristic time'' is
  $$t_0 = \frac{1}{18 \Gamma} \left(\frac{7}{4}\right)^3 \frac{R_0^4}{H_0^{7}}$$
if $H_0$, $R_0$ are central height and ice cap radius at $t=t_0$
\item you choose $H_0$ and $R_0$ and then determine $t_0$
\item it is a simple formula to use for verification!
\end{itemize}

is the Halfar solution \emph{good for any modeling}?

\begin{itemize}
\item John Nye and others (2000)\nocite{NyeIcarus2000} compared the long-time consequences of different flow laws for the South Mars Polar Cap
\item they evaluated $\text{CO}_2$ ice and $\text{H}_2\text{O}$ ice softness parameters
\item \dots by comparing the long-time behavior of the corresponding Halfar solutions
\item conclusions:
  \begin{quote}
  \dots none of the three possible [$\text{CO}_2$] flow laws will allow a 3000-m cap, the thickness suggested by stereogrammetry, to survive for $10^7$ years, indicating that the south polar ice cap is probably not composed of pure $\text{CO}_2$ ice \dots the south polar cap probably consists of water ice, with an unknown admixture of dust.
  \end{quote}
\end{itemize}

on ``degenerate'' diffusivity

\begin{itemize}
\item recall that the SIA is
	$$H_t = M + \Div \left(D\, \grad h \right) \quad \text{where} \quad D = \Gamma H^{n+2} |\grad h|^{n-1}$$
\item thus the diffusivity ``degenerates'', $D \to 0$, when either $H\to 0$ or $\grad h \to 0$
\item summary:
\begin{tabular}{l|c|c}
 & why $D\to 0$ & so what? \\ \hline
domes    & $\grad h \to 0$ & \begin{tabular}{c}
$H$ and $\grad h$ are continuous \\ but $\grad^2 h$ is singular
\end{tabular} \\ \hline
margins  & $H \to 0$       & \begin{tabular}{c}
$H$ is continuous \\ but $\grad h$ is singular
\end{tabular}
\end{tabular}
\item in terms of numerical error, margin is worse than dome
\item degenerate diffusion equations are automatically free boundary problems
\end{itemize}

computing diffusivity in SIA

\begin{itemize}
\item for numerical stability we compute $D = \Gamma H^{n+2} |\grad h|^{n-1}$ on the staggered grid
\item various schemes proposed \small (Mahaffy, 1976\nocite{Mahaffy}; van der Veen 1999\nocite{vanderVeen}; Hindmarsh and Payne 1996\nocite{HindmarshPayne})
\item all schemes involve
  \begin{itemize}
  \item[$\circ$] averaging $H$
  \item[$\circ$] differencing $h$
  \item[$\circ$] in a ``balanced'' way, for better accuracy,
  \end{itemize}
to get the diffusivity on staggered grid

\item Mahaffy stencil shown in previous figure
\end{itemize}


SIA implementation: flat bed case

\minput{siaflat}

verification of numerical ice flow codes

\begin{itemize}
\item how do we make sure an \emph{implemented} numerical scheme is correct?
  \begin{itemize}
  \item[$\circ$] \emph{technique} 1: don't make any mistakes
  \item[$\circ$] \emph{technique} 2: compare your model with others, and hope that the outliers are the ones with errors
  \item[$\circ$] \emph{technique} 3: build-in a comparison to an exact solution, and actually measure the numerical error \alert{$=$ verification}
  \end{itemize}
\item where to get exact solutions for ice flow models?
  \begin{itemize}
  \item[$\circ$] textbook: Greve and Blatter (2009)\nocite{GreveBlatter2009}
  \item[$\circ$] similarity solutions to SIA (Halfar 1983\nocite{Halfar83}; Bueler et al 2005\nocite{BLKCB})
  \item[$\circ$] manufactured solutions to thermo-coupled SIA (Bueler et al 2007\nocite{BBL})
  \item[$\circ$] flowline and cross-flow SSA solutions (van der Veen, 1985; Schoof, 2006)\nocite{SchoofStream,vanderVeen85}
  \item[$\circ$] flowline Blatter solutions (Glowinski and Rappaz 2003)\nocite{GlowinskiRappaz}
  \item[$\circ$] flowline Stokes solutions for constant viscosity (Ladyzhenskaya 1963\nocite{Ladyzhenskaya}, Balise and Raymond 1985\nocite{BaliseRaymond1985})
  \item[$\circ$] manufactured solutions to the Stokes equations (Sargent and Fastook 2010; Jouvet and Rappaz 2011)\nocite{JouvetRappaz2011,SargentFastook2010}
  \end{itemize}
\end{itemize}

verifying SIA code vs Halfar

\begin{verbatim}
octave:40> verifysia(20)
average abs error            = 22.310
maximum abs error            = 227.849
octave:41> verifysia(40)
average abs error            = 9.490
maximum abs error            = 241.470
octave:42> verifysia(80)
average abs error            = 2.800
maximum abs error            = 155.796
octave:43> verifysia(160)
average abs error            = 1.059
maximum abs error            = 109.466
\end{verbatim}


demonstrate robustness

see \texttt{roughice.m}, which calls \texttt{siaflat.m} after setting-up the nasty initial state at left:

\includegraphics[width=2.5in]{roughinitial}
\quad
\includegraphics[width=2.5in]{roughfinal}



model the Antarctic ice sheet

\begin{itemize}
\item with careful-but-small modifications of \texttt{siaflat.m}, which make a good exercise:
  \begin{itemize}
  \item[$\circ$] observed accumulation as surface mass balance,
  \item[$\circ$] allow non-flat bed (so $H\ne h$),
  \item[$\circ$] differentiate the surface correctly where floating, and
  \item[$\circ$] calve at current calving front location
  \end{itemize}
here are results from this \emph{toy} Antarctic flow model
\item a 2000 model year run on a $\Delta x=50$ km grid; runtime a few seconds
\end{itemize}

\includegraphics[width=2.5in]{antinitial}
\quad
\includegraphics[width=2.5in]{antfinal}





\section{mass continuity}

the most basic shallow assumption:

\begin{itemize}
\item there are many shallow theories: SIA, SSA, hybrids, Blatter, \dots \nocite{Blatter}
\item \emph{all} make one assumption not required in the (non-shallow) Stokes theory:

\begin{center}
\emph{the surface and base of the ice are given by differentiable functions} $z=h(t,x,y)$ \emph{and} $z=b(t,x,y)$
\end{center}
\item surface overhang is not allowed
\end{itemize}


\begin{center}
\includegraphics[width=2.5in]{sshape}
\quad
\includegraphics[width=2.5in]{Serac2}

\alert{not shallow!}
\end{center}


kinematic and mass continuity equations:

\begin{itemize}
\item what does this ``most basic shallow assumption'' get you?
\item \emph{answer:} a map-plane mass continuity equation
\item consider these three equations (\emph{on next slide}):
  \begin{itemize}
  \item[$\circ$]  the surface kinematical equation
  \item[$\circ$]  the base kinematical equation
  \item[$\circ$]  the map-plane mass continuity equation
  \end{itemize}
\item under the ``most basic shallow assumption'', 

\begin{center}\emph{any two imply the third}\end{center}
\item you connect the three equations by
  \begin{itemize}
  \item[$\circ$]  the incompressibility of ice
    $$u_x + v_y + w_z = 0$$
  \item[$\circ$]  and the Leibniz rule for differentiating integrals
  \scriptsize
    $$\frac{d}{dx}\left(\int_{g(x)}^{f(x)} h(x,y)\,dy\right) = f'(x) h(x,f(x)) - g'(x) h(x,g(x)) + \int_{g(x)}^{f(x)} h_x(x,y)\,dy$$
  \end{itemize}
\end{itemize}

\begin{itemize}
\item let $a$ be the surface mass balance function ($a>0$ is accumulation), and
\item $s$ be the basal melt rate function ($s>0$ is basal melting), so
\item $M=a-s$
\item define the map-plane flux of ice,
	$$\bq = \int_{b}^{h} (u,v)\,dz = \overline{\mathbf{u}}\,H$$
\item the three equations are:
\begin{empheq}[left=\text{surface kinematical}\quad,innerbox=\fbox]{equation}
h_t = a - u\big|_h h_x - v\big|_h h_y + w\big|_h  \label{surfkine}
\end{empheq}
\begin{empheq}[left=\text{base kinematical}\quad,innerbox=\fbox]{equation}
b_t = s - u\big|_b b_x - v\big|_b b_y + w\big|_b  \label{basekine}
\end{empheq}
\begin{empheq}[left=\text{mass continuity}\qquad\qquad\quad,innerbox=\fbox]{equation}
H_t = M - \Div \bq \label{masscontinuity}
\end{empheq}
\end{itemize}

\begin{itemize}
\item literature is full of incomplete calculations of these shallow equivalences
\item \dots usually mixed in with small-parameter arguments about shallow stress balances
\item most ice sheet models use the mass continuity equation to describe change in ice sheet geometry
\item \dots but they could instead use the surface kinematical equation
\end{itemize}

standard recipe for ice sheet models:

\begin{itemize}
\item the ingredients of a typical ice sheet model:
  \begin{enumerate}
  \item numerical implementation of a stress balance: gives velocity $(u,v,w)$
  \item from the horizontal velocity $(u,v)$ and the surface balance, do time-step of mass continuity equation to get $H_t$
  \item update upper and lower surface elevation
  \item decide on time-step, and repeat at 1.
  \end{enumerate}
\end{itemize}



\section{shelves and streams}


\subsection{shallow shelf approximation (SSA)}

flow model II: shallow shelf approximation (SSA) stress balance:
  
SSA model applies very well to \alert{ice shelves}:
\begin{itemize}
\item \dots for parts away from grounding lines
\item \dots and away from calving fronts
\end{itemize}

\begin{center}
\includegraphics[width=2.5in]{ice_shelf_edge_hg}
\quad
\includegraphics[width=2.5in]{siple}

edge of Ekstr\"om ice shelf (photo Hans Grobe) \qquad RADARSAT-derived surface velocity for Siple Coast ice streams, Antarctica
\end{center}

SSA also applies reasonably well to \alert{ice streams}:
\begin{itemize}
\item \dots with modest bed topography
\item \dots and weak bed strength\footnote{energy conservation (= ice temperature and basal melt) is a major aspect of ice stream flow \cite{Raymondenergy}, but not addressed here}
\item imperfect near shear margins and grounding lines
\end{itemize}


what is, \emph{and is not}, an ice stream?:

\begin{itemize}
\item ice streams 
  \begin{itemize}
  \item[$\circ$] slide ($100$ to $1000 \,\text{m}\,\text{a}^{-1}$)
  \item[$\circ$] concentration of vertical shear in a thin layer near base
  \item[$\circ$] \emph{liquid water} at bed plays a critical role (Clarke, 2005)\nocite{Clarke05}
  \end{itemize}
\item ``outlet glaciers''
  \begin{itemize}
  \item[$\circ$] fast surface speed (up to $10 \,\text{km}\,\text{a}^{-1}$)
  \item[$\circ$] uncertain how much is sliding
  \item[$\circ$] substantial vertical shear ``up'' in the ice column,
  \item[$\circ$] not-at-all flat bed topography
  \item[$\circ$] soft, temperate ice may play a big role
  \end{itemize} 
\item \alert{few simplifying assumptions are appropriate for outlet glaciers}
\end{itemize}

\begin{center}
\includegraphics[width=3.0in]{streamisbrae}

Cross sections of Jakobshavns Isbrae (\textbf{a}) and Whillans Ice Stream (\textbf{b}).  Plotted without vertical exaggeration.  (Figure 1 in \cite{TrufferEchelmeyer})
\end{center}

SSA stress balance equation:

\begin{itemize}
\item only plane flow case (``flow line'')
\item the stress balance equation which determines velocity in an \emph{ice stream}:
\begin{empheq}[box=\fbox]{equation}
  \left({\color{red}2 A^{-1/n} H |u_x|^{1/n - 1} u_x}\right)_x - {\color{blue}C|u|^{m-1}u} = {\color{green}\rho g H h_x} \label{ssa}
\end{empheq}
\item the {\color{red} red term} inside parentheses is the vertically-integrated ``longitudinal'' or ``membrane'' stress
\item the {\color{blue} blue term} is basal resistance
\item the {\color{green} green term} is  driving stress
\item derived originally by \cite{Morland,MacAyeal}
\item \emph{how to think about this equation}?
\item \emph{how do you solve it numerically}?
\end{itemize}

flow line model: from stream to shelf:
\begin{align*}
  u = u_0 & \qquad \text{ at } x = 0 \\
  \left.\begin{array}{r}
  \left(2 A^{-1/n} H |u_x|^{1/n - 1} u_x\right)_x - C|u|^{m-1}u = \rho g H h_x \\
  h = H + b
  \end{array}\right\}& \qquad \text{ on } 0 < x < x_g \\
  \left.\begin{array}{r}
  \left(2 A^{-1/n} H |u_x|^{1/n - 1} u_x\right)_x + 0 = \rho g H h_x \\
  h = (1-\rho/\rho_w) H
  \end{array}\right\}& \qquad \text{ on } x_g < x < x_c \\
  2 A^{-1/n} H |u_x|^{1/n - 1} u_x = \frac{1}{2}\rho (1-\rho/\rho_w) g H^2 & \qquad \text{ at } x = x_c
\end{align*}


flotation criterion and grounding line:

\begin{itemize}
\item the inequality ``$\rho H < - \rho_w b$'' is the \alert{flotation criterion}
\item at the grounding line $x=x_g$ the above inequality switches
\item \dots and the driving stress switches form:
  \begin{itemize}
  \item[$\circ$] on the grounded side we know $\rho H > - \rho_w b$ so
  	$$\rho g H h_x = \rho g H (H_x + b_x)$$
  \item[$\circ$] on the floating side we know $\rho H < - \rho_w b$ so $h = (1-\rho/\rho_w) H$ and so
  	$$\rho g H h_x = \rho(1-\rho/\rho_w) g H H_x$$
  \end{itemize}
\item also: $H,u,u_x$ are all continuous at $x=x_g$
\item best numerical models for moving grounding lines still an open question (e.g.~MISMIP and all that)
\end{itemize}


\subsection{ice shelf flow line solution}

exact velocity and thickness for steady ice shelf:
\begin{itemize}
\item limited goal here: describe a steady state, 1D ice shelf
\item there is this nice \alert{by-hand} result (next slide): the thickness and velocity in the ice shelf can be completely determined \cite{MacAyealBarcilon,vanderVeen83} in terms of the 
  \begin{enumerate}
  \item ice thickness $H_g$ at the grounding line and
  \item ice velocity $u_g$ at the grounding line
  \end{enumerate}
\item we will use this to
  \begin{itemize}
  \item[$\circ$] understand the SSA better
  \item[$\circ$] verify a numerical SSA code
  \end{itemize}
\end{itemize}

see \texttt{testshelf.m} 

\begin{center}
  \includegraphics[width=3.0in]{steadyshelf} \hfill \includegraphics[width=2.5in]{Rocket_nozzle_expansion}
\end{center}


\subsection{numerical SSA}

numerically solving the SSA stress balance:
\begin{itemize}
\item here we fix ice thickness $H(x)$ and find the velocity numerically
\item the stress balance is a nonlinear equation in the velocity:
  $$\left(2 A^{-1/n} H |u_x|^{1/n - 1} u_x\right)_x - C|u|^{m-1}u = \rho g H h_x$$
\item \alert{iteration is needed}
\item I'll describe the numerical method for a shelf \emph{or} stream, but only give a code for an ice shelf
\end{itemize}

\begin{itemize}
\item coefficient ${\color{red} \bar \nu} = A^{-1/n} |u_x|^{1/n-1}$ is the ``effective viscosity'':
   $$\left(2 \,{\color{red} \bar \nu}\, H u_x\right)_x - C |u|^{m-1} u = \rho g H h_x$$
\item \emph{simplest iteration idea}: use old effective viscosity to get new velocity solution, and repeat until things stop changing
  \begin{itemize}
  \item[$\circ$] this is ``Picard'' iteration
  \item[$\circ$] Newton iteration is a superior alternative
  \end{itemize}
\item specifically:
  \begin{itemize}
  \item[$\circ$] last iterate $u^{(k-1)}$
  \item[$\circ$] define $W^{(k-1)} = 2 \bar \nu H = 2 A^{-1/n} |u^{(k-1)}_x|^{1/n-1} H$
  \item[$\circ$] current iterate (unknown) $u^{(k)}$
  \item[$\circ$] solve repeatedly:
     $$\left(W^{(k-1)} u^{(k)}_x\right)_x - C |u^{(k-1)}|^{m-1} u^{(k)} = \rho g H h_x$$
  \end{itemize}
\end{itemize}

solving the ``inner'' linear problem:
\begin{itemize}
\item abstract the problem:
   $$\left(W(x)\, u_x\right)_x - \alpha(x)\, u = \beta(x)$$
on $0 < x < L$, with boundary conditions
   $$u(0) = V, \qquad  u_x(L) = \gamma$$
\item an \emph{elliptic} PDE boundary value problem
\item $W(x)$, $\alpha(x)$, $\beta(x)$ are known functions in the SSA context:
  \begin{itemize}
  \item[$\circ$] both $W(x)$ and $\alpha(x)$ come from previous iteration
  \item[$\circ$] $\beta(x)$ is driving stress
  \end{itemize}
\end{itemize}

where do you get an initial guess $u^{(0)}$?:

\begin{itemize}
\item \emph{for floating ice}, a possible initial guess for velocity comes from assuming a uniform strain rate:
   $$u^{(0)}(x) = \gamma (x-x_g) + u_g$$
where $\gamma$ is the value of $u_x$ found from calving front stress imbalance
\item \emph{for grounded ice}, a possible initial guess for velocity is to assume ice is held by basal resistance only:
   $$u^{(0)}(x) = \left(-C^{-1} \rho g H h_x\right)^{1/m}$$
\end{itemize}

numerics of the ``inner'' linear problem:

\begin{itemize}
\item suppose $j=1,2,\dots,J+1$, where $x_1 = x_g$ and $x_{J+1} = x_c$ are endpoints
\item $W(x)$ is needed on the staggered grid; the approximation is:
$$\frac{W_{j+1/2} (u_{j+1} - u_j) - W_{j-1/2} (u_{j} - u_{j-1})}{\Delta x^2} - \alpha_j u_j \stackrel{\ast}{=} \beta_j$$
\item left-hand boundary condition: $u_1 = V$ given
\item right-hand boundary condition (``$u_x(L)=\gamma$''):
  \begin{itemize}
  \item[$\circ$] introduce notional point $x_{J+2}$
  \item[$\circ$]
    $$\frac{u_{J+2} - u_J}{2 \Delta x} = \gamma$$
  \item[$\circ$] using equation $\ast$ in $j=J+1$ case, eliminate $u_{J+2}$ variable ``by-hand'' before coding numerics \nocite{MortonMayers}
  \end{itemize}
\end{itemize}

\begin{itemize}
\item so SSA stress balance has form  \quad $A \mathbf{x} = \mathbf{b}$, \quad namely:
$$
\begin{bmatrix}
1 &  &  &  &  \\
W_{3/2} & A_{22} & W_{5/2} &  &  \\
 & W_{5/2} & A_{33} &  &  \\
 &  & \ddots & \ddots &  \\
 &  & W_{J-1/2} & A_{JJ} & W_{J+1/2} \\
 &  &  & A_{J+1,J} & A_{J+1,J+1} \\
\end{bmatrix}\,
\begin{bmatrix}
u_1 \\ u_2 \\ u_3 \\ \vdots \\ u_J \\ u_{J+1}
\end{bmatrix}
=
\begin{bmatrix}
0 \\ \beta_2 \Delta x^2 \\ \beta_3 \Delta x^2 \\ \vdots \\ \beta_J \Delta x^2 \\ b_{J+1}
\end{bmatrix}
$$
\item with diagonal entries
$$A_{22} = -(W_{3/2}+W_{5/2}+\alpha_1 \Delta x^2)$$
$$A_{33} = -(W_{5/2}+W_{7/2}+\alpha_2 \Delta x^2)$$
and so on, up to $A_{JJ}$, 
\item with special cases in last equation:
$$A_{J+1,J} = 2 W_{J+1/2}$$
$$A_{J+1,J+1} = -(2 W_{J+1/2}+\alpha_{J+1}\Delta x^2)$$
$$b_{J+1} = -2 \gamma \Delta x W_{J+3/2} + \beta_{J+1} \Delta x^2$$
\item this is a \emph{tridiagonal} system
\end{itemize}

\minput{flowline}

testing the ``inner'' linear code

\begin{itemize}
\item before proceeding to solve nonlinear SSA problem, we can test the ``abstracted'' code \texttt{flowline.m}
\item test by ``manufacturing'' solutions
  \begin{itemize}
  \item[$\circ$] see \texttt{testflowline.m}; not shown
  \end{itemize}
\item results:
  \begin{itemize}
  \item[$\circ$] converges at optimal rate $O(\Delta x^2)$
  \end{itemize}
\end{itemize}

numerical: SSA:

\minput{ssaflowline}

\emph{numerical} thickness and velocity for steady ice shelf:

lines below are a convergence analysis of \texttt{testshelf.m}, which calls \texttt{ssaflowline.m}:

\begin{center}
  \includegraphics[width=3.0in]{shelfconv}
\end{center}

realistic ice shelf modeling:

\begin{itemize}
\item flow lines are never very realistic
\item you can add ``side drag'' \dots but I don't really know how to parameterize it
\item also, ice shelves have surprises:
  \begin{itemize}
  \item[$\circ$] high basal melt near grounding lines
  \item[$\circ$] marine ice can freeze-on at bottom (below)
  \item[$\circ$] ``reverse slope'' bed instability and WAIS \dots
  \end{itemize}
\end{itemize}

\medskip
\begin{center}
  \includegraphics[width=3.0in]{marineice}
  
from Grosfeld \& Thyssen 1994 \nocite{GrosfeldThyssen1994}
\end{center}

ice shelf modeling in 2D:

\begin{itemize}
\item ``diagnostic'' (static geometry) ice shelf modeling in two horizontal variables has been quite successful
\item observed surface velocities should validate stress balance models
  \begin{itemize}
  \item[$\circ$] Ross ice shelf example below using PISM
  \item[$\circ$] \dots but many models can do this (MacAyeal et al 1996\nocite{MacAyealetal})
  \end{itemize}
\end{itemize}

\begin{center}
  \includegraphics[width=2.5in]{rossquiver}
  \quad
  \includegraphics[width=2.5in]{rossscatter}
\end{center}

numerical solution of stress balances: a summary

\begin{itemize}
\item stress balance equations (e.g.~SSA) determine horizontal velocity from geometry and boundary conditions
  \begin{itemize}
  \item[$\circ$] nonlinear so iteration is necessary
  \item[$\circ$] at each iteration a sparse matrix ``inner'' problem is solved
  \item[$\circ$] give the ``inner'' problem to a matrix solver software package
  \end{itemize}
\item general principles: \emph{modularize your code} and \emph{test the parts}
\end{itemize}

the mass continuity equation: a summary:

\begin{itemize}
\item the \emph{mass continuity equation} is
  $$H_t = M - \nabla \cdot (\mathbf{u} H)$$
\item the numerical nature of this equation depends on the stress balance:
  \begin{itemize}
  \item[$\circ$] the equation is a diffusion for frozen bed, large scale flows (i.e.~SIA)
  \item[$\circ$] it is \emph{not} very diffusive for membrane stresses and no basal resistance (e.g.~SSA for ice shelves)
  \item[$\circ$] it is significantly diffusive for ice streams (but how much?)
  \item[$\circ$] there is not much helpful theory on to solve this transport problem
  \item[$\circ$] maybe \emph{you} will help find this theory!
  \end{itemize}
\end{itemize}


\section{next steps}

\subsection{practicalities}

technical skills for numerical ice sheet modeling:

\begin{itemize}
\item comfort in a technical computing environment; need to know:
  \begin{itemize}\small
  \item[$\circ$] an editor,
  \item[$\circ$] a scripting/prototyping language (Matlab, Python, etc.),
  \item[$\circ$] a compiled language (C or Fortran),
  \item[$\circ$] \emph{a version control system} (Subversion, git, etc.), and
  \item[$\circ$] some tools for NetCDF files
  \normalsize
  \end{itemize}
\item willingness to read math, numerical analysis, computer science, etc.
\item \emph{physics}
\item \emph{never} re-invent the wheel for basic numerics like these:
  \begin{itemize}
  \item[$\circ$] numerical linear algebra
  \item[$\circ$] mesh generation, finite element assembly and solve
  \item[$\circ$] \dots \emph{except} to write throw-away codes to help you understand numerical ideas 
  \end{itemize}
\item try existing ice flow models:
  \begin{itemize}
  \item[$\circ$] open source SIA-based comprehensive models: GLIMMER, SICOPOLIS
  \item[$\circ$] open source hybrid/higher-order/Stokes models: PISM, Elmer, ISSM
  \end{itemize}
\item ice sheet modeling is young, and much to do!
\end{itemize}


\subsection{some omitted models}

thermomechanical coupling:

\begin{itemize}
\item ice softness $A(T)$ varies by $10^3$ in relevant temperature range
\end{itemize}

\includegraphics[width=3.0in]{AofT}


\begin{itemize}
\item ice thermal state (temperature) gives ice sheet flows their ``long memory'' of past climate
\item dissipation of gravitational potential energy is major part of basal melt
  \begin{itemize}
  \item[$\circ$] each year, Jakobshavn drainage basin in Greenland dissipates enough gravitational potential energy to melt $> 1\,\text{km}^3$ of ice
  \item[$\circ$] geothermal flux also significant in slow parts
  \end{itemize}
\item so good ice sheet models need conservation of energy
  \begin{itemize}
  \item[$\circ$] ``enthalpy'' is good way to track energy content polythermally (Aschwanden et al.~2012)\nocite{AschwandenBuelerKhroulevBlatter}
  \end{itemize}
\end{itemize}

solid Earth deformation:

\begin{itemize}
\item ice density is about $\frac{1}{3}$ that of rock in the Earth's mantle,
  \begin{itemize}
  \item[$\circ$] 1000 m of ice depresses the Earth's crust about 300 m
  \item[$\circ$] \dots if allowed enough time
  \item[$\circ$] how much time is determined by \emph{upper mantle viscosity}
  \item[$\circ$] \dots which is not perfectly known
  \end{itemize}
\item Earth deformation changes bed topography and thus ice flow
\item modeling Earth deformation is most important to modeling ice flow over long time scales (Peltier, 1998)\nocite{Peltier1998review}
\end{itemize}

\begin{center}
  \includegraphics[width=3.0in]{earthcompare}
\end{center}

spin-up:

\begin{itemize}
\item direct observations are not enough to initialize an ice sheet flow model
  \begin{itemize}
  \item[$\circ$] because ice temperature is a ``hidden variable'', and
  \item[$\circ$] because sliding depends on additional liquid water ``hidden variables'' at base
  \end{itemize}
\item two options exist to initialize:
  \small
  \begin{enumerate}
  \item \emph{traditional choice}: use low-dimensional time series data from physical surrogates (e.g. $\delta \phantom{|}^{18}O$ record from ice cores) for paleoclimate record; hope a long model run ends with a good current state
  \item \emph{promising alternative}:  use rich and spatially-distributed mostly-surface observations of present ice sheet state to reconstruct initial state using ``inversion'' of PDEs
  \normalsize
  \end{enumerate}
\end{itemize}

inverse modeling:

\begin{itemize}
\item stress balance PDEs can turn extra boundary data on top into missing basal information
\item surface velocity observations can be inverted to find basal shear stress (below)
\item mostly future: invert radar layers (isochrones)
\end{itemize}

\begin{center}
  \includegraphics[width=3.0in]{NEgreenlandJoughin}
  
from Joughin et al.~(2001)\nocite{Joughinetal2001}
\end{center}

Stokes equations and solvers:

\begin{itemize}
\item the Stokes model itself, without shallow assumptions, can be solved numerically, \alert{but}:
  \begin{itemize}
  \item[$\circ$] many equations in many unknowns, especially in 3D
  \item[$\circ$] requires explicit accounting for incompressibility---a constraint on the flow---through a pressure variable
  \item[$\circ$] ice sheets are \emph{actually} shallow, and the aspect ratio of grid elements can be a problem
  \end{itemize}
\item much of the success so far is at a smaller scale
\end{itemize}

\begin{center}
\includegraphics[width=3.0in]{athabasca}

Figure 7 in \cite{Maxwelletal2008}:  velocity contour lines ($\text{m}\,\text{a}^{-1}$) for Athabasca Glacier from \textbf{a} Stokes model, \textbf{b} measurements \cite{Raymond1971}
\end{center}





\section{Notes and references}

Not covered here:
  \begin{itemize}
  \item Stokes and ``higher order'' flow equations
  \item thermomechanical coupling or polythermal ice
  \item subglacial hydrology/processes
  \item mass balance and snow/firn processes
  \item constitutive relations other than Glen isotropic
  \item grounding lines, calving fronts, ocean interaction
  \item paleo-climate and ``spin-up''
  \item earth deformation under ice sheet load
  \item other numerics: FEM, spectral, multigrid, parallel, \dots
  \item etc.
  \end{itemize}

Where does the SIA come from?    Historically, it was derived several authors in the 1970s and 80s \cite{FowlerLarson1978,MorlandJohnson,Hutter} and thus it is recent compared to the Stokes model.  Logically, you scale the Stokes equations using smallness of $\eps = [H]/[L]$, where $[H]$ is a typical thickness of an ice sheet and $[L]$ is a typical horizontal dimension \cite{Fowler}; this is a ``small-parameter argument''.  Then you drop the terms that are small, noting that in one such derivation this means dropping only terms of $\eps^2$ and smaller.

The SSA model is derived by \cite{Morland} for ice shelves and \cite{MacAyeal} for ice streams.  It is thoroughly addressed by \cite{WeisGreveHutter}.

There are ``higher-order'' approximations of the Stokes equations which are, nonetheless, shallow approximations.  In fact, both the SIA and the SSA are derived by small-parameter arguments from the Stokes equations, so one might ask whether there a common shallow antecedent model?  Schoof and Hindmarsh \cite{SchoofHindmarsh} show that the model derived by Blatter\nocite{Blatter} and first put to good use by Pattyn \cite{Pattyn03} is such an antecedent.  That is, one can use small-parameter arguments to derive the Blatter/Pattyn ``higher-order'' model, and then further small-parameter arguments get either SIA or SSA from Blatter/Pattyn, according to the details of these arguments.

There are also less-precise shallow hybrid schemes which ``glue together'' the SIA and SSA \cite{PollardDeConto,BBssasliding,Goldberg2011}.  Roughly speaking, these shallow hybrids can be used \emph{now} at high spatial resolution and paleoglacial time scales while higher order and Stokes models have computational limitations which restrict either their spatial extent, their spatial resolution, or the duration of model runs.  Questions remain about what is lost in both the higher-order and shallow hybrid models \cite[for example]{ISMIPHOM}.



\bibliography{ice_bib}
\bibliographystyle{siam}

\end{document}
